---
title: "Tutorial: Idea to prototype - Build and evaluate an enterprise agent"
description: "Prototype an enterprise agent: build a single agent with SharePoint grounding and Model Context Protocol (MCP) tools, run batch evaluation, extend to multi-agent, and deploy to Microsoft Foundry."
---
# Tutorial: Idea to prototype - Build and evaluate an enterprise agent

This tutorial covers the first stage of the Microsoft Foundry developer journey: from an initial idea to a working prototype. You build a **modern workplace assistant** that combines internal company knowledge with external technical guidance by using the Microsoft Foundry SDK.

**Business scenario**: Create an AI assistant that helps employees by combining:

- **Company policies** (from SharePoint documents)
- **Technical implementation guidance** (from Microsoft Learn via MCP)
- **Complete solutions** (combining both sources for business implementation)
- **Batch evaluation** to validate agent performance on realistic business scenarios

**Tutorial outcome**: By the end you have a running Modern Workplace Assistant that can answer policy, technical, and combined implementation questions; a repeatable batch evaluation script; and clear extension points (other tools, multi‚Äëagent patterns, richer evaluation).

**You will:**
<Check>Build a Modern Workplace Assistant with SharePoint and MCP integration.</Check>
<Check>Demonstrate real business scenarios combining internal and external knowledge.</Check>
<Check>Implement robust error handling and graceful degradation.</Check>
<Check>Create evaluation framework for business-focused testing.</Check>
<Check>Prepare foundation for governance and production deployment.</Check>
This minimal sample demonstrates enterprise-ready patterns with realistic business scenarios.

<Info>
Code in this article uses packages that are currently in preview. This preview is provided without a service-level agreement, and we don't recommend it for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).
</Info>

## Prerequisites 

- Azure subscription and CLI authentication (`az login`)
- Azure CLI 2.67.0 or later (check with `az version`)
- A Foundry **project** with a deployed model (for example, `gpt-4o-mini`). If you don't have one: [Create a project](/setup/create-projects) and then deploy a model (see model overview: [Model catalog](../../concepts/foundry-models-overview.md)). 
- Python 3.10 or later
- .NET SDK (for the C# sample)
- SharePoint connection configured in your project ([SharePoint tool documentation](/agents/tools/sharepoint))

<Note>
To configure your Foundry project for SharePoint connectivity, see the [SharePoint tool documentation](/agents/tools/sharepoint).
</Note>

- (Optional) Git installed for cloning the sample repository

## Step 1: Get the sample code

Instead of navigating a large repository tree, use one of these approaches:

#### Option A (clone entire samples repo)

<Tip>
Code uses **Azure AI Projects 2.x (preview)** and is incompatible with Azure AI Projects 1.x.
</Tip>

<CodeGroup>
```bash Python
    git clone --depth 1 https://github.com/microsoft-foundry/foundry-samples.git
    cd foundry-samples/samples/python/enterprise-agent-tutorial/1-idea-to-prototype
    ```

```bash C#
    git clone --depth 1 https://github.com/azure-ai-foundry/foundry-samples.git
    cd foundry-samples/samples/csharp/enterprise-agent-tutorial/1-idea-to-prototype
    ```
</CodeGroup>

#### Option B (sparse checkout only this tutorial - reduced download)

<CodeGroup>
```bash Python
    git clone --no-checkout https://github.com/microsoft-foundry/foundry-samples.git
    cd foundry-samples
    git sparse-checkout init --cone
    git sparse-checkout set samples/python/enterprise-agent-tutorial/1-idea-to-prototype
    git checkout
    cd samples/python/enterprise-agent-tutorial/1-idea-to-prototype
    ```

```bash C#
    git clone --no-checkout https://github.com/azure-ai-foundry/foundry-samples.git
    cd foundry-samples
    git sparse-checkout init --cone
    git sparse-checkout set samples/csharp/enterprise-agent-tutorial/1-idea-to-prototype
    git checkout
    cd samples/csharp/enterprise-agent-tutorial/1-idea-to-prototype
    ```
</CodeGroup>

#### Option C (Download ZIP of repository)

Download the repository ZIP, extract it to your local environment, and go to the tutorial folder.

<Info>
For production adoption, use a standalone repository. This tutorial uses the shared samples repo. Sparse checkout minimizes local noise.
</Info>

<Tabs>
  <Tab title="Python">

    <Card title="Download the Python code now" icon="arrow-right" href="https://github.com/microsoft-foundry/foundry-samples/tree/main/samples/python/enterprise-agent-tutorial/1-idea-to-prototype" />
    After you extract the ZIP, go to `samples/python/enterprise-agent-tutorial/1-idea-to-prototype`.

  </Tab>
  <Tab title="C#">

    <Card title="Download the C# code now" icon="arrow-right" href="https://github.com/azure-ai-foundry/foundry-samples/tree/main/samples/csharp/enterprise-agent-tutorial/1-idea-to-prototype" />
    After you extract the ZIP, go to `samples/csharp/enterprise-agent-tutorial/1-idea-to-prototype`.

  </Tab>
</Tabs>

The minimal structure contains only essential files:

<CodeGroup>
```text Python
    enterprise-agent-tutorial/
    ‚îî‚îÄ‚îÄ 1-idea-to-prototype/
       ‚îú‚îÄ‚îÄ .env                             # Create this file (local environment variables)
       ‚îú‚îÄ‚îÄ .gitkeep
       ‚îú‚îÄ‚îÄ evaluate.py                      # Business evaluation framework
       ‚îú‚îÄ‚îÄ evaluation_results.json
       ‚îú‚îÄ‚îÄ main.py                          # Modern Workplace Assistant
       ‚îú‚îÄ‚îÄ questions.jsonl                  # Business test scenarios (4 questions)
       ‚îú‚îÄ‚îÄ requirements.txt                 # Python dependencies
       ‚îî‚îÄ‚îÄ sharepoint-sample-data/          # Sample business documents for SharePoint
          ‚îú‚îÄ‚îÄ collaboration-standards.docx
          ‚îú‚îÄ‚îÄ data-governance-policy.docx
          ‚îú‚îÄ‚îÄ remote-work-policy.docx
          ‚îî‚îÄ‚îÄ security-guidelines.docx
    ```

```text C#
    enterprise-agent-tutorial/
    ‚îî‚îÄ‚îÄ 1-idea-to-prototype/
       ‚îú‚îÄ‚îÄ ModernWorkplaceAssistant/        # Modern Workplace Assistant
       ‚îÇ   ‚îú‚îÄ‚îÄ Program.cs                   # Agent implementation with SharePoint + MCP
       ‚îÇ   ‚îú‚îÄ‚îÄ ModernWorkplaceAssistant.csproj
       ‚îÇ   ‚îî‚îÄ‚îÄ .env                         # Environment variables (create this)
       ‚îú‚îÄ‚îÄ Evaluate/                        # Cloud evaluation framework
       ‚îÇ   ‚îú‚îÄ‚îÄ Program.cs                   # Cloud evaluation with built-in evaluators
       ‚îÇ   ‚îú‚îÄ‚îÄ Evaluate.csproj
       ‚îÇ   ‚îî‚îÄ‚îÄ evaluation_results.json      # Example output (generated)
       ‚îú‚îÄ‚îÄ questions.jsonl                  # Business test scenarios
       ‚îî‚îÄ‚îÄ README.md                        # Complete setup instructions
    ```
</CodeGroup>

## Step 2: Run the sample immediately

Start by running the agent so you see working functionality before diving into implementation details.

### Environment setup and virtual environment

1. Install the required language runtimes, global tools, and VS Code extensions as described in [Prepare your development environment](/developer-experience/install-cli-sdk).

1. Verify that your `requirements.txt` uses these published package versions:

   ```text
   azure-ai-projects==2.0.0b3
   azure-identity
   python-dotenv
   openai
   ```

1. Install dependencies:

   # [Python](#tab/python)

   ```bash
   python -m pip install -r requirements.txt
   ```

   # [C#](#tab/csharp)

   ```bash
   cd ModernWorkplaceAssistant
   dotnet restore

   cd ../Evaluate
   dotnet restore
   ```
   ---

1. Find your project endpoint on the welcome screen of the project. 

<Frame>
  <img src="/images/project-endpoint.png" alt="Screenshot of Microsoft Foundry Models welcome screen showing the endpoint URL and copy button." />
</Frame> 
1. Configure `.env`.

   Set the environment values required for your language.

<Tabs>
  <Tab title="Python">

    Copy `.env.template` to `.env`.

  </Tab>
  <Tab title="C#">

    Create a `.env` file in the `ModernWorkplaceAssistant` directory.

  </Tab>
</Tabs>

<CodeGroup>
```dotenv Python
    # Foundry configuration
    PROJECT_ENDPOINT=https://<your-project>.aiservices.azure.com
    MODEL_DEPLOYMENT_NAME=gpt-4o-mini

    # The Microsoft Learn MCP Server (optional)
    MCP_SERVER_URL=https://learn.microsoft.com/api/mcp

    # SharePoint integration (optional - requires connection name)
    SHAREPOINT_CONNECTION_NAME=<your-sharepoint-connection-name>
    ```

```dotenv C#
    # Foundry configuration
    PROJECT_ENDPOINT=https://<your-project>.aiservices.azure.com
    MODEL_DEPLOYMENT_NAME=gpt-4o-mini

    # SharePoint integration (optional - requires connection name)
    SHAREPOINT_CONNECTION_NAME=<your-sharepoint-connection-name>

    # The Microsoft Learn MCP Server (optional)
    MCP_SERVER_URL=https://learn.microsoft.com/api/mcp
    ```
</CodeGroup>

<Tip>
To get your **tenant ID**, run:

```bash
# Get tenant ID
az account show --query tenantId -o tsv
```

To get your **project endpoint**, open your project in the [Foundry portal](https://ai.azure.com) and copy the value shown there.
</Tip>

### Run agent and evaluation

<CodeGroup>
```bash Python
    python main.py
    python evaluate.py
    ```

```bash C#
    cd ModernWorkplaceAssistant
    dotnet restore
    dotnet run

    cd ../Evaluate
    dotnet restore
    dotnet run
    ```
</CodeGroup>

### Expected output (agent first run)

Successful run with SharePoint:

```text
ü§ñ Creating Modern Workplace Assistant...
‚úÖ SharePoint tool configured successfully
‚úÖ Agent created successfully (name: Modern Workplace Assistant, version: 1)
```

Graceful degradation without SharePoint:

```text
üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)
‚úÖ Agent created successfully (name: Modern Workplace Assistant, version: 1)
```

Now that you have a working agent, the next sections explain how it works. You don't need to take any action while reading these sections‚Äîthey're for explanation.

## Step 3: Set up sample SharePoint business documents

1. Go to your SharePoint site (configured in the connection).
1. Create document library "Company Policies" (or use existing "Documents").
1. Upload the four sample Word documents provided in the `sharepoint-sample-data` folder:
   - `remote-work-policy.docx`
   - `security-guidelines.docx`  
   - `collaboration-standards.docx`
   - `data-governance-policy.docx`

### Sample structure

```text
üìÅ Company Policies/
‚îú‚îÄ‚îÄ remote-work-policy.docx      # VPN, MFA, device requirements
‚îú‚îÄ‚îÄ security-guidelines.docx     # Azure security standards
‚îú‚îÄ‚îÄ collaboration-standards.docx # Teams, SharePoint usage
‚îî‚îÄ‚îÄ data-governance-policy.docx  # Data classification, retention
```

## Step 4: Understand the assistant implementation

This section explains the core code in `main.py` (Python) or `ModernWorkplaceAssistant/Program.cs` (C#). You already ran the agent. This section is conceptual and requires no changes. After reading it, you can:
- Add new internal and external data tools.
- Extend dynamic instructions.
- Introduce multi-agent orchestration.
- Enhance observability and diagnostics.

The code breaks down into the following main sections, ordered as they appear in the full sample code:

1. [Configure imports and authentication](#imports-and-authentication-setup)
1. [Configure authentication to Azure](#configure-authentication-in-azure)
1. [Configure the SharePoint tool](#create-the-sharepoint-tool-for-the-agent)
1. [Configure MCP tool](#create-the-mcp-tool-for-the-agent)
1. [Create the agent and connect the tools](#create-the-agent-and-connect-the-tools)
1. [Converse with the agent](#converse-with-the-agent)

<Info>
Code in this article uses packages that are currently in preview. This preview is provided without a service-level agreement, and we don't recommend it for production workloads. Certain features might not be supported or might have constrained capabilities. For more information, see [Supplemental Terms of Use for Microsoft Azure Previews](https://azure.microsoft.com/support/legal/preview-supplemental-terms/).
</Info>

### Imports and authentication setup

The code uses several client libraries from the Microsoft Foundry SDK to create a robust enterprise agent.

<CodeGroup>
```python Python
    #!/usr/bin/env python3
    """
    Microsoft Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant

    This sample demonstrates a complete business scenario using the Microsoft Foundry SDK:
    - Agent creation with PromptAgentDefinition
    - Conversation management via the Responses API
    - Robust error handling and graceful degradation

    Educational Focus:
    - Enterprise AI patterns with the Microsoft Foundry SDK
    - Real-world business scenarios that enterprises face daily
    - Production-ready error handling and diagnostics
    - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)

    Business Scenario:
    An employee needs to implement Azure AD multi-factor authentication. They need:
    1. Company security policy requirements
    2. Technical implementation steps
    3. Combined guidance showing how policy requirements map to technical implementation
    """

    # <imports_and_includes>
    import os
    import time
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import (
        PromptAgentDefinition,
        SharepointPreviewTool,
        SharepointGroundingToolParameters,
        ToolProjectConnection,
        MCPTool,
    )
    from azure.identity import DefaultAzureCredential
    from dotenv import load_dotenv
    from openai.types.responses.response_input_param import (
        McpApprovalResponse,
    )
    # </imports_and_includes>

    load_dotenv()

    # ============================================================================
    # AUTHENTICATION SETUP
    # ============================================================================
    endpoint = os.environ["PROJECT_ENDPOINT"]

    def create_workplace_assistant(project_client):
        """
        Create a Modern Workplace Assistant using the Microsoft Foundry SDK.

        This demonstrates enterprise AI patterns:
        1. Agent creation with PromptAgentDefinition
        2. Robust error handling with graceful degradation
        3. Dynamic agent capabilities based on available resources
        4. Clear diagnostic information for troubleshooting

        Returns:
            agent: The created agent object
        """

        print("ü§ñ Creating Modern Workplace Assistant...")

        # ========================================================================
        # SHAREPOINT INTEGRATION SETUP
        # ========================================================================
        # <sharepoint_tool_setup>
        sharepoint_connection_id = os.environ.get("SHAREPOINT_CONNECTION_ID")
        sharepoint_tool = None

        if sharepoint_connection_id:
            print("üìÅ Configuring SharePoint integration...")
            print(f"   Connection ID: {sharepoint_connection_id}")

            try:
                sharepoint_tool = SharepointPreviewTool(
                    sharepoint_grounding_preview=SharepointGroundingToolParameters(
                        project_connections=[
                            ToolProjectConnection(
                                project_connection_id=sharepoint_connection_id
                            )
                        ]
                    )
                )
                print("‚úÖ SharePoint tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  SharePoint tool unavailable: {e}")
                print("   Agent will operate without SharePoint access")
                sharepoint_tool = None
        else:
            print("üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_ID not set)")
        # </sharepoint_tool_setup>

        # ========================================================================
        # MICROSOFT LEARN MCP INTEGRATION SETUP
        # ========================================================================
        # <mcp_tool_setup>
        mcp_server_url = os.environ.get("MCP_SERVER_URL")
        mcp_tool = None

        if mcp_server_url:
            print("üìö Configuring Microsoft Learn MCP integration...")
            print(f"   Server URL: {mcp_server_url}")

            try:
                mcp_tool = MCPTool(
                    server_url=mcp_server_url,
                    server_label="Microsoft_Learn_Documentation",
                    require_approval="always",
                )
                print("‚úÖ MCP tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  MCP tool unavailable: {e}")
                print("   Agent will operate without Microsoft Learn access")
                mcp_tool = None
        else:
            print("üìö MCP integration skipped (MCP_SERVER_URL not set)")
        # </mcp_tool_setup>

        # ========================================================================
        # AGENT CREATION WITH DYNAMIC CAPABILITIES
        # ========================================================================
        if sharepoint_tool and mcp_tool:
            instructions = """You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance"""
        elif sharepoint_tool:
            instructions = """You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices"""
        elif mcp_tool:
            instructions = """You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options"""
        else:
            instructions = """You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations"""

        # <create_agent_with_tools>
        print(f"üõ†Ô∏è  Creating agent with model: {os.environ['MODEL_DEPLOYMENT_NAME']}")

        tools = []
        if sharepoint_tool:
            tools.append(sharepoint_tool)
            print("   ‚úì SharePoint tool added")
        if mcp_tool:
            tools.append(mcp_tool)
            print("   ‚úì MCP tool added")

        print(f"   Total tools: {len(tools)}")

        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=os.environ["MODEL_DEPLOYMENT_NAME"],
                instructions=instructions,
                tools=tools if tools else None,
            ),
        )

        print(f"‚úÖ Agent created successfully (name: {agent.name}, version: {agent.version})")
        return agent
        # </create_agent_with_tools>

    def demonstrate_business_scenarios(agent, openai_client):
        """
        Demonstrate realistic business scenarios with the Microsoft Foundry SDK.

        This function showcases the practical value of the Modern Workplace Assistant
        by walking through scenarios that enterprise employees face regularly.
        """

        scenarios = [
            {
                "title": "üìã Company Policy Question (SharePoint Only)",
                "question": "What is Contoso's remote work policy?",
                "context": "Employee needs to understand company-specific remote work requirements",
                "learning_point": "SharePoint tool retrieves internal company policies",
            },
            {
                "title": "üìö Technical Documentation Question (MCP Only)",
                "question": (
                    "According to Microsoft Learn, what is the correct way to implement "
                    "Azure AD Conditional Access policies? Please include reference links "
                    "to the official documentation."
                ),
                "context": "IT administrator needs authoritative Microsoft technical guidance",
                "learning_point": "MCP tool accesses Microsoft Learn for official documentation with links",
            },
            {
                "title": "üîÑ Combined Implementation Question (SharePoint + MCP)",
                "question": (
                    "Based on our company's remote work security policy, how should I configure "
                    "my Azure environment to comply? Please include links to Microsoft "
                    "documentation showing how to implement each requirement."
                ),
                "context": "Need to map company policy to technical implementation with official guidance",
                "learning_point": "Both tools work together: SharePoint for policy + MCP for implementation docs",
            },
        ]

        print("\n" + "=" * 70)
        print("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION")
        print("=" * 70)
        print("This demonstration shows how AI agents solve real business problems")
        print("using the Microsoft Foundry SDK.")
        print("=" * 70)

        for i, scenario in enumerate(scenarios, 1):
            print(f"\nüìä SCENARIO {i}/3: {scenario['title']}")
            print("-" * 50)
            print(f"‚ùì QUESTION: {scenario['question']}")
            print(f"üéØ BUSINESS CONTEXT: {scenario['context']}")
            print(f"üéì LEARNING POINT: {scenario['learning_point']}")
            print("-" * 50)

            # <agent_conversation>
            print("ü§ñ AGENT RESPONSE:")
            response, status = create_agent_response(agent, scenario["question"], openai_client)
            # </agent_conversation>

            if status == "completed" and response and len(response.strip()) > 10:
                print(f"‚úÖ SUCCESS: {response[:300]}...")
                if len(response) > 300:
                    print(f"   üìè Full response: {len(response)} characters")
            else:
                print(f"‚ö†Ô∏è  RESPONSE: {response}")

            print(f"üìà STATUS: {status}")
            print("-" * 50)

            time.sleep(1)

        print("\n‚úÖ DEMONSTRATION COMPLETED!")
        print("üéì Key Learning Outcomes:")
        print("   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI")
        print("   ‚Ä¢ Conversation management via the Responses API")
        print("   ‚Ä¢ Real business value through AI assistance")
        print("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)")

        return True

    def create_agent_response(agent, message, openai_client):
        """
        Create a response from the workplace agent using the Responses API.

        This function demonstrates the response pattern for the Microsoft Foundry SDK
        including MCP tool approval handling.

        Args:
            agent: The agent object (with .name attribute)
            message: The user's message

        Returns:
            tuple: (response_text, status)
        """

        try:
            response = openai_client.responses.create(
                input=message,
                extra_body={
                    "agent": {"name": agent.name, "type": "agent_reference"}
                },
            )

            # Handle MCP approval requests if present
            approval_list = []
            for item in response.output:
                if item.type == "mcp_approval_request" and item.id:
                    approval_list.append(
                        McpApprovalResponse(
                            type="mcp_approval_response",
                            approve=True,
                            approval_request_id=item.id,
                        )
                    )

            if approval_list:
                response = openai_client.responses.create(
                    input=approval_list,
                    previous_response_id=response.id,
                    extra_body={
                        "agent": {"name": agent.name, "type": "agent_reference"}
                    },
                )

            return response.output_text, "completed"

        except Exception as e:
            return f"Error in conversation: {str(e)}", "failed"

    def interactive_mode(agent, openai_client):
        """Interactive mode for testing the workplace agent."""

        print("\n" + "=" * 60)
        print("üí¨ INTERACTIVE MODE - Test Your Workplace Agent!")
        print("=" * 60)
        print("Ask questions about Azure, M365, security, and technical implementation.")
        print("Type 'quit' to exit.")
        print("-" * 60)

        while True:
            try:
                question = input("\n‚ùì Your question: ").strip()

                if question.lower() in ["quit", "exit", "bye"]:
                    break

                if not question:
                    print("üí° Please ask a question about Azure or M365 technical implementation.")
                    continue

                print("\nü§ñ Workplace Agent: ", end="", flush=True)
                response, status = create_agent_response(agent, question, openai_client)
                print(response)

                if status != "completed":
                    print(f"\n‚ö†Ô∏è  Response status: {status}")

                print("-" * 60)

            except KeyboardInterrupt:
                break
            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("-" * 60)

        print("\nüëã Thank you for testing the Modern Workplace Agent!")

    def main():
        """Main execution flow demonstrating the complete sample."""

        print("üöÄ Foundry - Modern Workplace Assistant")
        print("Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK")
        print("=" * 70)

        # <agent_authentication>
        with (
            DefaultAzureCredential() as credential,
            AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
            project_client.get_openai_client() as openai_client,
        ):
            print(f"‚úÖ Connected to Foundry: {endpoint}")
        # </agent_authentication>

            try:
                agent = create_workplace_assistant(project_client)
                demonstrate_business_scenarios(agent, openai_client)

                print("\nüéØ Try interactive mode? (y/n): ", end="")
                try:
                    if input().lower().startswith("y"):
                        interactive_mode(agent, openai_client)
                except EOFError:
                    print("n")

                print("\nüéâ Sample completed successfully!")
                print("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)")
                print("üîó Next: Add evaluation metrics, monitoring, and production deployment")

            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("Please check your .env configuration and ensure:")
                print("  - PROJECT_ENDPOINT is correct")
                print("  - MODEL_DEPLOYMENT_NAME is deployed")
                print("  - Azure credentials are configured (az login)")

    if __name__ == "__main__":
        main()
    ```

```csharp C#
    // <imports_and_includes>
    using System;
    using System.ClientModel;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Threading.Tasks;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    // </imports_and_includes>

    #pragma warning disable OPENAI001

    /*
     * Azure AI Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant (C#)
     * 
     * This sample demonstrates a complete business scenario using the Azure AI Projects v2 SDK:
     * - Agent creation with PromptAgentDefinition and AgentVersion
     * - Conversation via the Responses API (ProjectResponsesClient)
     * - SharePoint and MCP tool integration on the agent definition
     * - MCP tool approval handling through the Responses API approval loop
     * - Robust error handling and graceful degradation
     * 
     * Educational Focus:
     * - Enterprise AI patterns with the v2 Azure AI Projects SDK
     * - Real-world business scenarios that enterprises face daily
     * - Production-ready error handling and diagnostics
     * - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)
     * 
     * Business Scenario:
     * An employee needs to implement Azure AD multi-factor authentication. They need:
     * 1. Company security policy requirements (from SharePoint)
     * 2. Technical implementation steps (from Microsoft Learn via MCP)
     * 3. Combined guidance showing how policy requirements map to technical implementation
     */

    class Program
    {
        private static AIProjectClient? projectClient;
        private static ProjectResponsesClient? responseClient;
        private static string agentName = "Modern_Workplace_Assistant";

        static async Task Main(string[] args)
        {
            Console.WriteLine("üöÄ Azure AI Foundry - Modern Workplace Assistant");
            Console.WriteLine("Tutorial 1: Building Enterprise Agents with SharePoint + MCP Tools");
            Console.WriteLine("".PadRight(70, '='));

            try
            {
                // Create the agent with full diagnostic output
                var agentVersion = await CreateWorkplaceAssistantAsync();

                // Demonstrate business scenarios
                await DemonstrateBusinessScenariosAsync(agentVersion);

                // Offer interactive testing
                Console.Write("\nüéØ Try interactive mode? (y/n): ");
                var response = Console.ReadLine();
                if (response?.ToLower().StartsWith("y") == true)
                {
                    await InteractiveModeAsync(agentVersion);
                }

                // Cleanup
                Console.WriteLine("\nüßπ Cleaning up agent...");
                await projectClient!.Agents.DeleteAgentVersionAsync(
                    agentName: agentVersion.Name,
                    agentVersion: agentVersion.Version);
                Console.WriteLine("‚úÖ Agent deleted");

                Console.WriteLine("\nüéâ Sample completed successfully!");
                Console.WriteLine("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)");
                Console.WriteLine("üîó Next: Add evaluation metrics, monitoring, and production deployment");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                Console.WriteLine("Please check your .env configuration and ensure:");
                Console.WriteLine("  - PROJECT_ENDPOINT is correct");
                Console.WriteLine("  - MODEL_DEPLOYMENT_NAME is deployed");
                Console.WriteLine("  - Azure credentials are configured (az login)");
                throw;
            }
        }

        /// <summary>
        /// Create a Modern Workplace Assistant with SharePoint and MCP tools.
        /// 
        /// This demonstrates enterprise AI patterns:
        /// 1. Agent creation with PromptAgentDefinition and CreateAgentVersionAsync
        /// 2. SharePoint integration via SharepointAgentTool
        /// 3. MCP integration via McpTool from the OpenAI Responses API
        /// 4. Robust error handling with graceful degradation
        /// 5. Dynamic agent capabilities based on available resources
        /// 
        /// Educational Value:
        /// - Shows real-world complexity of enterprise AI systems
        /// - Demonstrates how to handle partial system failures
        /// - Provides patterns for agent creation with multiple tools
        /// </summary>
        private static async Task<AgentVersion> CreateWorkplaceAssistantAsync()
        {
            // Load environment variables from shared .env file
            var envPath = Path.Combine(Directory.GetCurrentDirectory(), "..", "shared", ".env");
            if (File.Exists(envPath))
            {
                Env.Load(envPath);
                Console.WriteLine($"üìÑ Loaded environment from: {envPath}");
            }
            else
            {
                // Fallback to local .env
                Env.Load(".env");
            }

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharePointConnectionName = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_NAME");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");

            if (string.IsNullOrEmpty(projectEndpoint))
                throw new InvalidOperationException("PROJECT_ENDPOINT environment variable not set");
            if (string.IsNullOrEmpty(modelDeploymentName))
                throw new InvalidOperationException("MODEL_DEPLOYMENT_NAME environment variable not set");

            Console.WriteLine("\nü§ñ Creating Modern Workplace Assistant...");

            // ============================================================================
            // AUTHENTICATION SETUP
            // ============================================================================
            // <agent_authentication>
            var credential = new DefaultAzureCredential();

            projectClient = new AIProjectClient(new Uri(projectEndpoint), credential);
            Console.WriteLine($"‚úÖ Connected to Azure AI Foundry: {projectEndpoint}");
            // </agent_authentication>

            // ========================================================================
            // SHAREPOINT INTEGRATION SETUP
            // ========================================================================
            // <sharepoint_connection_resolution>
            SharepointAgentTool? sharepointTool = null;

            if (!string.IsNullOrEmpty(sharePointConnectionName))
            {
                Console.WriteLine($"üìÅ Configuring SharePoint integration...");
                Console.WriteLine($"   Connection name: {sharePointConnectionName}");

                try
                {
                    // <sharepoint_tool_setup>
                    // Resolve connection name to connection ID via the Connections API
                    AIProjectConnection sharepointConnection = await projectClient.Connections.GetConnectionAsync(
                        sharePointConnectionName, includeCredentials: false);

                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnection.Id) }
                    };
                    sharepointTool = new SharepointAgentTool(sharepointToolOption);
                    Console.WriteLine($"‚úÖ SharePoint tool configured successfully");
                    // </sharepoint_tool_setup>
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint connection unavailable: {ex.Message}");
                    Console.WriteLine($"   Possible causes:");
                    Console.WriteLine($"   - Connection '{sharePointConnectionName}' doesn't exist in the project");
                    Console.WriteLine($"   - Insufficient permissions to access the connection");
                    Console.WriteLine($"   - Connection configuration is incomplete");
                    Console.WriteLine($"   Agent will operate without SharePoint access");
                }
            }
            else
            {
                Console.WriteLine($"üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)");
            }
            // </sharepoint_connection_resolution>

            // ========================================================================
            // MICROSOFT LEARN MCP INTEGRATION SETUP
            // ========================================================================
            // <mcp_tool_setup>
            // MCP (Model Context Protocol) enables agents to access external data sources
            // like Microsoft Learn documentation. The approval flow is handled in ChatWithAssistantAsync.
            McpTool? mcpTool = null;

            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                Console.WriteLine($"üìö Configuring Microsoft Learn MCP integration...");
                Console.WriteLine($"   Server URL: {mcpServerUrl}");

                try
                {
                    // Create MCP tool for Microsoft Learn documentation access
                    // server_label must match pattern: ^[a-zA-Z0-9_]+$ (alphanumeric and underscores only)
                    mcpTool = new McpTool("Microsoft_Learn_Documentation", new Uri(mcpServerUrl));
                    Console.WriteLine($"‚úÖ MCP tool configured successfully");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP tool unavailable: {ex.Message}");
                    Console.WriteLine($"   Agent will operate without Microsoft Learn access");
                }
            }
            else
            {
                Console.WriteLine($"üìö MCP integration skipped (MCP_SERVER_URL not set)");
            }
            // </mcp_tool_setup>

            // ========================================================================
            // AGENT CREATION WITH DYNAMIC CAPABILITIES
            // ========================================================================
            // Create agent instructions based on available data sources
            string instructions = GetAgentInstructions(sharepointTool != null, mcpTool != null);

            // <create_agent_with_tools>
            // Create the agent using the v2 SDK with PromptAgentDefinition
            Console.WriteLine($"üõ†Ô∏è  Creating agent with model: {modelDeploymentName}");

            var agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add tools to the agent definition
            if (sharepointTool != null)
            {
                agentDefinition.Tools.Add(sharepointTool);
                Console.WriteLine($"   ‚úì SharePoint tool added");
            }

            if (mcpTool != null)
            {
                agentDefinition.Tools.Add(mcpTool);
                Console.WriteLine($"   ‚úì MCP tool added");
            }

            Console.WriteLine($"   Total tools: {agentDefinition.Tools.Count}");

            // Create agent version
            AgentVersion agentVersion = await projectClient.Agents.CreateAgentVersionAsync(
                agentName: agentName,
                options: new(agentDefinition));

            // Create a response client bound to this agent for conversations
            responseClient = projectClient.OpenAI
                .GetProjectResponsesClientForAgent(agentVersion);

            Console.WriteLine($"‚úÖ Agent created successfully: {agentVersion.Name} (version {agentVersion.Version})");
            return agentVersion;
            // </create_agent_with_tools>
        }

        /// <summary>
        /// Generate agent instructions based on available tools.
        /// </summary>
        private static string GetAgentInstructions(bool hasSharePoint, bool hasMcp)
        {
            if (hasSharePoint && hasMcp)
            {
                return @"You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation and best practices
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance
    - Explain how internal requirements connect to external implementation steps

    EXAMPLE SCENARIOS:
    - ""What is our MFA policy?"" ‚Üí Search SharePoint for security policies
    - ""How do I configure Azure AD Conditional Access?"" ‚Üí Use Microsoft Learn for technical steps
    - ""Our policy requires MFA - how do I implement this?"" ‚Üí Combine policy requirements with implementation guidance";
            }
            else if (hasSharePoint)
            {
                return @"You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices

    RESPONSE STRATEGY:
    - Search SharePoint for company-specific requirements
    - Provide technical guidance based on Azure and M365 best practices
    - Explain how to align implementations with company policies";
            }
            else if (hasMcp)
            {
                return @"You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options

    RESPONSE STRATEGY:
    - Use Microsoft Learn for technical documentation
    - Provide comprehensive implementation guidance
    - Reference official documentation and best practices";
            }
            else
            {
                return @"You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations

    RESPONSE STRATEGY:
    - Provide comprehensive technical guidance
    - Include step-by-step implementation instructions
    - Reference best practices and security considerations";
            }
        }

        /// <summary>
        /// Demonstrate realistic business scenarios.
        /// 
        /// This function showcases the practical value of the Modern Workplace Assistant
        /// by walking through scenarios that enterprise employees face regularly.
        /// 
        /// Educational Value:
        /// - Shows real business problems that AI agents can solve
        /// - Demonstrates the Responses API conversation pattern
        /// - Illustrates conversation patterns with tool usage
        /// </summary>
        private static async Task DemonstrateBusinessScenariosAsync(AgentVersion agentVersion)
        {
            var scenarios = new[]
            {
                new
                {
                    Title = "üìã Company Policy Question (SharePoint Only)",
                    Question = "What is Contoso's remote work policy?",
                    Context = "Employee needs to understand company-specific remote work requirements",
                    LearningPoint = "SharePoint tool retrieves internal company policies"
                },
                new
                {
                    Title = "üìö Technical Documentation Question (MCP Only)",
                    Question = "According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.",
                    Context = "IT administrator needs authoritative Microsoft technical guidance",
                    LearningPoint = "MCP tool accesses Microsoft Learn for official documentation with links"
                },
                new
                {
                    Title = "üîÑ Combined Implementation Question (SharePoint + MCP)",
                    Question = "Based on our company's remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.",
                    Context = "Need to map company policy to technical implementation with official guidance",
                    LearningPoint = "Both tools work together: SharePoint for policy + MCP for implementation docs"
                }
            };

            Console.WriteLine("\n" + "".PadRight(70, '='));
            Console.WriteLine("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION");
            Console.WriteLine("".PadRight(70, '='));
            Console.WriteLine("This demonstration shows how AI agents solve real business problems");
            Console.WriteLine("using the Azure AI Projects v2 SDK with the Responses API.");
            Console.WriteLine("".PadRight(70, '='));

            for (int i = 0; i < scenarios.Length; i++)
            {
                var scenario = scenarios[i];
                Console.WriteLine($"\nüìä SCENARIO {i + 1}/{scenarios.Length}: {scenario.Title}");
                Console.WriteLine("".PadRight(50, '-'));
                Console.WriteLine($"‚ùì QUESTION: {scenario.Question}");
                Console.WriteLine($"üéØ BUSINESS CONTEXT: {scenario.Context}");
                Console.WriteLine($"üéì LEARNING POINT: {scenario.LearningPoint}");
                Console.WriteLine("".PadRight(50, '-'));

                // <agent_conversation>
                Console.WriteLine("ü§ñ ASSISTANT RESPONSE:");
                var (response, status) = await ChatWithAssistantAsync(scenario.Question);
                // </agent_conversation>

                // Display response with analysis
                if (status == "completed" && !string.IsNullOrWhiteSpace(response) && response.Length > 10)
                {
                    var preview = response.Length > 500 ? response.Substring(0, 500) + "..." : response;
                    Console.WriteLine($"‚úÖ SUCCESS: {preview}");
                    if (response.Length > 500)
                    {
                        Console.WriteLine($"   üìè Full response: {response.Length} characters");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ö†Ô∏è  RESPONSE: {response}");
                }

                Console.WriteLine($"üìà STATUS: {status}");
                Console.WriteLine("".PadRight(50, '-'));

                // Small delay between scenarios
                await Task.Delay(1000);
            }

            Console.WriteLine("\n‚úÖ DEMONSTRATION COMPLETED!");
            Console.WriteLine("üéì Key Learning Outcomes:");
            Console.WriteLine("   ‚Ä¢ Azure AI Projects v2 SDK with PromptAgentDefinition");
            Console.WriteLine("   ‚Ä¢ Responses API for agent conversations");
            Console.WriteLine("   ‚Ä¢ SharePoint + MCP tool integration");
            Console.WriteLine("   ‚Ä¢ MCP tool approval handling via the Responses API");
            Console.WriteLine("   ‚Ä¢ Real business value through AI assistance");
            Console.WriteLine("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)");
        }

        /// <summary>
        /// Execute a conversation with the workplace assistant using the Responses API.
        /// 
        /// This function demonstrates the v2 conversation pattern including:
        /// - Sending a request via ProjectResponsesClient
        /// - MCP tool approval handling through the Responses API approval loop
        /// - Proper error and timeout management
        /// 
        /// Educational Value:
        /// - Shows the Responses API conversation pattern (replaces threads/runs)
        /// - Demonstrates MCP approval via McpToolCallApprovalRequestItem
        /// - Includes timeout and error management patterns
        /// </summary>
        // <mcp_approval_handler>
        private static async Task<(string response, string status)> ChatWithAssistantAsync(string message)
        {
            try
            {
                // Send the user message via the Responses API
                ResponseResult response = await responseClient!.CreateResponseAsync(message);

                // <mcp_approval_usage>
                // Handle MCP tool approval loop.
                // When the agent uses MCP tools, the response may contain
                // McpToolCallApprovalRequestItem items. We auto-approve and re-send.
                int maxIterations = 30;
                int iteration = 0;

                while (iteration < maxIterations)
                {
                    // Check for MCP approval requests in the output items
                    var approvalRequests = response.OutputItems
                        .OfType<McpToolCallApprovalRequestItem>()
                        .ToList();

                    if (approvalRequests.Count == 0) break;

                    // Build approval response items
                    var approvalItems = new List<ResponseItem>();
                    foreach (var request in approvalRequests)
                    {
                        Console.WriteLine($"   üîß Approving MCP tool: {request.ToolName}");

                        // Auto-approve MCP tool calls
                        // In production, you might implement custom approval logic here:
                        // - RBAC checks (is user authorized for this tool?)
                        // - Cost controls (has budget limit been reached?)
                        // - Logging and auditing
                        // - Interactive approval prompts
                        approvalItems.Add(ResponseItem.CreateMcpApprovalResponseItem(
                            request.Id,
                            approved: true));
                    }

                    // Send approval responses, chained to the previous response
                    response = await responseClient.CreateResponseAsync(
                        approvalItems,
                        previousResponseId: response.Id);
                    iteration++;
                }
                // </mcp_approval_usage>

                // Extract the text output
                string? outputText = response.GetOutputText();

                if (!string.IsNullOrWhiteSpace(outputText) && outputText.Length > 0)
                {
                    return (outputText, "completed");
                }
                else
                {
                    return ("No response from assistant", "completed");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Exception details: {ex.GetType().Name}: {ex.Message}");
                if (ex.InnerException != null)
                {
                    Console.WriteLine($"   Inner: {ex.InnerException.Message}");
                }
                return ($"Error in conversation: {ex.Message}", "failed");
            }
        }
        // </mcp_approval_handler>

        /// <summary>
        /// Interactive mode for testing the workplace assistant.
        /// 
        /// This provides a simple interface for users to test the agent with their own questions
        /// and see how it provides comprehensive technical guidance.
        /// Uses PreviousResponseId to maintain conversation context across turns.
        /// </summary>
        private static async Task InteractiveModeAsync(AgentVersion agentVersion)
        {
            Console.WriteLine("\n" + "".PadRight(60, '='));
            Console.WriteLine("üí¨ INTERACTIVE MODE - Test Your Workplace Assistant!");
            Console.WriteLine("".PadRight(60, '='));
            Console.WriteLine("Ask questions about Azure, M365, security, and technical implementation:");
            Console.WriteLine("‚Ä¢ 'How do I configure Azure AD conditional access?'");
            Console.WriteLine("‚Ä¢ 'What are MFA best practices for remote workers?'");
            Console.WriteLine("‚Ä¢ 'How do I set up secure SharePoint access?'");
            Console.WriteLine("Type 'quit' to exit.");
            Console.WriteLine("".PadRight(60, '-'));

            while (true)
            {
                try
                {
                    Console.Write("\n‚ùì Your question: ");
                    string? question = Console.ReadLine()?.Trim();

                    if (string.IsNullOrEmpty(question))
                    {
                        Console.WriteLine("üí° Please ask a question about Azure or M365 technical implementation.");
                        continue;
                    }

                    if (question.ToLower() is "quit" or "exit" or "bye")
                    {
                        break;
                    }

                    Console.Write("\nü§ñ Workplace Assistant: ");
                    var (response, status) = await ChatWithAssistantAsync(question);
                    Console.WriteLine(response);

                    if (status != "completed")
                    {
                        Console.WriteLine($"\n‚ö†Ô∏è  Response status: {status}");
                    }

                    Console.WriteLine("".PadRight(60, '-'));
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                    Console.WriteLine("".PadRight(60, '-'));
                }
            }

            Console.WriteLine("\nüëã Thank you for testing the Modern Workplace Assistant!");
        }
    }
    ```
</CodeGroup>

### Configure authentication in Azure

Before you create your agent, set up authentication to the Foundry.

<CodeGroup>
```python Python
    #!/usr/bin/env python3
    """
    Microsoft Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant

    This sample demonstrates a complete business scenario using the Microsoft Foundry SDK:
    - Agent creation with PromptAgentDefinition
    - Conversation management via the Responses API
    - Robust error handling and graceful degradation

    Educational Focus:
    - Enterprise AI patterns with the Microsoft Foundry SDK
    - Real-world business scenarios that enterprises face daily
    - Production-ready error handling and diagnostics
    - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)

    Business Scenario:
    An employee needs to implement Azure AD multi-factor authentication. They need:
    1. Company security policy requirements
    2. Technical implementation steps
    3. Combined guidance showing how policy requirements map to technical implementation
    """

    # <imports_and_includes>
    import os
    import time
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import (
        PromptAgentDefinition,
        SharepointPreviewTool,
        SharepointGroundingToolParameters,
        ToolProjectConnection,
        MCPTool,
    )
    from azure.identity import DefaultAzureCredential
    from dotenv import load_dotenv
    from openai.types.responses.response_input_param import (
        McpApprovalResponse,
    )
    # </imports_and_includes>

    load_dotenv()

    # ============================================================================
    # AUTHENTICATION SETUP
    # ============================================================================
    endpoint = os.environ["PROJECT_ENDPOINT"]

    def create_workplace_assistant(project_client):
        """
        Create a Modern Workplace Assistant using the Microsoft Foundry SDK.

        This demonstrates enterprise AI patterns:
        1. Agent creation with PromptAgentDefinition
        2. Robust error handling with graceful degradation
        3. Dynamic agent capabilities based on available resources
        4. Clear diagnostic information for troubleshooting

        Returns:
            agent: The created agent object
        """

        print("ü§ñ Creating Modern Workplace Assistant...")

        # ========================================================================
        # SHAREPOINT INTEGRATION SETUP
        # ========================================================================
        # <sharepoint_tool_setup>
        sharepoint_connection_id = os.environ.get("SHAREPOINT_CONNECTION_ID")
        sharepoint_tool = None

        if sharepoint_connection_id:
            print("üìÅ Configuring SharePoint integration...")
            print(f"   Connection ID: {sharepoint_connection_id}")

            try:
                sharepoint_tool = SharepointPreviewTool(
                    sharepoint_grounding_preview=SharepointGroundingToolParameters(
                        project_connections=[
                            ToolProjectConnection(
                                project_connection_id=sharepoint_connection_id
                            )
                        ]
                    )
                )
                print("‚úÖ SharePoint tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  SharePoint tool unavailable: {e}")
                print("   Agent will operate without SharePoint access")
                sharepoint_tool = None
        else:
            print("üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_ID not set)")
        # </sharepoint_tool_setup>

        # ========================================================================
        # MICROSOFT LEARN MCP INTEGRATION SETUP
        # ========================================================================
        # <mcp_tool_setup>
        mcp_server_url = os.environ.get("MCP_SERVER_URL")
        mcp_tool = None

        if mcp_server_url:
            print("üìö Configuring Microsoft Learn MCP integration...")
            print(f"   Server URL: {mcp_server_url}")

            try:
                mcp_tool = MCPTool(
                    server_url=mcp_server_url,
                    server_label="Microsoft_Learn_Documentation",
                    require_approval="always",
                )
                print("‚úÖ MCP tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  MCP tool unavailable: {e}")
                print("   Agent will operate without Microsoft Learn access")
                mcp_tool = None
        else:
            print("üìö MCP integration skipped (MCP_SERVER_URL not set)")
        # </mcp_tool_setup>

        # ========================================================================
        # AGENT CREATION WITH DYNAMIC CAPABILITIES
        # ========================================================================
        if sharepoint_tool and mcp_tool:
            instructions = """You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance"""
        elif sharepoint_tool:
            instructions = """You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices"""
        elif mcp_tool:
            instructions = """You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options"""
        else:
            instructions = """You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations"""

        # <create_agent_with_tools>
        print(f"üõ†Ô∏è  Creating agent with model: {os.environ['MODEL_DEPLOYMENT_NAME']}")

        tools = []
        if sharepoint_tool:
            tools.append(sharepoint_tool)
            print("   ‚úì SharePoint tool added")
        if mcp_tool:
            tools.append(mcp_tool)
            print("   ‚úì MCP tool added")

        print(f"   Total tools: {len(tools)}")

        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=os.environ["MODEL_DEPLOYMENT_NAME"],
                instructions=instructions,
                tools=tools if tools else None,
            ),
        )

        print(f"‚úÖ Agent created successfully (name: {agent.name}, version: {agent.version})")
        return agent
        # </create_agent_with_tools>

    def demonstrate_business_scenarios(agent, openai_client):
        """
        Demonstrate realistic business scenarios with the Microsoft Foundry SDK.

        This function showcases the practical value of the Modern Workplace Assistant
        by walking through scenarios that enterprise employees face regularly.
        """

        scenarios = [
            {
                "title": "üìã Company Policy Question (SharePoint Only)",
                "question": "What is Contoso's remote work policy?",
                "context": "Employee needs to understand company-specific remote work requirements",
                "learning_point": "SharePoint tool retrieves internal company policies",
            },
            {
                "title": "üìö Technical Documentation Question (MCP Only)",
                "question": (
                    "According to Microsoft Learn, what is the correct way to implement "
                    "Azure AD Conditional Access policies? Please include reference links "
                    "to the official documentation."
                ),
                "context": "IT administrator needs authoritative Microsoft technical guidance",
                "learning_point": "MCP tool accesses Microsoft Learn for official documentation with links",
            },
            {
                "title": "üîÑ Combined Implementation Question (SharePoint + MCP)",
                "question": (
                    "Based on our company's remote work security policy, how should I configure "
                    "my Azure environment to comply? Please include links to Microsoft "
                    "documentation showing how to implement each requirement."
                ),
                "context": "Need to map company policy to technical implementation with official guidance",
                "learning_point": "Both tools work together: SharePoint for policy + MCP for implementation docs",
            },
        ]

        print("\n" + "=" * 70)
        print("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION")
        print("=" * 70)
        print("This demonstration shows how AI agents solve real business problems")
        print("using the Microsoft Foundry SDK.")
        print("=" * 70)

        for i, scenario in enumerate(scenarios, 1):
            print(f"\nüìä SCENARIO {i}/3: {scenario['title']}")
            print("-" * 50)
            print(f"‚ùì QUESTION: {scenario['question']}")
            print(f"üéØ BUSINESS CONTEXT: {scenario['context']}")
            print(f"üéì LEARNING POINT: {scenario['learning_point']}")
            print("-" * 50)

            # <agent_conversation>
            print("ü§ñ AGENT RESPONSE:")
            response, status = create_agent_response(agent, scenario["question"], openai_client)
            # </agent_conversation>

            if status == "completed" and response and len(response.strip()) > 10:
                print(f"‚úÖ SUCCESS: {response[:300]}...")
                if len(response) > 300:
                    print(f"   üìè Full response: {len(response)} characters")
            else:
                print(f"‚ö†Ô∏è  RESPONSE: {response}")

            print(f"üìà STATUS: {status}")
            print("-" * 50)

            time.sleep(1)

        print("\n‚úÖ DEMONSTRATION COMPLETED!")
        print("üéì Key Learning Outcomes:")
        print("   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI")
        print("   ‚Ä¢ Conversation management via the Responses API")
        print("   ‚Ä¢ Real business value through AI assistance")
        print("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)")

        return True

    def create_agent_response(agent, message, openai_client):
        """
        Create a response from the workplace agent using the Responses API.

        This function demonstrates the response pattern for the Microsoft Foundry SDK
        including MCP tool approval handling.

        Args:
            agent: The agent object (with .name attribute)
            message: The user's message

        Returns:
            tuple: (response_text, status)
        """

        try:
            response = openai_client.responses.create(
                input=message,
                extra_body={
                    "agent": {"name": agent.name, "type": "agent_reference"}
                },
            )

            # Handle MCP approval requests if present
            approval_list = []
            for item in response.output:
                if item.type == "mcp_approval_request" and item.id:
                    approval_list.append(
                        McpApprovalResponse(
                            type="mcp_approval_response",
                            approve=True,
                            approval_request_id=item.id,
                        )
                    )

            if approval_list:
                response = openai_client.responses.create(
                    input=approval_list,
                    previous_response_id=response.id,
                    extra_body={
                        "agent": {"name": agent.name, "type": "agent_reference"}
                    },
                )

            return response.output_text, "completed"

        except Exception as e:
            return f"Error in conversation: {str(e)}", "failed"

    def interactive_mode(agent, openai_client):
        """Interactive mode for testing the workplace agent."""

        print("\n" + "=" * 60)
        print("üí¨ INTERACTIVE MODE - Test Your Workplace Agent!")
        print("=" * 60)
        print("Ask questions about Azure, M365, security, and technical implementation.")
        print("Type 'quit' to exit.")
        print("-" * 60)

        while True:
            try:
                question = input("\n‚ùì Your question: ").strip()

                if question.lower() in ["quit", "exit", "bye"]:
                    break

                if not question:
                    print("üí° Please ask a question about Azure or M365 technical implementation.")
                    continue

                print("\nü§ñ Workplace Agent: ", end="", flush=True)
                response, status = create_agent_response(agent, question, openai_client)
                print(response)

                if status != "completed":
                    print(f"\n‚ö†Ô∏è  Response status: {status}")

                print("-" * 60)

            except KeyboardInterrupt:
                break
            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("-" * 60)

        print("\nüëã Thank you for testing the Modern Workplace Agent!")

    def main():
        """Main execution flow demonstrating the complete sample."""

        print("üöÄ Foundry - Modern Workplace Assistant")
        print("Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK")
        print("=" * 70)

        # <agent_authentication>
        with (
            DefaultAzureCredential() as credential,
            AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
            project_client.get_openai_client() as openai_client,
        ):
            print(f"‚úÖ Connected to Foundry: {endpoint}")
        # </agent_authentication>

            try:
                agent = create_workplace_assistant(project_client)
                demonstrate_business_scenarios(agent, openai_client)

                print("\nüéØ Try interactive mode? (y/n): ", end="")
                try:
                    if input().lower().startswith("y"):
                        interactive_mode(agent, openai_client)
                except EOFError:
                    print("n")

                print("\nüéâ Sample completed successfully!")
                print("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)")
                print("üîó Next: Add evaluation metrics, monitoring, and production deployment")

            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("Please check your .env configuration and ensure:")
                print("  - PROJECT_ENDPOINT is correct")
                print("  - MODEL_DEPLOYMENT_NAME is deployed")
                print("  - Azure credentials are configured (az login)")

    if __name__ == "__main__":
        main()
    ```

```csharp C#
    // <imports_and_includes>
    using System;
    using System.ClientModel;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Threading.Tasks;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    // </imports_and_includes>

    #pragma warning disable OPENAI001

    /*
     * Azure AI Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant (C#)
     * 
     * This sample demonstrates a complete business scenario using the Azure AI Projects v2 SDK:
     * - Agent creation with PromptAgentDefinition and AgentVersion
     * - Conversation via the Responses API (ProjectResponsesClient)
     * - SharePoint and MCP tool integration on the agent definition
     * - MCP tool approval handling through the Responses API approval loop
     * - Robust error handling and graceful degradation
     * 
     * Educational Focus:
     * - Enterprise AI patterns with the v2 Azure AI Projects SDK
     * - Real-world business scenarios that enterprises face daily
     * - Production-ready error handling and diagnostics
     * - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)
     * 
     * Business Scenario:
     * An employee needs to implement Azure AD multi-factor authentication. They need:
     * 1. Company security policy requirements (from SharePoint)
     * 2. Technical implementation steps (from Microsoft Learn via MCP)
     * 3. Combined guidance showing how policy requirements map to technical implementation
     */

    class Program
    {
        private static AIProjectClient? projectClient;
        private static ProjectResponsesClient? responseClient;
        private static string agentName = "Modern_Workplace_Assistant";

        static async Task Main(string[] args)
        {
            Console.WriteLine("üöÄ Azure AI Foundry - Modern Workplace Assistant");
            Console.WriteLine("Tutorial 1: Building Enterprise Agents with SharePoint + MCP Tools");
            Console.WriteLine("".PadRight(70, '='));

            try
            {
                // Create the agent with full diagnostic output
                var agentVersion = await CreateWorkplaceAssistantAsync();

                // Demonstrate business scenarios
                await DemonstrateBusinessScenariosAsync(agentVersion);

                // Offer interactive testing
                Console.Write("\nüéØ Try interactive mode? (y/n): ");
                var response = Console.ReadLine();
                if (response?.ToLower().StartsWith("y") == true)
                {
                    await InteractiveModeAsync(agentVersion);
                }

                // Cleanup
                Console.WriteLine("\nüßπ Cleaning up agent...");
                await projectClient!.Agents.DeleteAgentVersionAsync(
                    agentName: agentVersion.Name,
                    agentVersion: agentVersion.Version);
                Console.WriteLine("‚úÖ Agent deleted");

                Console.WriteLine("\nüéâ Sample completed successfully!");
                Console.WriteLine("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)");
                Console.WriteLine("üîó Next: Add evaluation metrics, monitoring, and production deployment");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                Console.WriteLine("Please check your .env configuration and ensure:");
                Console.WriteLine("  - PROJECT_ENDPOINT is correct");
                Console.WriteLine("  - MODEL_DEPLOYMENT_NAME is deployed");
                Console.WriteLine("  - Azure credentials are configured (az login)");
                throw;
            }
        }

        /// <summary>
        /// Create a Modern Workplace Assistant with SharePoint and MCP tools.
        /// 
        /// This demonstrates enterprise AI patterns:
        /// 1. Agent creation with PromptAgentDefinition and CreateAgentVersionAsync
        /// 2. SharePoint integration via SharepointAgentTool
        /// 3. MCP integration via McpTool from the OpenAI Responses API
        /// 4. Robust error handling with graceful degradation
        /// 5. Dynamic agent capabilities based on available resources
        /// 
        /// Educational Value:
        /// - Shows real-world complexity of enterprise AI systems
        /// - Demonstrates how to handle partial system failures
        /// - Provides patterns for agent creation with multiple tools
        /// </summary>
        private static async Task<AgentVersion> CreateWorkplaceAssistantAsync()
        {
            // Load environment variables from shared .env file
            var envPath = Path.Combine(Directory.GetCurrentDirectory(), "..", "shared", ".env");
            if (File.Exists(envPath))
            {
                Env.Load(envPath);
                Console.WriteLine($"üìÑ Loaded environment from: {envPath}");
            }
            else
            {
                // Fallback to local .env
                Env.Load(".env");
            }

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharePointConnectionName = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_NAME");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");

            if (string.IsNullOrEmpty(projectEndpoint))
                throw new InvalidOperationException("PROJECT_ENDPOINT environment variable not set");
            if (string.IsNullOrEmpty(modelDeploymentName))
                throw new InvalidOperationException("MODEL_DEPLOYMENT_NAME environment variable not set");

            Console.WriteLine("\nü§ñ Creating Modern Workplace Assistant...");

            // ============================================================================
            // AUTHENTICATION SETUP
            // ============================================================================
            // <agent_authentication>
            var credential = new DefaultAzureCredential();

            projectClient = new AIProjectClient(new Uri(projectEndpoint), credential);
            Console.WriteLine($"‚úÖ Connected to Azure AI Foundry: {projectEndpoint}");
            // </agent_authentication>

            // ========================================================================
            // SHAREPOINT INTEGRATION SETUP
            // ========================================================================
            // <sharepoint_connection_resolution>
            SharepointAgentTool? sharepointTool = null;

            if (!string.IsNullOrEmpty(sharePointConnectionName))
            {
                Console.WriteLine($"üìÅ Configuring SharePoint integration...");
                Console.WriteLine($"   Connection name: {sharePointConnectionName}");

                try
                {
                    // <sharepoint_tool_setup>
                    // Resolve connection name to connection ID via the Connections API
                    AIProjectConnection sharepointConnection = await projectClient.Connections.GetConnectionAsync(
                        sharePointConnectionName, includeCredentials: false);

                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnection.Id) }
                    };
                    sharepointTool = new SharepointAgentTool(sharepointToolOption);
                    Console.WriteLine($"‚úÖ SharePoint tool configured successfully");
                    // </sharepoint_tool_setup>
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint connection unavailable: {ex.Message}");
                    Console.WriteLine($"   Possible causes:");
                    Console.WriteLine($"   - Connection '{sharePointConnectionName}' doesn't exist in the project");
                    Console.WriteLine($"   - Insufficient permissions to access the connection");
                    Console.WriteLine($"   - Connection configuration is incomplete");
                    Console.WriteLine($"   Agent will operate without SharePoint access");
                }
            }
            else
            {
                Console.WriteLine($"üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)");
            }
            // </sharepoint_connection_resolution>

            // ========================================================================
            // MICROSOFT LEARN MCP INTEGRATION SETUP
            // ========================================================================
            // <mcp_tool_setup>
            // MCP (Model Context Protocol) enables agents to access external data sources
            // like Microsoft Learn documentation. The approval flow is handled in ChatWithAssistantAsync.
            McpTool? mcpTool = null;

            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                Console.WriteLine($"üìö Configuring Microsoft Learn MCP integration...");
                Console.WriteLine($"   Server URL: {mcpServerUrl}");

                try
                {
                    // Create MCP tool for Microsoft Learn documentation access
                    // server_label must match pattern: ^[a-zA-Z0-9_]+$ (alphanumeric and underscores only)
                    mcpTool = new McpTool("Microsoft_Learn_Documentation", new Uri(mcpServerUrl));
                    Console.WriteLine($"‚úÖ MCP tool configured successfully");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP tool unavailable: {ex.Message}");
                    Console.WriteLine($"   Agent will operate without Microsoft Learn access");
                }
            }
            else
            {
                Console.WriteLine($"üìö MCP integration skipped (MCP_SERVER_URL not set)");
            }
            // </mcp_tool_setup>

            // ========================================================================
            // AGENT CREATION WITH DYNAMIC CAPABILITIES
            // ========================================================================
            // Create agent instructions based on available data sources
            string instructions = GetAgentInstructions(sharepointTool != null, mcpTool != null);

            // <create_agent_with_tools>
            // Create the agent using the v2 SDK with PromptAgentDefinition
            Console.WriteLine($"üõ†Ô∏è  Creating agent with model: {modelDeploymentName}");

            var agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add tools to the agent definition
            if (sharepointTool != null)
            {
                agentDefinition.Tools.Add(sharepointTool);
                Console.WriteLine($"   ‚úì SharePoint tool added");
            }

            if (mcpTool != null)
            {
                agentDefinition.Tools.Add(mcpTool);
                Console.WriteLine($"   ‚úì MCP tool added");
            }

            Console.WriteLine($"   Total tools: {agentDefinition.Tools.Count}");

            // Create agent version
            AgentVersion agentVersion = await projectClient.Agents.CreateAgentVersionAsync(
                agentName: agentName,
                options: new(agentDefinition));

            // Create a response client bound to this agent for conversations
            responseClient = projectClient.OpenAI
                .GetProjectResponsesClientForAgent(agentVersion);

            Console.WriteLine($"‚úÖ Agent created successfully: {agentVersion.Name} (version {agentVersion.Version})");
            return agentVersion;
            // </create_agent_with_tools>
        }

        /// <summary>
        /// Generate agent instructions based on available tools.
        /// </summary>
        private static string GetAgentInstructions(bool hasSharePoint, bool hasMcp)
        {
            if (hasSharePoint && hasMcp)
            {
                return @"You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation and best practices
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance
    - Explain how internal requirements connect to external implementation steps

    EXAMPLE SCENARIOS:
    - ""What is our MFA policy?"" ‚Üí Search SharePoint for security policies
    - ""How do I configure Azure AD Conditional Access?"" ‚Üí Use Microsoft Learn for technical steps
    - ""Our policy requires MFA - how do I implement this?"" ‚Üí Combine policy requirements with implementation guidance";
            }
            else if (hasSharePoint)
            {
                return @"You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices

    RESPONSE STRATEGY:
    - Search SharePoint for company-specific requirements
    - Provide technical guidance based on Azure and M365 best practices
    - Explain how to align implementations with company policies";
            }
            else if (hasMcp)
            {
                return @"You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options

    RESPONSE STRATEGY:
    - Use Microsoft Learn for technical documentation
    - Provide comprehensive implementation guidance
    - Reference official documentation and best practices";
            }
            else
            {
                return @"You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations

    RESPONSE STRATEGY:
    - Provide comprehensive technical guidance
    - Include step-by-step implementation instructions
    - Reference best practices and security considerations";
            }
        }

        /// <summary>
        /// Demonstrate realistic business scenarios.
        /// 
        /// This function showcases the practical value of the Modern Workplace Assistant
        /// by walking through scenarios that enterprise employees face regularly.
        /// 
        /// Educational Value:
        /// - Shows real business problems that AI agents can solve
        /// - Demonstrates the Responses API conversation pattern
        /// - Illustrates conversation patterns with tool usage
        /// </summary>
        private static async Task DemonstrateBusinessScenariosAsync(AgentVersion agentVersion)
        {
            var scenarios = new[]
            {
                new
                {
                    Title = "üìã Company Policy Question (SharePoint Only)",
                    Question = "What is Contoso's remote work policy?",
                    Context = "Employee needs to understand company-specific remote work requirements",
                    LearningPoint = "SharePoint tool retrieves internal company policies"
                },
                new
                {
                    Title = "üìö Technical Documentation Question (MCP Only)",
                    Question = "According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.",
                    Context = "IT administrator needs authoritative Microsoft technical guidance",
                    LearningPoint = "MCP tool accesses Microsoft Learn for official documentation with links"
                },
                new
                {
                    Title = "üîÑ Combined Implementation Question (SharePoint + MCP)",
                    Question = "Based on our company's remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.",
                    Context = "Need to map company policy to technical implementation with official guidance",
                    LearningPoint = "Both tools work together: SharePoint for policy + MCP for implementation docs"
                }
            };

            Console.WriteLine("\n" + "".PadRight(70, '='));
            Console.WriteLine("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION");
            Console.WriteLine("".PadRight(70, '='));
            Console.WriteLine("This demonstration shows how AI agents solve real business problems");
            Console.WriteLine("using the Azure AI Projects v2 SDK with the Responses API.");
            Console.WriteLine("".PadRight(70, '='));

            for (int i = 0; i < scenarios.Length; i++)
            {
                var scenario = scenarios[i];
                Console.WriteLine($"\nüìä SCENARIO {i + 1}/{scenarios.Length}: {scenario.Title}");
                Console.WriteLine("".PadRight(50, '-'));
                Console.WriteLine($"‚ùì QUESTION: {scenario.Question}");
                Console.WriteLine($"üéØ BUSINESS CONTEXT: {scenario.Context}");
                Console.WriteLine($"üéì LEARNING POINT: {scenario.LearningPoint}");
                Console.WriteLine("".PadRight(50, '-'));

                // <agent_conversation>
                Console.WriteLine("ü§ñ ASSISTANT RESPONSE:");
                var (response, status) = await ChatWithAssistantAsync(scenario.Question);
                // </agent_conversation>

                // Display response with analysis
                if (status == "completed" && !string.IsNullOrWhiteSpace(response) && response.Length > 10)
                {
                    var preview = response.Length > 500 ? response.Substring(0, 500) + "..." : response;
                    Console.WriteLine($"‚úÖ SUCCESS: {preview}");
                    if (response.Length > 500)
                    {
                        Console.WriteLine($"   üìè Full response: {response.Length} characters");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ö†Ô∏è  RESPONSE: {response}");
                }

                Console.WriteLine($"üìà STATUS: {status}");
                Console.WriteLine("".PadRight(50, '-'));

                // Small delay between scenarios
                await Task.Delay(1000);
            }

            Console.WriteLine("\n‚úÖ DEMONSTRATION COMPLETED!");
            Console.WriteLine("üéì Key Learning Outcomes:");
            Console.WriteLine("   ‚Ä¢ Azure AI Projects v2 SDK with PromptAgentDefinition");
            Console.WriteLine("   ‚Ä¢ Responses API for agent conversations");
            Console.WriteLine("   ‚Ä¢ SharePoint + MCP tool integration");
            Console.WriteLine("   ‚Ä¢ MCP tool approval handling via the Responses API");
            Console.WriteLine("   ‚Ä¢ Real business value through AI assistance");
            Console.WriteLine("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)");
        }

        /// <summary>
        /// Execute a conversation with the workplace assistant using the Responses API.
        /// 
        /// This function demonstrates the v2 conversation pattern including:
        /// - Sending a request via ProjectResponsesClient
        /// - MCP tool approval handling through the Responses API approval loop
        /// - Proper error and timeout management
        /// 
        /// Educational Value:
        /// - Shows the Responses API conversation pattern (replaces threads/runs)
        /// - Demonstrates MCP approval via McpToolCallApprovalRequestItem
        /// - Includes timeout and error management patterns
        /// </summary>
        // <mcp_approval_handler>
        private static async Task<(string response, string status)> ChatWithAssistantAsync(string message)
        {
            try
            {
                // Send the user message via the Responses API
                ResponseResult response = await responseClient!.CreateResponseAsync(message);

                // <mcp_approval_usage>
                // Handle MCP tool approval loop.
                // When the agent uses MCP tools, the response may contain
                // McpToolCallApprovalRequestItem items. We auto-approve and re-send.
                int maxIterations = 30;
                int iteration = 0;

                while (iteration < maxIterations)
                {
                    // Check for MCP approval requests in the output items
                    var approvalRequests = response.OutputItems
                        .OfType<McpToolCallApprovalRequestItem>()
                        .ToList();

                    if (approvalRequests.Count == 0) break;

                    // Build approval response items
                    var approvalItems = new List<ResponseItem>();
                    foreach (var request in approvalRequests)
                    {
                        Console.WriteLine($"   üîß Approving MCP tool: {request.ToolName}");

                        // Auto-approve MCP tool calls
                        // In production, you might implement custom approval logic here:
                        // - RBAC checks (is user authorized for this tool?)
                        // - Cost controls (has budget limit been reached?)
                        // - Logging and auditing
                        // - Interactive approval prompts
                        approvalItems.Add(ResponseItem.CreateMcpApprovalResponseItem(
                            request.Id,
                            approved: true));
                    }

                    // Send approval responses, chained to the previous response
                    response = await responseClient.CreateResponseAsync(
                        approvalItems,
                        previousResponseId: response.Id);
                    iteration++;
                }
                // </mcp_approval_usage>

                // Extract the text output
                string? outputText = response.GetOutputText();

                if (!string.IsNullOrWhiteSpace(outputText) && outputText.Length > 0)
                {
                    return (outputText, "completed");
                }
                else
                {
                    return ("No response from assistant", "completed");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Exception details: {ex.GetType().Name}: {ex.Message}");
                if (ex.InnerException != null)
                {
                    Console.WriteLine($"   Inner: {ex.InnerException.Message}");
                }
                return ($"Error in conversation: {ex.Message}", "failed");
            }
        }
        // </mcp_approval_handler>

        /// <summary>
        /// Interactive mode for testing the workplace assistant.
        /// 
        /// This provides a simple interface for users to test the agent with their own questions
        /// and see how it provides comprehensive technical guidance.
        /// Uses PreviousResponseId to maintain conversation context across turns.
        /// </summary>
        private static async Task InteractiveModeAsync(AgentVersion agentVersion)
        {
            Console.WriteLine("\n" + "".PadRight(60, '='));
            Console.WriteLine("üí¨ INTERACTIVE MODE - Test Your Workplace Assistant!");
            Console.WriteLine("".PadRight(60, '='));
            Console.WriteLine("Ask questions about Azure, M365, security, and technical implementation:");
            Console.WriteLine("‚Ä¢ 'How do I configure Azure AD conditional access?'");
            Console.WriteLine("‚Ä¢ 'What are MFA best practices for remote workers?'");
            Console.WriteLine("‚Ä¢ 'How do I set up secure SharePoint access?'");
            Console.WriteLine("Type 'quit' to exit.");
            Console.WriteLine("".PadRight(60, '-'));

            while (true)
            {
                try
                {
                    Console.Write("\n‚ùì Your question: ");
                    string? question = Console.ReadLine()?.Trim();

                    if (string.IsNullOrEmpty(question))
                    {
                        Console.WriteLine("üí° Please ask a question about Azure or M365 technical implementation.");
                        continue;
                    }

                    if (question.ToLower() is "quit" or "exit" or "bye")
                    {
                        break;
                    }

                    Console.Write("\nü§ñ Workplace Assistant: ");
                    var (response, status) = await ChatWithAssistantAsync(question);
                    Console.WriteLine(response);

                    if (status != "completed")
                    {
                        Console.WriteLine($"\n‚ö†Ô∏è  Response status: {status}");
                    }

                    Console.WriteLine("".PadRight(60, '-'));
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                    Console.WriteLine("".PadRight(60, '-'));
                }
            }

            Console.WriteLine("\nüëã Thank you for testing the Modern Workplace Assistant!");
        }
    }
    ```
</CodeGroup>

### Create the SharePoint tool for the agent

The agent uses SharePoint and can access company policy and procedure documents stored there. Set up the connection to SharePoint in your code.

<CodeGroup>
```python Python
    #!/usr/bin/env python3
    """
    Microsoft Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant

    This sample demonstrates a complete business scenario using the Microsoft Foundry SDK:
    - Agent creation with PromptAgentDefinition
    - Conversation management via the Responses API
    - Robust error handling and graceful degradation

    Educational Focus:
    - Enterprise AI patterns with the Microsoft Foundry SDK
    - Real-world business scenarios that enterprises face daily
    - Production-ready error handling and diagnostics
    - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)

    Business Scenario:
    An employee needs to implement Azure AD multi-factor authentication. They need:
    1. Company security policy requirements
    2. Technical implementation steps
    3. Combined guidance showing how policy requirements map to technical implementation
    """

    # <imports_and_includes>
    import os
    import time
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import (
        PromptAgentDefinition,
        SharepointPreviewTool,
        SharepointGroundingToolParameters,
        ToolProjectConnection,
        MCPTool,
    )
    from azure.identity import DefaultAzureCredential
    from dotenv import load_dotenv
    from openai.types.responses.response_input_param import (
        McpApprovalResponse,
    )
    # </imports_and_includes>

    load_dotenv()

    # ============================================================================
    # AUTHENTICATION SETUP
    # ============================================================================
    endpoint = os.environ["PROJECT_ENDPOINT"]

    def create_workplace_assistant(project_client):
        """
        Create a Modern Workplace Assistant using the Microsoft Foundry SDK.

        This demonstrates enterprise AI patterns:
        1. Agent creation with PromptAgentDefinition
        2. Robust error handling with graceful degradation
        3. Dynamic agent capabilities based on available resources
        4. Clear diagnostic information for troubleshooting

        Returns:
            agent: The created agent object
        """

        print("ü§ñ Creating Modern Workplace Assistant...")

        # ========================================================================
        # SHAREPOINT INTEGRATION SETUP
        # ========================================================================
        # <sharepoint_tool_setup>
        sharepoint_connection_id = os.environ.get("SHAREPOINT_CONNECTION_ID")
        sharepoint_tool = None

        if sharepoint_connection_id:
            print("üìÅ Configuring SharePoint integration...")
            print(f"   Connection ID: {sharepoint_connection_id}")

            try:
                sharepoint_tool = SharepointPreviewTool(
                    sharepoint_grounding_preview=SharepointGroundingToolParameters(
                        project_connections=[
                            ToolProjectConnection(
                                project_connection_id=sharepoint_connection_id
                            )
                        ]
                    )
                )
                print("‚úÖ SharePoint tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  SharePoint tool unavailable: {e}")
                print("   Agent will operate without SharePoint access")
                sharepoint_tool = None
        else:
            print("üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_ID not set)")
        # </sharepoint_tool_setup>

        # ========================================================================
        # MICROSOFT LEARN MCP INTEGRATION SETUP
        # ========================================================================
        # <mcp_tool_setup>
        mcp_server_url = os.environ.get("MCP_SERVER_URL")
        mcp_tool = None

        if mcp_server_url:
            print("üìö Configuring Microsoft Learn MCP integration...")
            print(f"   Server URL: {mcp_server_url}")

            try:
                mcp_tool = MCPTool(
                    server_url=mcp_server_url,
                    server_label="Microsoft_Learn_Documentation",
                    require_approval="always",
                )
                print("‚úÖ MCP tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  MCP tool unavailable: {e}")
                print("   Agent will operate without Microsoft Learn access")
                mcp_tool = None
        else:
            print("üìö MCP integration skipped (MCP_SERVER_URL not set)")
        # </mcp_tool_setup>

        # ========================================================================
        # AGENT CREATION WITH DYNAMIC CAPABILITIES
        # ========================================================================
        if sharepoint_tool and mcp_tool:
            instructions = """You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance"""
        elif sharepoint_tool:
            instructions = """You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices"""
        elif mcp_tool:
            instructions = """You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options"""
        else:
            instructions = """You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations"""

        # <create_agent_with_tools>
        print(f"üõ†Ô∏è  Creating agent with model: {os.environ['MODEL_DEPLOYMENT_NAME']}")

        tools = []
        if sharepoint_tool:
            tools.append(sharepoint_tool)
            print("   ‚úì SharePoint tool added")
        if mcp_tool:
            tools.append(mcp_tool)
            print("   ‚úì MCP tool added")

        print(f"   Total tools: {len(tools)}")

        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=os.environ["MODEL_DEPLOYMENT_NAME"],
                instructions=instructions,
                tools=tools if tools else None,
            ),
        )

        print(f"‚úÖ Agent created successfully (name: {agent.name}, version: {agent.version})")
        return agent
        # </create_agent_with_tools>

    def demonstrate_business_scenarios(agent, openai_client):
        """
        Demonstrate realistic business scenarios with the Microsoft Foundry SDK.

        This function showcases the practical value of the Modern Workplace Assistant
        by walking through scenarios that enterprise employees face regularly.
        """

        scenarios = [
            {
                "title": "üìã Company Policy Question (SharePoint Only)",
                "question": "What is Contoso's remote work policy?",
                "context": "Employee needs to understand company-specific remote work requirements",
                "learning_point": "SharePoint tool retrieves internal company policies",
            },
            {
                "title": "üìö Technical Documentation Question (MCP Only)",
                "question": (
                    "According to Microsoft Learn, what is the correct way to implement "
                    "Azure AD Conditional Access policies? Please include reference links "
                    "to the official documentation."
                ),
                "context": "IT administrator needs authoritative Microsoft technical guidance",
                "learning_point": "MCP tool accesses Microsoft Learn for official documentation with links",
            },
            {
                "title": "üîÑ Combined Implementation Question (SharePoint + MCP)",
                "question": (
                    "Based on our company's remote work security policy, how should I configure "
                    "my Azure environment to comply? Please include links to Microsoft "
                    "documentation showing how to implement each requirement."
                ),
                "context": "Need to map company policy to technical implementation with official guidance",
                "learning_point": "Both tools work together: SharePoint for policy + MCP for implementation docs",
            },
        ]

        print("\n" + "=" * 70)
        print("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION")
        print("=" * 70)
        print("This demonstration shows how AI agents solve real business problems")
        print("using the Microsoft Foundry SDK.")
        print("=" * 70)

        for i, scenario in enumerate(scenarios, 1):
            print(f"\nüìä SCENARIO {i}/3: {scenario['title']}")
            print("-" * 50)
            print(f"‚ùì QUESTION: {scenario['question']}")
            print(f"üéØ BUSINESS CONTEXT: {scenario['context']}")
            print(f"üéì LEARNING POINT: {scenario['learning_point']}")
            print("-" * 50)

            # <agent_conversation>
            print("ü§ñ AGENT RESPONSE:")
            response, status = create_agent_response(agent, scenario["question"], openai_client)
            # </agent_conversation>

            if status == "completed" and response and len(response.strip()) > 10:
                print(f"‚úÖ SUCCESS: {response[:300]}...")
                if len(response) > 300:
                    print(f"   üìè Full response: {len(response)} characters")
            else:
                print(f"‚ö†Ô∏è  RESPONSE: {response}")

            print(f"üìà STATUS: {status}")
            print("-" * 50)

            time.sleep(1)

        print("\n‚úÖ DEMONSTRATION COMPLETED!")
        print("üéì Key Learning Outcomes:")
        print("   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI")
        print("   ‚Ä¢ Conversation management via the Responses API")
        print("   ‚Ä¢ Real business value through AI assistance")
        print("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)")

        return True

    def create_agent_response(agent, message, openai_client):
        """
        Create a response from the workplace agent using the Responses API.

        This function demonstrates the response pattern for the Microsoft Foundry SDK
        including MCP tool approval handling.

        Args:
            agent: The agent object (with .name attribute)
            message: The user's message

        Returns:
            tuple: (response_text, status)
        """

        try:
            response = openai_client.responses.create(
                input=message,
                extra_body={
                    "agent": {"name": agent.name, "type": "agent_reference"}
                },
            )

            # Handle MCP approval requests if present
            approval_list = []
            for item in response.output:
                if item.type == "mcp_approval_request" and item.id:
                    approval_list.append(
                        McpApprovalResponse(
                            type="mcp_approval_response",
                            approve=True,
                            approval_request_id=item.id,
                        )
                    )

            if approval_list:
                response = openai_client.responses.create(
                    input=approval_list,
                    previous_response_id=response.id,
                    extra_body={
                        "agent": {"name": agent.name, "type": "agent_reference"}
                    },
                )

            return response.output_text, "completed"

        except Exception as e:
            return f"Error in conversation: {str(e)}", "failed"

    def interactive_mode(agent, openai_client):
        """Interactive mode for testing the workplace agent."""

        print("\n" + "=" * 60)
        print("üí¨ INTERACTIVE MODE - Test Your Workplace Agent!")
        print("=" * 60)
        print("Ask questions about Azure, M365, security, and technical implementation.")
        print("Type 'quit' to exit.")
        print("-" * 60)

        while True:
            try:
                question = input("\n‚ùì Your question: ").strip()

                if question.lower() in ["quit", "exit", "bye"]:
                    break

                if not question:
                    print("üí° Please ask a question about Azure or M365 technical implementation.")
                    continue

                print("\nü§ñ Workplace Agent: ", end="", flush=True)
                response, status = create_agent_response(agent, question, openai_client)
                print(response)

                if status != "completed":
                    print(f"\n‚ö†Ô∏è  Response status: {status}")

                print("-" * 60)

            except KeyboardInterrupt:
                break
            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("-" * 60)

        print("\nüëã Thank you for testing the Modern Workplace Agent!")

    def main():
        """Main execution flow demonstrating the complete sample."""

        print("üöÄ Foundry - Modern Workplace Assistant")
        print("Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK")
        print("=" * 70)

        # <agent_authentication>
        with (
            DefaultAzureCredential() as credential,
            AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
            project_client.get_openai_client() as openai_client,
        ):
            print(f"‚úÖ Connected to Foundry: {endpoint}")
        # </agent_authentication>

            try:
                agent = create_workplace_assistant(project_client)
                demonstrate_business_scenarios(agent, openai_client)

                print("\nüéØ Try interactive mode? (y/n): ", end="")
                try:
                    if input().lower().startswith("y"):
                        interactive_mode(agent, openai_client)
                except EOFError:
                    print("n")

                print("\nüéâ Sample completed successfully!")
                print("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)")
                print("üîó Next: Add evaluation metrics, monitoring, and production deployment")

            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("Please check your .env configuration and ensure:")
                print("  - PROJECT_ENDPOINT is correct")
                print("  - MODEL_DEPLOYMENT_NAME is deployed")
                print("  - Azure credentials are configured (az login)")

    if __name__ == "__main__":
        main()
    ```

```csharp C#
    // <imports_and_includes>
    using System;
    using System.ClientModel;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Threading.Tasks;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    // </imports_and_includes>

    #pragma warning disable OPENAI001

    /*
     * Azure AI Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant (C#)
     * 
     * This sample demonstrates a complete business scenario using the Azure AI Projects v2 SDK:
     * - Agent creation with PromptAgentDefinition and AgentVersion
     * - Conversation via the Responses API (ProjectResponsesClient)
     * - SharePoint and MCP tool integration on the agent definition
     * - MCP tool approval handling through the Responses API approval loop
     * - Robust error handling and graceful degradation
     * 
     * Educational Focus:
     * - Enterprise AI patterns with the v2 Azure AI Projects SDK
     * - Real-world business scenarios that enterprises face daily
     * - Production-ready error handling and diagnostics
     * - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)
     * 
     * Business Scenario:
     * An employee needs to implement Azure AD multi-factor authentication. They need:
     * 1. Company security policy requirements (from SharePoint)
     * 2. Technical implementation steps (from Microsoft Learn via MCP)
     * 3. Combined guidance showing how policy requirements map to technical implementation
     */

    class Program
    {
        private static AIProjectClient? projectClient;
        private static ProjectResponsesClient? responseClient;
        private static string agentName = "Modern_Workplace_Assistant";

        static async Task Main(string[] args)
        {
            Console.WriteLine("üöÄ Azure AI Foundry - Modern Workplace Assistant");
            Console.WriteLine("Tutorial 1: Building Enterprise Agents with SharePoint + MCP Tools");
            Console.WriteLine("".PadRight(70, '='));

            try
            {
                // Create the agent with full diagnostic output
                var agentVersion = await CreateWorkplaceAssistantAsync();

                // Demonstrate business scenarios
                await DemonstrateBusinessScenariosAsync(agentVersion);

                // Offer interactive testing
                Console.Write("\nüéØ Try interactive mode? (y/n): ");
                var response = Console.ReadLine();
                if (response?.ToLower().StartsWith("y") == true)
                {
                    await InteractiveModeAsync(agentVersion);
                }

                // Cleanup
                Console.WriteLine("\nüßπ Cleaning up agent...");
                await projectClient!.Agents.DeleteAgentVersionAsync(
                    agentName: agentVersion.Name,
                    agentVersion: agentVersion.Version);
                Console.WriteLine("‚úÖ Agent deleted");

                Console.WriteLine("\nüéâ Sample completed successfully!");
                Console.WriteLine("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)");
                Console.WriteLine("üîó Next: Add evaluation metrics, monitoring, and production deployment");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                Console.WriteLine("Please check your .env configuration and ensure:");
                Console.WriteLine("  - PROJECT_ENDPOINT is correct");
                Console.WriteLine("  - MODEL_DEPLOYMENT_NAME is deployed");
                Console.WriteLine("  - Azure credentials are configured (az login)");
                throw;
            }
        }

        /// <summary>
        /// Create a Modern Workplace Assistant with SharePoint and MCP tools.
        /// 
        /// This demonstrates enterprise AI patterns:
        /// 1. Agent creation with PromptAgentDefinition and CreateAgentVersionAsync
        /// 2. SharePoint integration via SharepointAgentTool
        /// 3. MCP integration via McpTool from the OpenAI Responses API
        /// 4. Robust error handling with graceful degradation
        /// 5. Dynamic agent capabilities based on available resources
        /// 
        /// Educational Value:
        /// - Shows real-world complexity of enterprise AI systems
        /// - Demonstrates how to handle partial system failures
        /// - Provides patterns for agent creation with multiple tools
        /// </summary>
        private static async Task<AgentVersion> CreateWorkplaceAssistantAsync()
        {
            // Load environment variables from shared .env file
            var envPath = Path.Combine(Directory.GetCurrentDirectory(), "..", "shared", ".env");
            if (File.Exists(envPath))
            {
                Env.Load(envPath);
                Console.WriteLine($"üìÑ Loaded environment from: {envPath}");
            }
            else
            {
                // Fallback to local .env
                Env.Load(".env");
            }

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharePointConnectionName = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_NAME");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");

            if (string.IsNullOrEmpty(projectEndpoint))
                throw new InvalidOperationException("PROJECT_ENDPOINT environment variable not set");
            if (string.IsNullOrEmpty(modelDeploymentName))
                throw new InvalidOperationException("MODEL_DEPLOYMENT_NAME environment variable not set");

            Console.WriteLine("\nü§ñ Creating Modern Workplace Assistant...");

            // ============================================================================
            // AUTHENTICATION SETUP
            // ============================================================================
            // <agent_authentication>
            var credential = new DefaultAzureCredential();

            projectClient = new AIProjectClient(new Uri(projectEndpoint), credential);
            Console.WriteLine($"‚úÖ Connected to Azure AI Foundry: {projectEndpoint}");
            // </agent_authentication>

            // ========================================================================
            // SHAREPOINT INTEGRATION SETUP
            // ========================================================================
            // <sharepoint_connection_resolution>
            SharepointAgentTool? sharepointTool = null;

            if (!string.IsNullOrEmpty(sharePointConnectionName))
            {
                Console.WriteLine($"üìÅ Configuring SharePoint integration...");
                Console.WriteLine($"   Connection name: {sharePointConnectionName}");

                try
                {
                    // <sharepoint_tool_setup>
                    // Resolve connection name to connection ID via the Connections API
                    AIProjectConnection sharepointConnection = await projectClient.Connections.GetConnectionAsync(
                        sharePointConnectionName, includeCredentials: false);

                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnection.Id) }
                    };
                    sharepointTool = new SharepointAgentTool(sharepointToolOption);
                    Console.WriteLine($"‚úÖ SharePoint tool configured successfully");
                    // </sharepoint_tool_setup>
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint connection unavailable: {ex.Message}");
                    Console.WriteLine($"   Possible causes:");
                    Console.WriteLine($"   - Connection '{sharePointConnectionName}' doesn't exist in the project");
                    Console.WriteLine($"   - Insufficient permissions to access the connection");
                    Console.WriteLine($"   - Connection configuration is incomplete");
                    Console.WriteLine($"   Agent will operate without SharePoint access");
                }
            }
            else
            {
                Console.WriteLine($"üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)");
            }
            // </sharepoint_connection_resolution>

            // ========================================================================
            // MICROSOFT LEARN MCP INTEGRATION SETUP
            // ========================================================================
            // <mcp_tool_setup>
            // MCP (Model Context Protocol) enables agents to access external data sources
            // like Microsoft Learn documentation. The approval flow is handled in ChatWithAssistantAsync.
            McpTool? mcpTool = null;

            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                Console.WriteLine($"üìö Configuring Microsoft Learn MCP integration...");
                Console.WriteLine($"   Server URL: {mcpServerUrl}");

                try
                {
                    // Create MCP tool for Microsoft Learn documentation access
                    // server_label must match pattern: ^[a-zA-Z0-9_]+$ (alphanumeric and underscores only)
                    mcpTool = new McpTool("Microsoft_Learn_Documentation", new Uri(mcpServerUrl));
                    Console.WriteLine($"‚úÖ MCP tool configured successfully");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP tool unavailable: {ex.Message}");
                    Console.WriteLine($"   Agent will operate without Microsoft Learn access");
                }
            }
            else
            {
                Console.WriteLine($"üìö MCP integration skipped (MCP_SERVER_URL not set)");
            }
            // </mcp_tool_setup>

            // ========================================================================
            // AGENT CREATION WITH DYNAMIC CAPABILITIES
            // ========================================================================
            // Create agent instructions based on available data sources
            string instructions = GetAgentInstructions(sharepointTool != null, mcpTool != null);

            // <create_agent_with_tools>
            // Create the agent using the v2 SDK with PromptAgentDefinition
            Console.WriteLine($"üõ†Ô∏è  Creating agent with model: {modelDeploymentName}");

            var agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add tools to the agent definition
            if (sharepointTool != null)
            {
                agentDefinition.Tools.Add(sharepointTool);
                Console.WriteLine($"   ‚úì SharePoint tool added");
            }

            if (mcpTool != null)
            {
                agentDefinition.Tools.Add(mcpTool);
                Console.WriteLine($"   ‚úì MCP tool added");
            }

            Console.WriteLine($"   Total tools: {agentDefinition.Tools.Count}");

            // Create agent version
            AgentVersion agentVersion = await projectClient.Agents.CreateAgentVersionAsync(
                agentName: agentName,
                options: new(agentDefinition));

            // Create a response client bound to this agent for conversations
            responseClient = projectClient.OpenAI
                .GetProjectResponsesClientForAgent(agentVersion);

            Console.WriteLine($"‚úÖ Agent created successfully: {agentVersion.Name} (version {agentVersion.Version})");
            return agentVersion;
            // </create_agent_with_tools>
        }

        /// <summary>
        /// Generate agent instructions based on available tools.
        /// </summary>
        private static string GetAgentInstructions(bool hasSharePoint, bool hasMcp)
        {
            if (hasSharePoint && hasMcp)
            {
                return @"You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation and best practices
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance
    - Explain how internal requirements connect to external implementation steps

    EXAMPLE SCENARIOS:
    - ""What is our MFA policy?"" ‚Üí Search SharePoint for security policies
    - ""How do I configure Azure AD Conditional Access?"" ‚Üí Use Microsoft Learn for technical steps
    - ""Our policy requires MFA - how do I implement this?"" ‚Üí Combine policy requirements with implementation guidance";
            }
            else if (hasSharePoint)
            {
                return @"You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices

    RESPONSE STRATEGY:
    - Search SharePoint for company-specific requirements
    - Provide technical guidance based on Azure and M365 best practices
    - Explain how to align implementations with company policies";
            }
            else if (hasMcp)
            {
                return @"You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options

    RESPONSE STRATEGY:
    - Use Microsoft Learn for technical documentation
    - Provide comprehensive implementation guidance
    - Reference official documentation and best practices";
            }
            else
            {
                return @"You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations

    RESPONSE STRATEGY:
    - Provide comprehensive technical guidance
    - Include step-by-step implementation instructions
    - Reference best practices and security considerations";
            }
        }

        /// <summary>
        /// Demonstrate realistic business scenarios.
        /// 
        /// This function showcases the practical value of the Modern Workplace Assistant
        /// by walking through scenarios that enterprise employees face regularly.
        /// 
        /// Educational Value:
        /// - Shows real business problems that AI agents can solve
        /// - Demonstrates the Responses API conversation pattern
        /// - Illustrates conversation patterns with tool usage
        /// </summary>
        private static async Task DemonstrateBusinessScenariosAsync(AgentVersion agentVersion)
        {
            var scenarios = new[]
            {
                new
                {
                    Title = "üìã Company Policy Question (SharePoint Only)",
                    Question = "What is Contoso's remote work policy?",
                    Context = "Employee needs to understand company-specific remote work requirements",
                    LearningPoint = "SharePoint tool retrieves internal company policies"
                },
                new
                {
                    Title = "üìö Technical Documentation Question (MCP Only)",
                    Question = "According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.",
                    Context = "IT administrator needs authoritative Microsoft technical guidance",
                    LearningPoint = "MCP tool accesses Microsoft Learn for official documentation with links"
                },
                new
                {
                    Title = "üîÑ Combined Implementation Question (SharePoint + MCP)",
                    Question = "Based on our company's remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.",
                    Context = "Need to map company policy to technical implementation with official guidance",
                    LearningPoint = "Both tools work together: SharePoint for policy + MCP for implementation docs"
                }
            };

            Console.WriteLine("\n" + "".PadRight(70, '='));
            Console.WriteLine("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION");
            Console.WriteLine("".PadRight(70, '='));
            Console.WriteLine("This demonstration shows how AI agents solve real business problems");
            Console.WriteLine("using the Azure AI Projects v2 SDK with the Responses API.");
            Console.WriteLine("".PadRight(70, '='));

            for (int i = 0; i < scenarios.Length; i++)
            {
                var scenario = scenarios[i];
                Console.WriteLine($"\nüìä SCENARIO {i + 1}/{scenarios.Length}: {scenario.Title}");
                Console.WriteLine("".PadRight(50, '-'));
                Console.WriteLine($"‚ùì QUESTION: {scenario.Question}");
                Console.WriteLine($"üéØ BUSINESS CONTEXT: {scenario.Context}");
                Console.WriteLine($"üéì LEARNING POINT: {scenario.LearningPoint}");
                Console.WriteLine("".PadRight(50, '-'));

                // <agent_conversation>
                Console.WriteLine("ü§ñ ASSISTANT RESPONSE:");
                var (response, status) = await ChatWithAssistantAsync(scenario.Question);
                // </agent_conversation>

                // Display response with analysis
                if (status == "completed" && !string.IsNullOrWhiteSpace(response) && response.Length > 10)
                {
                    var preview = response.Length > 500 ? response.Substring(0, 500) + "..." : response;
                    Console.WriteLine($"‚úÖ SUCCESS: {preview}");
                    if (response.Length > 500)
                    {
                        Console.WriteLine($"   üìè Full response: {response.Length} characters");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ö†Ô∏è  RESPONSE: {response}");
                }

                Console.WriteLine($"üìà STATUS: {status}");
                Console.WriteLine("".PadRight(50, '-'));

                // Small delay between scenarios
                await Task.Delay(1000);
            }

            Console.WriteLine("\n‚úÖ DEMONSTRATION COMPLETED!");
            Console.WriteLine("üéì Key Learning Outcomes:");
            Console.WriteLine("   ‚Ä¢ Azure AI Projects v2 SDK with PromptAgentDefinition");
            Console.WriteLine("   ‚Ä¢ Responses API for agent conversations");
            Console.WriteLine("   ‚Ä¢ SharePoint + MCP tool integration");
            Console.WriteLine("   ‚Ä¢ MCP tool approval handling via the Responses API");
            Console.WriteLine("   ‚Ä¢ Real business value through AI assistance");
            Console.WriteLine("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)");
        }

        /// <summary>
        /// Execute a conversation with the workplace assistant using the Responses API.
        /// 
        /// This function demonstrates the v2 conversation pattern including:
        /// - Sending a request via ProjectResponsesClient
        /// - MCP tool approval handling through the Responses API approval loop
        /// - Proper error and timeout management
        /// 
        /// Educational Value:
        /// - Shows the Responses API conversation pattern (replaces threads/runs)
        /// - Demonstrates MCP approval via McpToolCallApprovalRequestItem
        /// - Includes timeout and error management patterns
        /// </summary>
        // <mcp_approval_handler>
        private static async Task<(string response, string status)> ChatWithAssistantAsync(string message)
        {
            try
            {
                // Send the user message via the Responses API
                ResponseResult response = await responseClient!.CreateResponseAsync(message);

                // <mcp_approval_usage>
                // Handle MCP tool approval loop.
                // When the agent uses MCP tools, the response may contain
                // McpToolCallApprovalRequestItem items. We auto-approve and re-send.
                int maxIterations = 30;
                int iteration = 0;

                while (iteration < maxIterations)
                {
                    // Check for MCP approval requests in the output items
                    var approvalRequests = response.OutputItems
                        .OfType<McpToolCallApprovalRequestItem>()
                        .ToList();

                    if (approvalRequests.Count == 0) break;

                    // Build approval response items
                    var approvalItems = new List<ResponseItem>();
                    foreach (var request in approvalRequests)
                    {
                        Console.WriteLine($"   üîß Approving MCP tool: {request.ToolName}");

                        // Auto-approve MCP tool calls
                        // In production, you might implement custom approval logic here:
                        // - RBAC checks (is user authorized for this tool?)
                        // - Cost controls (has budget limit been reached?)
                        // - Logging and auditing
                        // - Interactive approval prompts
                        approvalItems.Add(ResponseItem.CreateMcpApprovalResponseItem(
                            request.Id,
                            approved: true));
                    }

                    // Send approval responses, chained to the previous response
                    response = await responseClient.CreateResponseAsync(
                        approvalItems,
                        previousResponseId: response.Id);
                    iteration++;
                }
                // </mcp_approval_usage>

                // Extract the text output
                string? outputText = response.GetOutputText();

                if (!string.IsNullOrWhiteSpace(outputText) && outputText.Length > 0)
                {
                    return (outputText, "completed");
                }
                else
                {
                    return ("No response from assistant", "completed");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Exception details: {ex.GetType().Name}: {ex.Message}");
                if (ex.InnerException != null)
                {
                    Console.WriteLine($"   Inner: {ex.InnerException.Message}");
                }
                return ($"Error in conversation: {ex.Message}", "failed");
            }
        }
        // </mcp_approval_handler>

        /// <summary>
        /// Interactive mode for testing the workplace assistant.
        /// 
        /// This provides a simple interface for users to test the agent with their own questions
        /// and see how it provides comprehensive technical guidance.
        /// Uses PreviousResponseId to maintain conversation context across turns.
        /// </summary>
        private static async Task InteractiveModeAsync(AgentVersion agentVersion)
        {
            Console.WriteLine("\n" + "".PadRight(60, '='));
            Console.WriteLine("üí¨ INTERACTIVE MODE - Test Your Workplace Assistant!");
            Console.WriteLine("".PadRight(60, '='));
            Console.WriteLine("Ask questions about Azure, M365, security, and technical implementation:");
            Console.WriteLine("‚Ä¢ 'How do I configure Azure AD conditional access?'");
            Console.WriteLine("‚Ä¢ 'What are MFA best practices for remote workers?'");
            Console.WriteLine("‚Ä¢ 'How do I set up secure SharePoint access?'");
            Console.WriteLine("Type 'quit' to exit.");
            Console.WriteLine("".PadRight(60, '-'));

            while (true)
            {
                try
                {
                    Console.Write("\n‚ùì Your question: ");
                    string? question = Console.ReadLine()?.Trim();

                    if (string.IsNullOrEmpty(question))
                    {
                        Console.WriteLine("üí° Please ask a question about Azure or M365 technical implementation.");
                        continue;
                    }

                    if (question.ToLower() is "quit" or "exit" or "bye")
                    {
                        break;
                    }

                    Console.Write("\nü§ñ Workplace Assistant: ");
                    var (response, status) = await ChatWithAssistantAsync(question);
                    Console.WriteLine(response);

                    if (status != "completed")
                    {
                        Console.WriteLine($"\n‚ö†Ô∏è  Response status: {status}");
                    }

                    Console.WriteLine("".PadRight(60, '-'));
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                    Console.WriteLine("".PadRight(60, '-'));
                }
            }

            Console.WriteLine("\nüëã Thank you for testing the Modern Workplace Assistant!");
        }
    }
    ```
</CodeGroup>

### Create the MCP tool for the agent

<CodeGroup>
```python Python
    #!/usr/bin/env python3
    """
    Microsoft Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant

    This sample demonstrates a complete business scenario using the Microsoft Foundry SDK:
    - Agent creation with PromptAgentDefinition
    - Conversation management via the Responses API
    - Robust error handling and graceful degradation

    Educational Focus:
    - Enterprise AI patterns with the Microsoft Foundry SDK
    - Real-world business scenarios that enterprises face daily
    - Production-ready error handling and diagnostics
    - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)

    Business Scenario:
    An employee needs to implement Azure AD multi-factor authentication. They need:
    1. Company security policy requirements
    2. Technical implementation steps
    3. Combined guidance showing how policy requirements map to technical implementation
    """

    # <imports_and_includes>
    import os
    import time
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import (
        PromptAgentDefinition,
        SharepointPreviewTool,
        SharepointGroundingToolParameters,
        ToolProjectConnection,
        MCPTool,
    )
    from azure.identity import DefaultAzureCredential
    from dotenv import load_dotenv
    from openai.types.responses.response_input_param import (
        McpApprovalResponse,
    )
    # </imports_and_includes>

    load_dotenv()

    # ============================================================================
    # AUTHENTICATION SETUP
    # ============================================================================
    endpoint = os.environ["PROJECT_ENDPOINT"]

    def create_workplace_assistant(project_client):
        """
        Create a Modern Workplace Assistant using the Microsoft Foundry SDK.

        This demonstrates enterprise AI patterns:
        1. Agent creation with PromptAgentDefinition
        2. Robust error handling with graceful degradation
        3. Dynamic agent capabilities based on available resources
        4. Clear diagnostic information for troubleshooting

        Returns:
            agent: The created agent object
        """

        print("ü§ñ Creating Modern Workplace Assistant...")

        # ========================================================================
        # SHAREPOINT INTEGRATION SETUP
        # ========================================================================
        # <sharepoint_tool_setup>
        sharepoint_connection_id = os.environ.get("SHAREPOINT_CONNECTION_ID")
        sharepoint_tool = None

        if sharepoint_connection_id:
            print("üìÅ Configuring SharePoint integration...")
            print(f"   Connection ID: {sharepoint_connection_id}")

            try:
                sharepoint_tool = SharepointPreviewTool(
                    sharepoint_grounding_preview=SharepointGroundingToolParameters(
                        project_connections=[
                            ToolProjectConnection(
                                project_connection_id=sharepoint_connection_id
                            )
                        ]
                    )
                )
                print("‚úÖ SharePoint tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  SharePoint tool unavailable: {e}")
                print("   Agent will operate without SharePoint access")
                sharepoint_tool = None
        else:
            print("üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_ID not set)")
        # </sharepoint_tool_setup>

        # ========================================================================
        # MICROSOFT LEARN MCP INTEGRATION SETUP
        # ========================================================================
        # <mcp_tool_setup>
        mcp_server_url = os.environ.get("MCP_SERVER_URL")
        mcp_tool = None

        if mcp_server_url:
            print("üìö Configuring Microsoft Learn MCP integration...")
            print(f"   Server URL: {mcp_server_url}")

            try:
                mcp_tool = MCPTool(
                    server_url=mcp_server_url,
                    server_label="Microsoft_Learn_Documentation",
                    require_approval="always",
                )
                print("‚úÖ MCP tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  MCP tool unavailable: {e}")
                print("   Agent will operate without Microsoft Learn access")
                mcp_tool = None
        else:
            print("üìö MCP integration skipped (MCP_SERVER_URL not set)")
        # </mcp_tool_setup>

        # ========================================================================
        # AGENT CREATION WITH DYNAMIC CAPABILITIES
        # ========================================================================
        if sharepoint_tool and mcp_tool:
            instructions = """You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance"""
        elif sharepoint_tool:
            instructions = """You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices"""
        elif mcp_tool:
            instructions = """You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options"""
        else:
            instructions = """You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations"""

        # <create_agent_with_tools>
        print(f"üõ†Ô∏è  Creating agent with model: {os.environ['MODEL_DEPLOYMENT_NAME']}")

        tools = []
        if sharepoint_tool:
            tools.append(sharepoint_tool)
            print("   ‚úì SharePoint tool added")
        if mcp_tool:
            tools.append(mcp_tool)
            print("   ‚úì MCP tool added")

        print(f"   Total tools: {len(tools)}")

        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=os.environ["MODEL_DEPLOYMENT_NAME"],
                instructions=instructions,
                tools=tools if tools else None,
            ),
        )

        print(f"‚úÖ Agent created successfully (name: {agent.name}, version: {agent.version})")
        return agent
        # </create_agent_with_tools>

    def demonstrate_business_scenarios(agent, openai_client):
        """
        Demonstrate realistic business scenarios with the Microsoft Foundry SDK.

        This function showcases the practical value of the Modern Workplace Assistant
        by walking through scenarios that enterprise employees face regularly.
        """

        scenarios = [
            {
                "title": "üìã Company Policy Question (SharePoint Only)",
                "question": "What is Contoso's remote work policy?",
                "context": "Employee needs to understand company-specific remote work requirements",
                "learning_point": "SharePoint tool retrieves internal company policies",
            },
            {
                "title": "üìö Technical Documentation Question (MCP Only)",
                "question": (
                    "According to Microsoft Learn, what is the correct way to implement "
                    "Azure AD Conditional Access policies? Please include reference links "
                    "to the official documentation."
                ),
                "context": "IT administrator needs authoritative Microsoft technical guidance",
                "learning_point": "MCP tool accesses Microsoft Learn for official documentation with links",
            },
            {
                "title": "üîÑ Combined Implementation Question (SharePoint + MCP)",
                "question": (
                    "Based on our company's remote work security policy, how should I configure "
                    "my Azure environment to comply? Please include links to Microsoft "
                    "documentation showing how to implement each requirement."
                ),
                "context": "Need to map company policy to technical implementation with official guidance",
                "learning_point": "Both tools work together: SharePoint for policy + MCP for implementation docs",
            },
        ]

        print("\n" + "=" * 70)
        print("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION")
        print("=" * 70)
        print("This demonstration shows how AI agents solve real business problems")
        print("using the Microsoft Foundry SDK.")
        print("=" * 70)

        for i, scenario in enumerate(scenarios, 1):
            print(f"\nüìä SCENARIO {i}/3: {scenario['title']}")
            print("-" * 50)
            print(f"‚ùì QUESTION: {scenario['question']}")
            print(f"üéØ BUSINESS CONTEXT: {scenario['context']}")
            print(f"üéì LEARNING POINT: {scenario['learning_point']}")
            print("-" * 50)

            # <agent_conversation>
            print("ü§ñ AGENT RESPONSE:")
            response, status = create_agent_response(agent, scenario["question"], openai_client)
            # </agent_conversation>

            if status == "completed" and response and len(response.strip()) > 10:
                print(f"‚úÖ SUCCESS: {response[:300]}...")
                if len(response) > 300:
                    print(f"   üìè Full response: {len(response)} characters")
            else:
                print(f"‚ö†Ô∏è  RESPONSE: {response}")

            print(f"üìà STATUS: {status}")
            print("-" * 50)

            time.sleep(1)

        print("\n‚úÖ DEMONSTRATION COMPLETED!")
        print("üéì Key Learning Outcomes:")
        print("   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI")
        print("   ‚Ä¢ Conversation management via the Responses API")
        print("   ‚Ä¢ Real business value through AI assistance")
        print("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)")

        return True

    def create_agent_response(agent, message, openai_client):
        """
        Create a response from the workplace agent using the Responses API.

        This function demonstrates the response pattern for the Microsoft Foundry SDK
        including MCP tool approval handling.

        Args:
            agent: The agent object (with .name attribute)
            message: The user's message

        Returns:
            tuple: (response_text, status)
        """

        try:
            response = openai_client.responses.create(
                input=message,
                extra_body={
                    "agent": {"name": agent.name, "type": "agent_reference"}
                },
            )

            # Handle MCP approval requests if present
            approval_list = []
            for item in response.output:
                if item.type == "mcp_approval_request" and item.id:
                    approval_list.append(
                        McpApprovalResponse(
                            type="mcp_approval_response",
                            approve=True,
                            approval_request_id=item.id,
                        )
                    )

            if approval_list:
                response = openai_client.responses.create(
                    input=approval_list,
                    previous_response_id=response.id,
                    extra_body={
                        "agent": {"name": agent.name, "type": "agent_reference"}
                    },
                )

            return response.output_text, "completed"

        except Exception as e:
            return f"Error in conversation: {str(e)}", "failed"

    def interactive_mode(agent, openai_client):
        """Interactive mode for testing the workplace agent."""

        print("\n" + "=" * 60)
        print("üí¨ INTERACTIVE MODE - Test Your Workplace Agent!")
        print("=" * 60)
        print("Ask questions about Azure, M365, security, and technical implementation.")
        print("Type 'quit' to exit.")
        print("-" * 60)

        while True:
            try:
                question = input("\n‚ùì Your question: ").strip()

                if question.lower() in ["quit", "exit", "bye"]:
                    break

                if not question:
                    print("üí° Please ask a question about Azure or M365 technical implementation.")
                    continue

                print("\nü§ñ Workplace Agent: ", end="", flush=True)
                response, status = create_agent_response(agent, question, openai_client)
                print(response)

                if status != "completed":
                    print(f"\n‚ö†Ô∏è  Response status: {status}")

                print("-" * 60)

            except KeyboardInterrupt:
                break
            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("-" * 60)

        print("\nüëã Thank you for testing the Modern Workplace Agent!")

    def main():
        """Main execution flow demonstrating the complete sample."""

        print("üöÄ Foundry - Modern Workplace Assistant")
        print("Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK")
        print("=" * 70)

        # <agent_authentication>
        with (
            DefaultAzureCredential() as credential,
            AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
            project_client.get_openai_client() as openai_client,
        ):
            print(f"‚úÖ Connected to Foundry: {endpoint}")
        # </agent_authentication>

            try:
                agent = create_workplace_assistant(project_client)
                demonstrate_business_scenarios(agent, openai_client)

                print("\nüéØ Try interactive mode? (y/n): ", end="")
                try:
                    if input().lower().startswith("y"):
                        interactive_mode(agent, openai_client)
                except EOFError:
                    print("n")

                print("\nüéâ Sample completed successfully!")
                print("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)")
                print("üîó Next: Add evaluation metrics, monitoring, and production deployment")

            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("Please check your .env configuration and ensure:")
                print("  - PROJECT_ENDPOINT is correct")
                print("  - MODEL_DEPLOYMENT_NAME is deployed")
                print("  - Azure credentials are configured (az login)")

    if __name__ == "__main__":
        main()
    ```

```csharp C#
    // <imports_and_includes>
    using System;
    using System.ClientModel;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Threading.Tasks;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    // </imports_and_includes>

    #pragma warning disable OPENAI001

    /*
     * Azure AI Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant (C#)
     * 
     * This sample demonstrates a complete business scenario using the Azure AI Projects v2 SDK:
     * - Agent creation with PromptAgentDefinition and AgentVersion
     * - Conversation via the Responses API (ProjectResponsesClient)
     * - SharePoint and MCP tool integration on the agent definition
     * - MCP tool approval handling through the Responses API approval loop
     * - Robust error handling and graceful degradation
     * 
     * Educational Focus:
     * - Enterprise AI patterns with the v2 Azure AI Projects SDK
     * - Real-world business scenarios that enterprises face daily
     * - Production-ready error handling and diagnostics
     * - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)
     * 
     * Business Scenario:
     * An employee needs to implement Azure AD multi-factor authentication. They need:
     * 1. Company security policy requirements (from SharePoint)
     * 2. Technical implementation steps (from Microsoft Learn via MCP)
     * 3. Combined guidance showing how policy requirements map to technical implementation
     */

    class Program
    {
        private static AIProjectClient? projectClient;
        private static ProjectResponsesClient? responseClient;
        private static string agentName = "Modern_Workplace_Assistant";

        static async Task Main(string[] args)
        {
            Console.WriteLine("üöÄ Azure AI Foundry - Modern Workplace Assistant");
            Console.WriteLine("Tutorial 1: Building Enterprise Agents with SharePoint + MCP Tools");
            Console.WriteLine("".PadRight(70, '='));

            try
            {
                // Create the agent with full diagnostic output
                var agentVersion = await CreateWorkplaceAssistantAsync();

                // Demonstrate business scenarios
                await DemonstrateBusinessScenariosAsync(agentVersion);

                // Offer interactive testing
                Console.Write("\nüéØ Try interactive mode? (y/n): ");
                var response = Console.ReadLine();
                if (response?.ToLower().StartsWith("y") == true)
                {
                    await InteractiveModeAsync(agentVersion);
                }

                // Cleanup
                Console.WriteLine("\nüßπ Cleaning up agent...");
                await projectClient!.Agents.DeleteAgentVersionAsync(
                    agentName: agentVersion.Name,
                    agentVersion: agentVersion.Version);
                Console.WriteLine("‚úÖ Agent deleted");

                Console.WriteLine("\nüéâ Sample completed successfully!");
                Console.WriteLine("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)");
                Console.WriteLine("üîó Next: Add evaluation metrics, monitoring, and production deployment");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                Console.WriteLine("Please check your .env configuration and ensure:");
                Console.WriteLine("  - PROJECT_ENDPOINT is correct");
                Console.WriteLine("  - MODEL_DEPLOYMENT_NAME is deployed");
                Console.WriteLine("  - Azure credentials are configured (az login)");
                throw;
            }
        }

        /// <summary>
        /// Create a Modern Workplace Assistant with SharePoint and MCP tools.
        /// 
        /// This demonstrates enterprise AI patterns:
        /// 1. Agent creation with PromptAgentDefinition and CreateAgentVersionAsync
        /// 2. SharePoint integration via SharepointAgentTool
        /// 3. MCP integration via McpTool from the OpenAI Responses API
        /// 4. Robust error handling with graceful degradation
        /// 5. Dynamic agent capabilities based on available resources
        /// 
        /// Educational Value:
        /// - Shows real-world complexity of enterprise AI systems
        /// - Demonstrates how to handle partial system failures
        /// - Provides patterns for agent creation with multiple tools
        /// </summary>
        private static async Task<AgentVersion> CreateWorkplaceAssistantAsync()
        {
            // Load environment variables from shared .env file
            var envPath = Path.Combine(Directory.GetCurrentDirectory(), "..", "shared", ".env");
            if (File.Exists(envPath))
            {
                Env.Load(envPath);
                Console.WriteLine($"üìÑ Loaded environment from: {envPath}");
            }
            else
            {
                // Fallback to local .env
                Env.Load(".env");
            }

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharePointConnectionName = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_NAME");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");

            if (string.IsNullOrEmpty(projectEndpoint))
                throw new InvalidOperationException("PROJECT_ENDPOINT environment variable not set");
            if (string.IsNullOrEmpty(modelDeploymentName))
                throw new InvalidOperationException("MODEL_DEPLOYMENT_NAME environment variable not set");

            Console.WriteLine("\nü§ñ Creating Modern Workplace Assistant...");

            // ============================================================================
            // AUTHENTICATION SETUP
            // ============================================================================
            // <agent_authentication>
            var credential = new DefaultAzureCredential();

            projectClient = new AIProjectClient(new Uri(projectEndpoint), credential);
            Console.WriteLine($"‚úÖ Connected to Azure AI Foundry: {projectEndpoint}");
            // </agent_authentication>

            // ========================================================================
            // SHAREPOINT INTEGRATION SETUP
            // ========================================================================
            // <sharepoint_connection_resolution>
            SharepointAgentTool? sharepointTool = null;

            if (!string.IsNullOrEmpty(sharePointConnectionName))
            {
                Console.WriteLine($"üìÅ Configuring SharePoint integration...");
                Console.WriteLine($"   Connection name: {sharePointConnectionName}");

                try
                {
                    // <sharepoint_tool_setup>
                    // Resolve connection name to connection ID via the Connections API
                    AIProjectConnection sharepointConnection = await projectClient.Connections.GetConnectionAsync(
                        sharePointConnectionName, includeCredentials: false);

                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnection.Id) }
                    };
                    sharepointTool = new SharepointAgentTool(sharepointToolOption);
                    Console.WriteLine($"‚úÖ SharePoint tool configured successfully");
                    // </sharepoint_tool_setup>
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint connection unavailable: {ex.Message}");
                    Console.WriteLine($"   Possible causes:");
                    Console.WriteLine($"   - Connection '{sharePointConnectionName}' doesn't exist in the project");
                    Console.WriteLine($"   - Insufficient permissions to access the connection");
                    Console.WriteLine($"   - Connection configuration is incomplete");
                    Console.WriteLine($"   Agent will operate without SharePoint access");
                }
            }
            else
            {
                Console.WriteLine($"üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)");
            }
            // </sharepoint_connection_resolution>

            // ========================================================================
            // MICROSOFT LEARN MCP INTEGRATION SETUP
            // ========================================================================
            // <mcp_tool_setup>
            // MCP (Model Context Protocol) enables agents to access external data sources
            // like Microsoft Learn documentation. The approval flow is handled in ChatWithAssistantAsync.
            McpTool? mcpTool = null;

            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                Console.WriteLine($"üìö Configuring Microsoft Learn MCP integration...");
                Console.WriteLine($"   Server URL: {mcpServerUrl}");

                try
                {
                    // Create MCP tool for Microsoft Learn documentation access
                    // server_label must match pattern: ^[a-zA-Z0-9_]+$ (alphanumeric and underscores only)
                    mcpTool = new McpTool("Microsoft_Learn_Documentation", new Uri(mcpServerUrl));
                    Console.WriteLine($"‚úÖ MCP tool configured successfully");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP tool unavailable: {ex.Message}");
                    Console.WriteLine($"   Agent will operate without Microsoft Learn access");
                }
            }
            else
            {
                Console.WriteLine($"üìö MCP integration skipped (MCP_SERVER_URL not set)");
            }
            // </mcp_tool_setup>

            // ========================================================================
            // AGENT CREATION WITH DYNAMIC CAPABILITIES
            // ========================================================================
            // Create agent instructions based on available data sources
            string instructions = GetAgentInstructions(sharepointTool != null, mcpTool != null);

            // <create_agent_with_tools>
            // Create the agent using the v2 SDK with PromptAgentDefinition
            Console.WriteLine($"üõ†Ô∏è  Creating agent with model: {modelDeploymentName}");

            var agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add tools to the agent definition
            if (sharepointTool != null)
            {
                agentDefinition.Tools.Add(sharepointTool);
                Console.WriteLine($"   ‚úì SharePoint tool added");
            }

            if (mcpTool != null)
            {
                agentDefinition.Tools.Add(mcpTool);
                Console.WriteLine($"   ‚úì MCP tool added");
            }

            Console.WriteLine($"   Total tools: {agentDefinition.Tools.Count}");

            // Create agent version
            AgentVersion agentVersion = await projectClient.Agents.CreateAgentVersionAsync(
                agentName: agentName,
                options: new(agentDefinition));

            // Create a response client bound to this agent for conversations
            responseClient = projectClient.OpenAI
                .GetProjectResponsesClientForAgent(agentVersion);

            Console.WriteLine($"‚úÖ Agent created successfully: {agentVersion.Name} (version {agentVersion.Version})");
            return agentVersion;
            // </create_agent_with_tools>
        }

        /// <summary>
        /// Generate agent instructions based on available tools.
        /// </summary>
        private static string GetAgentInstructions(bool hasSharePoint, bool hasMcp)
        {
            if (hasSharePoint && hasMcp)
            {
                return @"You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation and best practices
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance
    - Explain how internal requirements connect to external implementation steps

    EXAMPLE SCENARIOS:
    - ""What is our MFA policy?"" ‚Üí Search SharePoint for security policies
    - ""How do I configure Azure AD Conditional Access?"" ‚Üí Use Microsoft Learn for technical steps
    - ""Our policy requires MFA - how do I implement this?"" ‚Üí Combine policy requirements with implementation guidance";
            }
            else if (hasSharePoint)
            {
                return @"You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices

    RESPONSE STRATEGY:
    - Search SharePoint for company-specific requirements
    - Provide technical guidance based on Azure and M365 best practices
    - Explain how to align implementations with company policies";
            }
            else if (hasMcp)
            {
                return @"You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options

    RESPONSE STRATEGY:
    - Use Microsoft Learn for technical documentation
    - Provide comprehensive implementation guidance
    - Reference official documentation and best practices";
            }
            else
            {
                return @"You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations

    RESPONSE STRATEGY:
    - Provide comprehensive technical guidance
    - Include step-by-step implementation instructions
    - Reference best practices and security considerations";
            }
        }

        /// <summary>
        /// Demonstrate realistic business scenarios.
        /// 
        /// This function showcases the practical value of the Modern Workplace Assistant
        /// by walking through scenarios that enterprise employees face regularly.
        /// 
        /// Educational Value:
        /// - Shows real business problems that AI agents can solve
        /// - Demonstrates the Responses API conversation pattern
        /// - Illustrates conversation patterns with tool usage
        /// </summary>
        private static async Task DemonstrateBusinessScenariosAsync(AgentVersion agentVersion)
        {
            var scenarios = new[]
            {
                new
                {
                    Title = "üìã Company Policy Question (SharePoint Only)",
                    Question = "What is Contoso's remote work policy?",
                    Context = "Employee needs to understand company-specific remote work requirements",
                    LearningPoint = "SharePoint tool retrieves internal company policies"
                },
                new
                {
                    Title = "üìö Technical Documentation Question (MCP Only)",
                    Question = "According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.",
                    Context = "IT administrator needs authoritative Microsoft technical guidance",
                    LearningPoint = "MCP tool accesses Microsoft Learn for official documentation with links"
                },
                new
                {
                    Title = "üîÑ Combined Implementation Question (SharePoint + MCP)",
                    Question = "Based on our company's remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.",
                    Context = "Need to map company policy to technical implementation with official guidance",
                    LearningPoint = "Both tools work together: SharePoint for policy + MCP for implementation docs"
                }
            };

            Console.WriteLine("\n" + "".PadRight(70, '='));
            Console.WriteLine("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION");
            Console.WriteLine("".PadRight(70, '='));
            Console.WriteLine("This demonstration shows how AI agents solve real business problems");
            Console.WriteLine("using the Azure AI Projects v2 SDK with the Responses API.");
            Console.WriteLine("".PadRight(70, '='));

            for (int i = 0; i < scenarios.Length; i++)
            {
                var scenario = scenarios[i];
                Console.WriteLine($"\nüìä SCENARIO {i + 1}/{scenarios.Length}: {scenario.Title}");
                Console.WriteLine("".PadRight(50, '-'));
                Console.WriteLine($"‚ùì QUESTION: {scenario.Question}");
                Console.WriteLine($"üéØ BUSINESS CONTEXT: {scenario.Context}");
                Console.WriteLine($"üéì LEARNING POINT: {scenario.LearningPoint}");
                Console.WriteLine("".PadRight(50, '-'));

                // <agent_conversation>
                Console.WriteLine("ü§ñ ASSISTANT RESPONSE:");
                var (response, status) = await ChatWithAssistantAsync(scenario.Question);
                // </agent_conversation>

                // Display response with analysis
                if (status == "completed" && !string.IsNullOrWhiteSpace(response) && response.Length > 10)
                {
                    var preview = response.Length > 500 ? response.Substring(0, 500) + "..." : response;
                    Console.WriteLine($"‚úÖ SUCCESS: {preview}");
                    if (response.Length > 500)
                    {
                        Console.WriteLine($"   üìè Full response: {response.Length} characters");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ö†Ô∏è  RESPONSE: {response}");
                }

                Console.WriteLine($"üìà STATUS: {status}");
                Console.WriteLine("".PadRight(50, '-'));

                // Small delay between scenarios
                await Task.Delay(1000);
            }

            Console.WriteLine("\n‚úÖ DEMONSTRATION COMPLETED!");
            Console.WriteLine("üéì Key Learning Outcomes:");
            Console.WriteLine("   ‚Ä¢ Azure AI Projects v2 SDK with PromptAgentDefinition");
            Console.WriteLine("   ‚Ä¢ Responses API for agent conversations");
            Console.WriteLine("   ‚Ä¢ SharePoint + MCP tool integration");
            Console.WriteLine("   ‚Ä¢ MCP tool approval handling via the Responses API");
            Console.WriteLine("   ‚Ä¢ Real business value through AI assistance");
            Console.WriteLine("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)");
        }

        /// <summary>
        /// Execute a conversation with the workplace assistant using the Responses API.
        /// 
        /// This function demonstrates the v2 conversation pattern including:
        /// - Sending a request via ProjectResponsesClient
        /// - MCP tool approval handling through the Responses API approval loop
        /// - Proper error and timeout management
        /// 
        /// Educational Value:
        /// - Shows the Responses API conversation pattern (replaces threads/runs)
        /// - Demonstrates MCP approval via McpToolCallApprovalRequestItem
        /// - Includes timeout and error management patterns
        /// </summary>
        // <mcp_approval_handler>
        private static async Task<(string response, string status)> ChatWithAssistantAsync(string message)
        {
            try
            {
                // Send the user message via the Responses API
                ResponseResult response = await responseClient!.CreateResponseAsync(message);

                // <mcp_approval_usage>
                // Handle MCP tool approval loop.
                // When the agent uses MCP tools, the response may contain
                // McpToolCallApprovalRequestItem items. We auto-approve and re-send.
                int maxIterations = 30;
                int iteration = 0;

                while (iteration < maxIterations)
                {
                    // Check for MCP approval requests in the output items
                    var approvalRequests = response.OutputItems
                        .OfType<McpToolCallApprovalRequestItem>()
                        .ToList();

                    if (approvalRequests.Count == 0) break;

                    // Build approval response items
                    var approvalItems = new List<ResponseItem>();
                    foreach (var request in approvalRequests)
                    {
                        Console.WriteLine($"   üîß Approving MCP tool: {request.ToolName}");

                        // Auto-approve MCP tool calls
                        // In production, you might implement custom approval logic here:
                        // - RBAC checks (is user authorized for this tool?)
                        // - Cost controls (has budget limit been reached?)
                        // - Logging and auditing
                        // - Interactive approval prompts
                        approvalItems.Add(ResponseItem.CreateMcpApprovalResponseItem(
                            request.Id,
                            approved: true));
                    }

                    // Send approval responses, chained to the previous response
                    response = await responseClient.CreateResponseAsync(
                        approvalItems,
                        previousResponseId: response.Id);
                    iteration++;
                }
                // </mcp_approval_usage>

                // Extract the text output
                string? outputText = response.GetOutputText();

                if (!string.IsNullOrWhiteSpace(outputText) && outputText.Length > 0)
                {
                    return (outputText, "completed");
                }
                else
                {
                    return ("No response from assistant", "completed");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Exception details: {ex.GetType().Name}: {ex.Message}");
                if (ex.InnerException != null)
                {
                    Console.WriteLine($"   Inner: {ex.InnerException.Message}");
                }
                return ($"Error in conversation: {ex.Message}", "failed");
            }
        }
        // </mcp_approval_handler>

        /// <summary>
        /// Interactive mode for testing the workplace assistant.
        /// 
        /// This provides a simple interface for users to test the agent with their own questions
        /// and see how it provides comprehensive technical guidance.
        /// Uses PreviousResponseId to maintain conversation context across turns.
        /// </summary>
        private static async Task InteractiveModeAsync(AgentVersion agentVersion)
        {
            Console.WriteLine("\n" + "".PadRight(60, '='));
            Console.WriteLine("üí¨ INTERACTIVE MODE - Test Your Workplace Assistant!");
            Console.WriteLine("".PadRight(60, '='));
            Console.WriteLine("Ask questions about Azure, M365, security, and technical implementation:");
            Console.WriteLine("‚Ä¢ 'How do I configure Azure AD conditional access?'");
            Console.WriteLine("‚Ä¢ 'What are MFA best practices for remote workers?'");
            Console.WriteLine("‚Ä¢ 'How do I set up secure SharePoint access?'");
            Console.WriteLine("Type 'quit' to exit.");
            Console.WriteLine("".PadRight(60, '-'));

            while (true)
            {
                try
                {
                    Console.Write("\n‚ùì Your question: ");
                    string? question = Console.ReadLine()?.Trim();

                    if (string.IsNullOrEmpty(question))
                    {
                        Console.WriteLine("üí° Please ask a question about Azure or M365 technical implementation.");
                        continue;
                    }

                    if (question.ToLower() is "quit" or "exit" or "bye")
                    {
                        break;
                    }

                    Console.Write("\nü§ñ Workplace Assistant: ");
                    var (response, status) = await ChatWithAssistantAsync(question);
                    Console.WriteLine(response);

                    if (status != "completed")
                    {
                        Console.WriteLine($"\n‚ö†Ô∏è  Response status: {status}");
                    }

                    Console.WriteLine("".PadRight(60, '-'));
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                    Console.WriteLine("".PadRight(60, '-'));
                }
            }

            Console.WriteLine("\nüëã Thank you for testing the Modern Workplace Assistant!");
        }
    }
    ```
</CodeGroup>

### Create the agent and connect the tools

Create the agent and connect the SharePoint and MCP tools.

<CodeGroup>
```python Python
    #!/usr/bin/env python3
    """
    Microsoft Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant

    This sample demonstrates a complete business scenario using the Microsoft Foundry SDK:
    - Agent creation with PromptAgentDefinition
    - Conversation management via the Responses API
    - Robust error handling and graceful degradation

    Educational Focus:
    - Enterprise AI patterns with the Microsoft Foundry SDK
    - Real-world business scenarios that enterprises face daily
    - Production-ready error handling and diagnostics
    - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)

    Business Scenario:
    An employee needs to implement Azure AD multi-factor authentication. They need:
    1. Company security policy requirements
    2. Technical implementation steps
    3. Combined guidance showing how policy requirements map to technical implementation
    """

    # <imports_and_includes>
    import os
    import time
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import (
        PromptAgentDefinition,
        SharepointPreviewTool,
        SharepointGroundingToolParameters,
        ToolProjectConnection,
        MCPTool,
    )
    from azure.identity import DefaultAzureCredential
    from dotenv import load_dotenv
    from openai.types.responses.response_input_param import (
        McpApprovalResponse,
    )
    # </imports_and_includes>

    load_dotenv()

    # ============================================================================
    # AUTHENTICATION SETUP
    # ============================================================================
    endpoint = os.environ["PROJECT_ENDPOINT"]

    def create_workplace_assistant(project_client):
        """
        Create a Modern Workplace Assistant using the Microsoft Foundry SDK.

        This demonstrates enterprise AI patterns:
        1. Agent creation with PromptAgentDefinition
        2. Robust error handling with graceful degradation
        3. Dynamic agent capabilities based on available resources
        4. Clear diagnostic information for troubleshooting

        Returns:
            agent: The created agent object
        """

        print("ü§ñ Creating Modern Workplace Assistant...")

        # ========================================================================
        # SHAREPOINT INTEGRATION SETUP
        # ========================================================================
        # <sharepoint_tool_setup>
        sharepoint_connection_id = os.environ.get("SHAREPOINT_CONNECTION_ID")
        sharepoint_tool = None

        if sharepoint_connection_id:
            print("üìÅ Configuring SharePoint integration...")
            print(f"   Connection ID: {sharepoint_connection_id}")

            try:
                sharepoint_tool = SharepointPreviewTool(
                    sharepoint_grounding_preview=SharepointGroundingToolParameters(
                        project_connections=[
                            ToolProjectConnection(
                                project_connection_id=sharepoint_connection_id
                            )
                        ]
                    )
                )
                print("‚úÖ SharePoint tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  SharePoint tool unavailable: {e}")
                print("   Agent will operate without SharePoint access")
                sharepoint_tool = None
        else:
            print("üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_ID not set)")
        # </sharepoint_tool_setup>

        # ========================================================================
        # MICROSOFT LEARN MCP INTEGRATION SETUP
        # ========================================================================
        # <mcp_tool_setup>
        mcp_server_url = os.environ.get("MCP_SERVER_URL")
        mcp_tool = None

        if mcp_server_url:
            print("üìö Configuring Microsoft Learn MCP integration...")
            print(f"   Server URL: {mcp_server_url}")

            try:
                mcp_tool = MCPTool(
                    server_url=mcp_server_url,
                    server_label="Microsoft_Learn_Documentation",
                    require_approval="always",
                )
                print("‚úÖ MCP tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  MCP tool unavailable: {e}")
                print("   Agent will operate without Microsoft Learn access")
                mcp_tool = None
        else:
            print("üìö MCP integration skipped (MCP_SERVER_URL not set)")
        # </mcp_tool_setup>

        # ========================================================================
        # AGENT CREATION WITH DYNAMIC CAPABILITIES
        # ========================================================================
        if sharepoint_tool and mcp_tool:
            instructions = """You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance"""
        elif sharepoint_tool:
            instructions = """You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices"""
        elif mcp_tool:
            instructions = """You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options"""
        else:
            instructions = """You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations"""

        # <create_agent_with_tools>
        print(f"üõ†Ô∏è  Creating agent with model: {os.environ['MODEL_DEPLOYMENT_NAME']}")

        tools = []
        if sharepoint_tool:
            tools.append(sharepoint_tool)
            print("   ‚úì SharePoint tool added")
        if mcp_tool:
            tools.append(mcp_tool)
            print("   ‚úì MCP tool added")

        print(f"   Total tools: {len(tools)}")

        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=os.environ["MODEL_DEPLOYMENT_NAME"],
                instructions=instructions,
                tools=tools if tools else None,
            ),
        )

        print(f"‚úÖ Agent created successfully (name: {agent.name}, version: {agent.version})")
        return agent
        # </create_agent_with_tools>

    def demonstrate_business_scenarios(agent, openai_client):
        """
        Demonstrate realistic business scenarios with the Microsoft Foundry SDK.

        This function showcases the practical value of the Modern Workplace Assistant
        by walking through scenarios that enterprise employees face regularly.
        """

        scenarios = [
            {
                "title": "üìã Company Policy Question (SharePoint Only)",
                "question": "What is Contoso's remote work policy?",
                "context": "Employee needs to understand company-specific remote work requirements",
                "learning_point": "SharePoint tool retrieves internal company policies",
            },
            {
                "title": "üìö Technical Documentation Question (MCP Only)",
                "question": (
                    "According to Microsoft Learn, what is the correct way to implement "
                    "Azure AD Conditional Access policies? Please include reference links "
                    "to the official documentation."
                ),
                "context": "IT administrator needs authoritative Microsoft technical guidance",
                "learning_point": "MCP tool accesses Microsoft Learn for official documentation with links",
            },
            {
                "title": "üîÑ Combined Implementation Question (SharePoint + MCP)",
                "question": (
                    "Based on our company's remote work security policy, how should I configure "
                    "my Azure environment to comply? Please include links to Microsoft "
                    "documentation showing how to implement each requirement."
                ),
                "context": "Need to map company policy to technical implementation with official guidance",
                "learning_point": "Both tools work together: SharePoint for policy + MCP for implementation docs",
            },
        ]

        print("\n" + "=" * 70)
        print("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION")
        print("=" * 70)
        print("This demonstration shows how AI agents solve real business problems")
        print("using the Microsoft Foundry SDK.")
        print("=" * 70)

        for i, scenario in enumerate(scenarios, 1):
            print(f"\nüìä SCENARIO {i}/3: {scenario['title']}")
            print("-" * 50)
            print(f"‚ùì QUESTION: {scenario['question']}")
            print(f"üéØ BUSINESS CONTEXT: {scenario['context']}")
            print(f"üéì LEARNING POINT: {scenario['learning_point']}")
            print("-" * 50)

            # <agent_conversation>
            print("ü§ñ AGENT RESPONSE:")
            response, status = create_agent_response(agent, scenario["question"], openai_client)
            # </agent_conversation>

            if status == "completed" and response and len(response.strip()) > 10:
                print(f"‚úÖ SUCCESS: {response[:300]}...")
                if len(response) > 300:
                    print(f"   üìè Full response: {len(response)} characters")
            else:
                print(f"‚ö†Ô∏è  RESPONSE: {response}")

            print(f"üìà STATUS: {status}")
            print("-" * 50)

            time.sleep(1)

        print("\n‚úÖ DEMONSTRATION COMPLETED!")
        print("üéì Key Learning Outcomes:")
        print("   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI")
        print("   ‚Ä¢ Conversation management via the Responses API")
        print("   ‚Ä¢ Real business value through AI assistance")
        print("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)")

        return True

    def create_agent_response(agent, message, openai_client):
        """
        Create a response from the workplace agent using the Responses API.

        This function demonstrates the response pattern for the Microsoft Foundry SDK
        including MCP tool approval handling.

        Args:
            agent: The agent object (with .name attribute)
            message: The user's message

        Returns:
            tuple: (response_text, status)
        """

        try:
            response = openai_client.responses.create(
                input=message,
                extra_body={
                    "agent": {"name": agent.name, "type": "agent_reference"}
                },
            )

            # Handle MCP approval requests if present
            approval_list = []
            for item in response.output:
                if item.type == "mcp_approval_request" and item.id:
                    approval_list.append(
                        McpApprovalResponse(
                            type="mcp_approval_response",
                            approve=True,
                            approval_request_id=item.id,
                        )
                    )

            if approval_list:
                response = openai_client.responses.create(
                    input=approval_list,
                    previous_response_id=response.id,
                    extra_body={
                        "agent": {"name": agent.name, "type": "agent_reference"}
                    },
                )

            return response.output_text, "completed"

        except Exception as e:
            return f"Error in conversation: {str(e)}", "failed"

    def interactive_mode(agent, openai_client):
        """Interactive mode for testing the workplace agent."""

        print("\n" + "=" * 60)
        print("üí¨ INTERACTIVE MODE - Test Your Workplace Agent!")
        print("=" * 60)
        print("Ask questions about Azure, M365, security, and technical implementation.")
        print("Type 'quit' to exit.")
        print("-" * 60)

        while True:
            try:
                question = input("\n‚ùì Your question: ").strip()

                if question.lower() in ["quit", "exit", "bye"]:
                    break

                if not question:
                    print("üí° Please ask a question about Azure or M365 technical implementation.")
                    continue

                print("\nü§ñ Workplace Agent: ", end="", flush=True)
                response, status = create_agent_response(agent, question, openai_client)
                print(response)

                if status != "completed":
                    print(f"\n‚ö†Ô∏è  Response status: {status}")

                print("-" * 60)

            except KeyboardInterrupt:
                break
            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("-" * 60)

        print("\nüëã Thank you for testing the Modern Workplace Agent!")

    def main():
        """Main execution flow demonstrating the complete sample."""

        print("üöÄ Foundry - Modern Workplace Assistant")
        print("Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK")
        print("=" * 70)

        # <agent_authentication>
        with (
            DefaultAzureCredential() as credential,
            AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
            project_client.get_openai_client() as openai_client,
        ):
            print(f"‚úÖ Connected to Foundry: {endpoint}")
        # </agent_authentication>

            try:
                agent = create_workplace_assistant(project_client)
                demonstrate_business_scenarios(agent, openai_client)

                print("\nüéØ Try interactive mode? (y/n): ", end="")
                try:
                    if input().lower().startswith("y"):
                        interactive_mode(agent, openai_client)
                except EOFError:
                    print("n")

                print("\nüéâ Sample completed successfully!")
                print("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)")
                print("üîó Next: Add evaluation metrics, monitoring, and production deployment")

            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("Please check your .env configuration and ensure:")
                print("  - PROJECT_ENDPOINT is correct")
                print("  - MODEL_DEPLOYMENT_NAME is deployed")
                print("  - Azure credentials are configured (az login)")

    if __name__ == "__main__":
        main()
    ```

```csharp C#
    // <imports_and_includes>
    using System;
    using System.ClientModel;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Threading.Tasks;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    // </imports_and_includes>

    #pragma warning disable OPENAI001

    /*
     * Azure AI Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant (C#)
     * 
     * This sample demonstrates a complete business scenario using the Azure AI Projects v2 SDK:
     * - Agent creation with PromptAgentDefinition and AgentVersion
     * - Conversation via the Responses API (ProjectResponsesClient)
     * - SharePoint and MCP tool integration on the agent definition
     * - MCP tool approval handling through the Responses API approval loop
     * - Robust error handling and graceful degradation
     * 
     * Educational Focus:
     * - Enterprise AI patterns with the v2 Azure AI Projects SDK
     * - Real-world business scenarios that enterprises face daily
     * - Production-ready error handling and diagnostics
     * - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)
     * 
     * Business Scenario:
     * An employee needs to implement Azure AD multi-factor authentication. They need:
     * 1. Company security policy requirements (from SharePoint)
     * 2. Technical implementation steps (from Microsoft Learn via MCP)
     * 3. Combined guidance showing how policy requirements map to technical implementation
     */

    class Program
    {
        private static AIProjectClient? projectClient;
        private static ProjectResponsesClient? responseClient;
        private static string agentName = "Modern_Workplace_Assistant";

        static async Task Main(string[] args)
        {
            Console.WriteLine("üöÄ Azure AI Foundry - Modern Workplace Assistant");
            Console.WriteLine("Tutorial 1: Building Enterprise Agents with SharePoint + MCP Tools");
            Console.WriteLine("".PadRight(70, '='));

            try
            {
                // Create the agent with full diagnostic output
                var agentVersion = await CreateWorkplaceAssistantAsync();

                // Demonstrate business scenarios
                await DemonstrateBusinessScenariosAsync(agentVersion);

                // Offer interactive testing
                Console.Write("\nüéØ Try interactive mode? (y/n): ");
                var response = Console.ReadLine();
                if (response?.ToLower().StartsWith("y") == true)
                {
                    await InteractiveModeAsync(agentVersion);
                }

                // Cleanup
                Console.WriteLine("\nüßπ Cleaning up agent...");
                await projectClient!.Agents.DeleteAgentVersionAsync(
                    agentName: agentVersion.Name,
                    agentVersion: agentVersion.Version);
                Console.WriteLine("‚úÖ Agent deleted");

                Console.WriteLine("\nüéâ Sample completed successfully!");
                Console.WriteLine("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)");
                Console.WriteLine("üîó Next: Add evaluation metrics, monitoring, and production deployment");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                Console.WriteLine("Please check your .env configuration and ensure:");
                Console.WriteLine("  - PROJECT_ENDPOINT is correct");
                Console.WriteLine("  - MODEL_DEPLOYMENT_NAME is deployed");
                Console.WriteLine("  - Azure credentials are configured (az login)");
                throw;
            }
        }

        /// <summary>
        /// Create a Modern Workplace Assistant with SharePoint and MCP tools.
        /// 
        /// This demonstrates enterprise AI patterns:
        /// 1. Agent creation with PromptAgentDefinition and CreateAgentVersionAsync
        /// 2. SharePoint integration via SharepointAgentTool
        /// 3. MCP integration via McpTool from the OpenAI Responses API
        /// 4. Robust error handling with graceful degradation
        /// 5. Dynamic agent capabilities based on available resources
        /// 
        /// Educational Value:
        /// - Shows real-world complexity of enterprise AI systems
        /// - Demonstrates how to handle partial system failures
        /// - Provides patterns for agent creation with multiple tools
        /// </summary>
        private static async Task<AgentVersion> CreateWorkplaceAssistantAsync()
        {
            // Load environment variables from shared .env file
            var envPath = Path.Combine(Directory.GetCurrentDirectory(), "..", "shared", ".env");
            if (File.Exists(envPath))
            {
                Env.Load(envPath);
                Console.WriteLine($"üìÑ Loaded environment from: {envPath}");
            }
            else
            {
                // Fallback to local .env
                Env.Load(".env");
            }

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharePointConnectionName = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_NAME");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");

            if (string.IsNullOrEmpty(projectEndpoint))
                throw new InvalidOperationException("PROJECT_ENDPOINT environment variable not set");
            if (string.IsNullOrEmpty(modelDeploymentName))
                throw new InvalidOperationException("MODEL_DEPLOYMENT_NAME environment variable not set");

            Console.WriteLine("\nü§ñ Creating Modern Workplace Assistant...");

            // ============================================================================
            // AUTHENTICATION SETUP
            // ============================================================================
            // <agent_authentication>
            var credential = new DefaultAzureCredential();

            projectClient = new AIProjectClient(new Uri(projectEndpoint), credential);
            Console.WriteLine($"‚úÖ Connected to Azure AI Foundry: {projectEndpoint}");
            // </agent_authentication>

            // ========================================================================
            // SHAREPOINT INTEGRATION SETUP
            // ========================================================================
            // <sharepoint_connection_resolution>
            SharepointAgentTool? sharepointTool = null;

            if (!string.IsNullOrEmpty(sharePointConnectionName))
            {
                Console.WriteLine($"üìÅ Configuring SharePoint integration...");
                Console.WriteLine($"   Connection name: {sharePointConnectionName}");

                try
                {
                    // <sharepoint_tool_setup>
                    // Resolve connection name to connection ID via the Connections API
                    AIProjectConnection sharepointConnection = await projectClient.Connections.GetConnectionAsync(
                        sharePointConnectionName, includeCredentials: false);

                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnection.Id) }
                    };
                    sharepointTool = new SharepointAgentTool(sharepointToolOption);
                    Console.WriteLine($"‚úÖ SharePoint tool configured successfully");
                    // </sharepoint_tool_setup>
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint connection unavailable: {ex.Message}");
                    Console.WriteLine($"   Possible causes:");
                    Console.WriteLine($"   - Connection '{sharePointConnectionName}' doesn't exist in the project");
                    Console.WriteLine($"   - Insufficient permissions to access the connection");
                    Console.WriteLine($"   - Connection configuration is incomplete");
                    Console.WriteLine($"   Agent will operate without SharePoint access");
                }
            }
            else
            {
                Console.WriteLine($"üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)");
            }
            // </sharepoint_connection_resolution>

            // ========================================================================
            // MICROSOFT LEARN MCP INTEGRATION SETUP
            // ========================================================================
            // <mcp_tool_setup>
            // MCP (Model Context Protocol) enables agents to access external data sources
            // like Microsoft Learn documentation. The approval flow is handled in ChatWithAssistantAsync.
            McpTool? mcpTool = null;

            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                Console.WriteLine($"üìö Configuring Microsoft Learn MCP integration...");
                Console.WriteLine($"   Server URL: {mcpServerUrl}");

                try
                {
                    // Create MCP tool for Microsoft Learn documentation access
                    // server_label must match pattern: ^[a-zA-Z0-9_]+$ (alphanumeric and underscores only)
                    mcpTool = new McpTool("Microsoft_Learn_Documentation", new Uri(mcpServerUrl));
                    Console.WriteLine($"‚úÖ MCP tool configured successfully");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP tool unavailable: {ex.Message}");
                    Console.WriteLine($"   Agent will operate without Microsoft Learn access");
                }
            }
            else
            {
                Console.WriteLine($"üìö MCP integration skipped (MCP_SERVER_URL not set)");
            }
            // </mcp_tool_setup>

            // ========================================================================
            // AGENT CREATION WITH DYNAMIC CAPABILITIES
            // ========================================================================
            // Create agent instructions based on available data sources
            string instructions = GetAgentInstructions(sharepointTool != null, mcpTool != null);

            // <create_agent_with_tools>
            // Create the agent using the v2 SDK with PromptAgentDefinition
            Console.WriteLine($"üõ†Ô∏è  Creating agent with model: {modelDeploymentName}");

            var agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add tools to the agent definition
            if (sharepointTool != null)
            {
                agentDefinition.Tools.Add(sharepointTool);
                Console.WriteLine($"   ‚úì SharePoint tool added");
            }

            if (mcpTool != null)
            {
                agentDefinition.Tools.Add(mcpTool);
                Console.WriteLine($"   ‚úì MCP tool added");
            }

            Console.WriteLine($"   Total tools: {agentDefinition.Tools.Count}");

            // Create agent version
            AgentVersion agentVersion = await projectClient.Agents.CreateAgentVersionAsync(
                agentName: agentName,
                options: new(agentDefinition));

            // Create a response client bound to this agent for conversations
            responseClient = projectClient.OpenAI
                .GetProjectResponsesClientForAgent(agentVersion);

            Console.WriteLine($"‚úÖ Agent created successfully: {agentVersion.Name} (version {agentVersion.Version})");
            return agentVersion;
            // </create_agent_with_tools>
        }

        /// <summary>
        /// Generate agent instructions based on available tools.
        /// </summary>
        private static string GetAgentInstructions(bool hasSharePoint, bool hasMcp)
        {
            if (hasSharePoint && hasMcp)
            {
                return @"You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation and best practices
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance
    - Explain how internal requirements connect to external implementation steps

    EXAMPLE SCENARIOS:
    - ""What is our MFA policy?"" ‚Üí Search SharePoint for security policies
    - ""How do I configure Azure AD Conditional Access?"" ‚Üí Use Microsoft Learn for technical steps
    - ""Our policy requires MFA - how do I implement this?"" ‚Üí Combine policy requirements with implementation guidance";
            }
            else if (hasSharePoint)
            {
                return @"You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices

    RESPONSE STRATEGY:
    - Search SharePoint for company-specific requirements
    - Provide technical guidance based on Azure and M365 best practices
    - Explain how to align implementations with company policies";
            }
            else if (hasMcp)
            {
                return @"You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options

    RESPONSE STRATEGY:
    - Use Microsoft Learn for technical documentation
    - Provide comprehensive implementation guidance
    - Reference official documentation and best practices";
            }
            else
            {
                return @"You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations

    RESPONSE STRATEGY:
    - Provide comprehensive technical guidance
    - Include step-by-step implementation instructions
    - Reference best practices and security considerations";
            }
        }

        /// <summary>
        /// Demonstrate realistic business scenarios.
        /// 
        /// This function showcases the practical value of the Modern Workplace Assistant
        /// by walking through scenarios that enterprise employees face regularly.
        /// 
        /// Educational Value:
        /// - Shows real business problems that AI agents can solve
        /// - Demonstrates the Responses API conversation pattern
        /// - Illustrates conversation patterns with tool usage
        /// </summary>
        private static async Task DemonstrateBusinessScenariosAsync(AgentVersion agentVersion)
        {
            var scenarios = new[]
            {
                new
                {
                    Title = "üìã Company Policy Question (SharePoint Only)",
                    Question = "What is Contoso's remote work policy?",
                    Context = "Employee needs to understand company-specific remote work requirements",
                    LearningPoint = "SharePoint tool retrieves internal company policies"
                },
                new
                {
                    Title = "üìö Technical Documentation Question (MCP Only)",
                    Question = "According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.",
                    Context = "IT administrator needs authoritative Microsoft technical guidance",
                    LearningPoint = "MCP tool accesses Microsoft Learn for official documentation with links"
                },
                new
                {
                    Title = "üîÑ Combined Implementation Question (SharePoint + MCP)",
                    Question = "Based on our company's remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.",
                    Context = "Need to map company policy to technical implementation with official guidance",
                    LearningPoint = "Both tools work together: SharePoint for policy + MCP for implementation docs"
                }
            };

            Console.WriteLine("\n" + "".PadRight(70, '='));
            Console.WriteLine("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION");
            Console.WriteLine("".PadRight(70, '='));
            Console.WriteLine("This demonstration shows how AI agents solve real business problems");
            Console.WriteLine("using the Azure AI Projects v2 SDK with the Responses API.");
            Console.WriteLine("".PadRight(70, '='));

            for (int i = 0; i < scenarios.Length; i++)
            {
                var scenario = scenarios[i];
                Console.WriteLine($"\nüìä SCENARIO {i + 1}/{scenarios.Length}: {scenario.Title}");
                Console.WriteLine("".PadRight(50, '-'));
                Console.WriteLine($"‚ùì QUESTION: {scenario.Question}");
                Console.WriteLine($"üéØ BUSINESS CONTEXT: {scenario.Context}");
                Console.WriteLine($"üéì LEARNING POINT: {scenario.LearningPoint}");
                Console.WriteLine("".PadRight(50, '-'));

                // <agent_conversation>
                Console.WriteLine("ü§ñ ASSISTANT RESPONSE:");
                var (response, status) = await ChatWithAssistantAsync(scenario.Question);
                // </agent_conversation>

                // Display response with analysis
                if (status == "completed" && !string.IsNullOrWhiteSpace(response) && response.Length > 10)
                {
                    var preview = response.Length > 500 ? response.Substring(0, 500) + "..." : response;
                    Console.WriteLine($"‚úÖ SUCCESS: {preview}");
                    if (response.Length > 500)
                    {
                        Console.WriteLine($"   üìè Full response: {response.Length} characters");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ö†Ô∏è  RESPONSE: {response}");
                }

                Console.WriteLine($"üìà STATUS: {status}");
                Console.WriteLine("".PadRight(50, '-'));

                // Small delay between scenarios
                await Task.Delay(1000);
            }

            Console.WriteLine("\n‚úÖ DEMONSTRATION COMPLETED!");
            Console.WriteLine("üéì Key Learning Outcomes:");
            Console.WriteLine("   ‚Ä¢ Azure AI Projects v2 SDK with PromptAgentDefinition");
            Console.WriteLine("   ‚Ä¢ Responses API for agent conversations");
            Console.WriteLine("   ‚Ä¢ SharePoint + MCP tool integration");
            Console.WriteLine("   ‚Ä¢ MCP tool approval handling via the Responses API");
            Console.WriteLine("   ‚Ä¢ Real business value through AI assistance");
            Console.WriteLine("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)");
        }

        /// <summary>
        /// Execute a conversation with the workplace assistant using the Responses API.
        /// 
        /// This function demonstrates the v2 conversation pattern including:
        /// - Sending a request via ProjectResponsesClient
        /// - MCP tool approval handling through the Responses API approval loop
        /// - Proper error and timeout management
        /// 
        /// Educational Value:
        /// - Shows the Responses API conversation pattern (replaces threads/runs)
        /// - Demonstrates MCP approval via McpToolCallApprovalRequestItem
        /// - Includes timeout and error management patterns
        /// </summary>
        // <mcp_approval_handler>
        private static async Task<(string response, string status)> ChatWithAssistantAsync(string message)
        {
            try
            {
                // Send the user message via the Responses API
                ResponseResult response = await responseClient!.CreateResponseAsync(message);

                // <mcp_approval_usage>
                // Handle MCP tool approval loop.
                // When the agent uses MCP tools, the response may contain
                // McpToolCallApprovalRequestItem items. We auto-approve and re-send.
                int maxIterations = 30;
                int iteration = 0;

                while (iteration < maxIterations)
                {
                    // Check for MCP approval requests in the output items
                    var approvalRequests = response.OutputItems
                        .OfType<McpToolCallApprovalRequestItem>()
                        .ToList();

                    if (approvalRequests.Count == 0) break;

                    // Build approval response items
                    var approvalItems = new List<ResponseItem>();
                    foreach (var request in approvalRequests)
                    {
                        Console.WriteLine($"   üîß Approving MCP tool: {request.ToolName}");

                        // Auto-approve MCP tool calls
                        // In production, you might implement custom approval logic here:
                        // - RBAC checks (is user authorized for this tool?)
                        // - Cost controls (has budget limit been reached?)
                        // - Logging and auditing
                        // - Interactive approval prompts
                        approvalItems.Add(ResponseItem.CreateMcpApprovalResponseItem(
                            request.Id,
                            approved: true));
                    }

                    // Send approval responses, chained to the previous response
                    response = await responseClient.CreateResponseAsync(
                        approvalItems,
                        previousResponseId: response.Id);
                    iteration++;
                }
                // </mcp_approval_usage>

                // Extract the text output
                string? outputText = response.GetOutputText();

                if (!string.IsNullOrWhiteSpace(outputText) && outputText.Length > 0)
                {
                    return (outputText, "completed");
                }
                else
                {
                    return ("No response from assistant", "completed");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Exception details: {ex.GetType().Name}: {ex.Message}");
                if (ex.InnerException != null)
                {
                    Console.WriteLine($"   Inner: {ex.InnerException.Message}");
                }
                return ($"Error in conversation: {ex.Message}", "failed");
            }
        }
        // </mcp_approval_handler>

        /// <summary>
        /// Interactive mode for testing the workplace assistant.
        /// 
        /// This provides a simple interface for users to test the agent with their own questions
        /// and see how it provides comprehensive technical guidance.
        /// Uses PreviousResponseId to maintain conversation context across turns.
        /// </summary>
        private static async Task InteractiveModeAsync(AgentVersion agentVersion)
        {
            Console.WriteLine("\n" + "".PadRight(60, '='));
            Console.WriteLine("üí¨ INTERACTIVE MODE - Test Your Workplace Assistant!");
            Console.WriteLine("".PadRight(60, '='));
            Console.WriteLine("Ask questions about Azure, M365, security, and technical implementation:");
            Console.WriteLine("‚Ä¢ 'How do I configure Azure AD conditional access?'");
            Console.WriteLine("‚Ä¢ 'What are MFA best practices for remote workers?'");
            Console.WriteLine("‚Ä¢ 'How do I set up secure SharePoint access?'");
            Console.WriteLine("Type 'quit' to exit.");
            Console.WriteLine("".PadRight(60, '-'));

            while (true)
            {
                try
                {
                    Console.Write("\n‚ùì Your question: ");
                    string? question = Console.ReadLine()?.Trim();

                    if (string.IsNullOrEmpty(question))
                    {
                        Console.WriteLine("üí° Please ask a question about Azure or M365 technical implementation.");
                        continue;
                    }

                    if (question.ToLower() is "quit" or "exit" or "bye")
                    {
                        break;
                    }

                    Console.Write("\nü§ñ Workplace Assistant: ");
                    var (response, status) = await ChatWithAssistantAsync(question);
                    Console.WriteLine(response);

                    if (status != "completed")
                    {
                        Console.WriteLine($"\n‚ö†Ô∏è  Response status: {status}");
                    }

                    Console.WriteLine("".PadRight(60, '-'));
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                    Console.WriteLine("".PadRight(60, '-'));
                }
            }

            Console.WriteLine("\nüëã Thank you for testing the Modern Workplace Assistant!");
        }
    }
    ```
</CodeGroup>

### Converse with the agent

Finally, implement an interactive loop to converse with the agent.

<CodeGroup>
```python Python
    #!/usr/bin/env python3
    """
    Microsoft Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant

    This sample demonstrates a complete business scenario using the Microsoft Foundry SDK:
    - Agent creation with PromptAgentDefinition
    - Conversation management via the Responses API
    - Robust error handling and graceful degradation

    Educational Focus:
    - Enterprise AI patterns with the Microsoft Foundry SDK
    - Real-world business scenarios that enterprises face daily
    - Production-ready error handling and diagnostics
    - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)

    Business Scenario:
    An employee needs to implement Azure AD multi-factor authentication. They need:
    1. Company security policy requirements
    2. Technical implementation steps
    3. Combined guidance showing how policy requirements map to technical implementation
    """

    # <imports_and_includes>
    import os
    import time
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import (
        PromptAgentDefinition,
        SharepointPreviewTool,
        SharepointGroundingToolParameters,
        ToolProjectConnection,
        MCPTool,
    )
    from azure.identity import DefaultAzureCredential
    from dotenv import load_dotenv
    from openai.types.responses.response_input_param import (
        McpApprovalResponse,
    )
    # </imports_and_includes>

    load_dotenv()

    # ============================================================================
    # AUTHENTICATION SETUP
    # ============================================================================
    endpoint = os.environ["PROJECT_ENDPOINT"]

    def create_workplace_assistant(project_client):
        """
        Create a Modern Workplace Assistant using the Microsoft Foundry SDK.

        This demonstrates enterprise AI patterns:
        1. Agent creation with PromptAgentDefinition
        2. Robust error handling with graceful degradation
        3. Dynamic agent capabilities based on available resources
        4. Clear diagnostic information for troubleshooting

        Returns:
            agent: The created agent object
        """

        print("ü§ñ Creating Modern Workplace Assistant...")

        # ========================================================================
        # SHAREPOINT INTEGRATION SETUP
        # ========================================================================
        # <sharepoint_tool_setup>
        sharepoint_connection_id = os.environ.get("SHAREPOINT_CONNECTION_ID")
        sharepoint_tool = None

        if sharepoint_connection_id:
            print("üìÅ Configuring SharePoint integration...")
            print(f"   Connection ID: {sharepoint_connection_id}")

            try:
                sharepoint_tool = SharepointPreviewTool(
                    sharepoint_grounding_preview=SharepointGroundingToolParameters(
                        project_connections=[
                            ToolProjectConnection(
                                project_connection_id=sharepoint_connection_id
                            )
                        ]
                    )
                )
                print("‚úÖ SharePoint tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  SharePoint tool unavailable: {e}")
                print("   Agent will operate without SharePoint access")
                sharepoint_tool = None
        else:
            print("üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_ID not set)")
        # </sharepoint_tool_setup>

        # ========================================================================
        # MICROSOFT LEARN MCP INTEGRATION SETUP
        # ========================================================================
        # <mcp_tool_setup>
        mcp_server_url = os.environ.get("MCP_SERVER_URL")
        mcp_tool = None

        if mcp_server_url:
            print("üìö Configuring Microsoft Learn MCP integration...")
            print(f"   Server URL: {mcp_server_url}")

            try:
                mcp_tool = MCPTool(
                    server_url=mcp_server_url,
                    server_label="Microsoft_Learn_Documentation",
                    require_approval="always",
                )
                print("‚úÖ MCP tool configured successfully")
            except Exception as e:
                print(f"‚ö†Ô∏è  MCP tool unavailable: {e}")
                print("   Agent will operate without Microsoft Learn access")
                mcp_tool = None
        else:
            print("üìö MCP integration skipped (MCP_SERVER_URL not set)")
        # </mcp_tool_setup>

        # ========================================================================
        # AGENT CREATION WITH DYNAMIC CAPABILITIES
        # ========================================================================
        if sharepoint_tool and mcp_tool:
            instructions = """You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance"""
        elif sharepoint_tool:
            instructions = """You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices"""
        elif mcp_tool:
            instructions = """You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options"""
        else:
            instructions = """You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations"""

        # <create_agent_with_tools>
        print(f"üõ†Ô∏è  Creating agent with model: {os.environ['MODEL_DEPLOYMENT_NAME']}")

        tools = []
        if sharepoint_tool:
            tools.append(sharepoint_tool)
            print("   ‚úì SharePoint tool added")
        if mcp_tool:
            tools.append(mcp_tool)
            print("   ‚úì MCP tool added")

        print(f"   Total tools: {len(tools)}")

        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=os.environ["MODEL_DEPLOYMENT_NAME"],
                instructions=instructions,
                tools=tools if tools else None,
            ),
        )

        print(f"‚úÖ Agent created successfully (name: {agent.name}, version: {agent.version})")
        return agent
        # </create_agent_with_tools>

    def demonstrate_business_scenarios(agent, openai_client):
        """
        Demonstrate realistic business scenarios with the Microsoft Foundry SDK.

        This function showcases the practical value of the Modern Workplace Assistant
        by walking through scenarios that enterprise employees face regularly.
        """

        scenarios = [
            {
                "title": "üìã Company Policy Question (SharePoint Only)",
                "question": "What is Contoso's remote work policy?",
                "context": "Employee needs to understand company-specific remote work requirements",
                "learning_point": "SharePoint tool retrieves internal company policies",
            },
            {
                "title": "üìö Technical Documentation Question (MCP Only)",
                "question": (
                    "According to Microsoft Learn, what is the correct way to implement "
                    "Azure AD Conditional Access policies? Please include reference links "
                    "to the official documentation."
                ),
                "context": "IT administrator needs authoritative Microsoft technical guidance",
                "learning_point": "MCP tool accesses Microsoft Learn for official documentation with links",
            },
            {
                "title": "üîÑ Combined Implementation Question (SharePoint + MCP)",
                "question": (
                    "Based on our company's remote work security policy, how should I configure "
                    "my Azure environment to comply? Please include links to Microsoft "
                    "documentation showing how to implement each requirement."
                ),
                "context": "Need to map company policy to technical implementation with official guidance",
                "learning_point": "Both tools work together: SharePoint for policy + MCP for implementation docs",
            },
        ]

        print("\n" + "=" * 70)
        print("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION")
        print("=" * 70)
        print("This demonstration shows how AI agents solve real business problems")
        print("using the Microsoft Foundry SDK.")
        print("=" * 70)

        for i, scenario in enumerate(scenarios, 1):
            print(f"\nüìä SCENARIO {i}/3: {scenario['title']}")
            print("-" * 50)
            print(f"‚ùì QUESTION: {scenario['question']}")
            print(f"üéØ BUSINESS CONTEXT: {scenario['context']}")
            print(f"üéì LEARNING POINT: {scenario['learning_point']}")
            print("-" * 50)

            # <agent_conversation>
            print("ü§ñ AGENT RESPONSE:")
            response, status = create_agent_response(agent, scenario["question"], openai_client)
            # </agent_conversation>

            if status == "completed" and response and len(response.strip()) > 10:
                print(f"‚úÖ SUCCESS: {response[:300]}...")
                if len(response) > 300:
                    print(f"   üìè Full response: {len(response)} characters")
            else:
                print(f"‚ö†Ô∏è  RESPONSE: {response}")

            print(f"üìà STATUS: {status}")
            print("-" * 50)

            time.sleep(1)

        print("\n‚úÖ DEMONSTRATION COMPLETED!")
        print("üéì Key Learning Outcomes:")
        print("   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI")
        print("   ‚Ä¢ Conversation management via the Responses API")
        print("   ‚Ä¢ Real business value through AI assistance")
        print("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)")

        return True

    def create_agent_response(agent, message, openai_client):
        """
        Create a response from the workplace agent using the Responses API.

        This function demonstrates the response pattern for the Microsoft Foundry SDK
        including MCP tool approval handling.

        Args:
            agent: The agent object (with .name attribute)
            message: The user's message

        Returns:
            tuple: (response_text, status)
        """

        try:
            response = openai_client.responses.create(
                input=message,
                extra_body={
                    "agent": {"name": agent.name, "type": "agent_reference"}
                },
            )

            # Handle MCP approval requests if present
            approval_list = []
            for item in response.output:
                if item.type == "mcp_approval_request" and item.id:
                    approval_list.append(
                        McpApprovalResponse(
                            type="mcp_approval_response",
                            approve=True,
                            approval_request_id=item.id,
                        )
                    )

            if approval_list:
                response = openai_client.responses.create(
                    input=approval_list,
                    previous_response_id=response.id,
                    extra_body={
                        "agent": {"name": agent.name, "type": "agent_reference"}
                    },
                )

            return response.output_text, "completed"

        except Exception as e:
            return f"Error in conversation: {str(e)}", "failed"

    def interactive_mode(agent, openai_client):
        """Interactive mode for testing the workplace agent."""

        print("\n" + "=" * 60)
        print("üí¨ INTERACTIVE MODE - Test Your Workplace Agent!")
        print("=" * 60)
        print("Ask questions about Azure, M365, security, and technical implementation.")
        print("Type 'quit' to exit.")
        print("-" * 60)

        while True:
            try:
                question = input("\n‚ùì Your question: ").strip()

                if question.lower() in ["quit", "exit", "bye"]:
                    break

                if not question:
                    print("üí° Please ask a question about Azure or M365 technical implementation.")
                    continue

                print("\nü§ñ Workplace Agent: ", end="", flush=True)
                response, status = create_agent_response(agent, question, openai_client)
                print(response)

                if status != "completed":
                    print(f"\n‚ö†Ô∏è  Response status: {status}")

                print("-" * 60)

            except KeyboardInterrupt:
                break
            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("-" * 60)

        print("\nüëã Thank you for testing the Modern Workplace Agent!")

    def main():
        """Main execution flow demonstrating the complete sample."""

        print("üöÄ Foundry - Modern Workplace Assistant")
        print("Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK")
        print("=" * 70)

        # <agent_authentication>
        with (
            DefaultAzureCredential() as credential,
            AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
            project_client.get_openai_client() as openai_client,
        ):
            print(f"‚úÖ Connected to Foundry: {endpoint}")
        # </agent_authentication>

            try:
                agent = create_workplace_assistant(project_client)
                demonstrate_business_scenarios(agent, openai_client)

                print("\nüéØ Try interactive mode? (y/n): ", end="")
                try:
                    if input().lower().startswith("y"):
                        interactive_mode(agent, openai_client)
                except EOFError:
                    print("n")

                print("\nüéâ Sample completed successfully!")
                print("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)")
                print("üîó Next: Add evaluation metrics, monitoring, and production deployment")

            except Exception as e:
                print(f"\n‚ùå Error: {e}")
                print("Please check your .env configuration and ensure:")
                print("  - PROJECT_ENDPOINT is correct")
                print("  - MODEL_DEPLOYMENT_NAME is deployed")
                print("  - Azure credentials are configured (az login)")

    if __name__ == "__main__":
        main()
    ```

```csharp C#
    // <imports_and_includes>
    using System;
    using System.ClientModel;
    using System.Collections.Generic;
    using System.IO;
    using System.Linq;
    using System.Threading.Tasks;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    // </imports_and_includes>

    #pragma warning disable OPENAI001

    /*
     * Azure AI Foundry Agent Sample - Tutorial 1: Modern Workplace Assistant (C#)
     * 
     * This sample demonstrates a complete business scenario using the Azure AI Projects v2 SDK:
     * - Agent creation with PromptAgentDefinition and AgentVersion
     * - Conversation via the Responses API (ProjectResponsesClient)
     * - SharePoint and MCP tool integration on the agent definition
     * - MCP tool approval handling through the Responses API approval loop
     * - Robust error handling and graceful degradation
     * 
     * Educational Focus:
     * - Enterprise AI patterns with the v2 Azure AI Projects SDK
     * - Real-world business scenarios that enterprises face daily
     * - Production-ready error handling and diagnostics
     * - Foundation for governance, evaluation, and monitoring (Tutorials 2-3)
     * 
     * Business Scenario:
     * An employee needs to implement Azure AD multi-factor authentication. They need:
     * 1. Company security policy requirements (from SharePoint)
     * 2. Technical implementation steps (from Microsoft Learn via MCP)
     * 3. Combined guidance showing how policy requirements map to technical implementation
     */

    class Program
    {
        private static AIProjectClient? projectClient;
        private static ProjectResponsesClient? responseClient;
        private static string agentName = "Modern_Workplace_Assistant";

        static async Task Main(string[] args)
        {
            Console.WriteLine("üöÄ Azure AI Foundry - Modern Workplace Assistant");
            Console.WriteLine("Tutorial 1: Building Enterprise Agents with SharePoint + MCP Tools");
            Console.WriteLine("".PadRight(70, '='));

            try
            {
                // Create the agent with full diagnostic output
                var agentVersion = await CreateWorkplaceAssistantAsync();

                // Demonstrate business scenarios
                await DemonstrateBusinessScenariosAsync(agentVersion);

                // Offer interactive testing
                Console.Write("\nüéØ Try interactive mode? (y/n): ");
                var response = Console.ReadLine();
                if (response?.ToLower().StartsWith("y") == true)
                {
                    await InteractiveModeAsync(agentVersion);
                }

                // Cleanup
                Console.WriteLine("\nüßπ Cleaning up agent...");
                await projectClient!.Agents.DeleteAgentVersionAsync(
                    agentName: agentVersion.Name,
                    agentVersion: agentVersion.Version);
                Console.WriteLine("‚úÖ Agent deleted");

                Console.WriteLine("\nüéâ Sample completed successfully!");
                Console.WriteLine("üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)");
                Console.WriteLine("üîó Next: Add evaluation metrics, monitoring, and production deployment");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                Console.WriteLine("Please check your .env configuration and ensure:");
                Console.WriteLine("  - PROJECT_ENDPOINT is correct");
                Console.WriteLine("  - MODEL_DEPLOYMENT_NAME is deployed");
                Console.WriteLine("  - Azure credentials are configured (az login)");
                throw;
            }
        }

        /// <summary>
        /// Create a Modern Workplace Assistant with SharePoint and MCP tools.
        /// 
        /// This demonstrates enterprise AI patterns:
        /// 1. Agent creation with PromptAgentDefinition and CreateAgentVersionAsync
        /// 2. SharePoint integration via SharepointAgentTool
        /// 3. MCP integration via McpTool from the OpenAI Responses API
        /// 4. Robust error handling with graceful degradation
        /// 5. Dynamic agent capabilities based on available resources
        /// 
        /// Educational Value:
        /// - Shows real-world complexity of enterprise AI systems
        /// - Demonstrates how to handle partial system failures
        /// - Provides patterns for agent creation with multiple tools
        /// </summary>
        private static async Task<AgentVersion> CreateWorkplaceAssistantAsync()
        {
            // Load environment variables from shared .env file
            var envPath = Path.Combine(Directory.GetCurrentDirectory(), "..", "shared", ".env");
            if (File.Exists(envPath))
            {
                Env.Load(envPath);
                Console.WriteLine($"üìÑ Loaded environment from: {envPath}");
            }
            else
            {
                // Fallback to local .env
                Env.Load(".env");
            }

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharePointConnectionName = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_NAME");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");

            if (string.IsNullOrEmpty(projectEndpoint))
                throw new InvalidOperationException("PROJECT_ENDPOINT environment variable not set");
            if (string.IsNullOrEmpty(modelDeploymentName))
                throw new InvalidOperationException("MODEL_DEPLOYMENT_NAME environment variable not set");

            Console.WriteLine("\nü§ñ Creating Modern Workplace Assistant...");

            // ============================================================================
            // AUTHENTICATION SETUP
            // ============================================================================
            // <agent_authentication>
            var credential = new DefaultAzureCredential();

            projectClient = new AIProjectClient(new Uri(projectEndpoint), credential);
            Console.WriteLine($"‚úÖ Connected to Azure AI Foundry: {projectEndpoint}");
            // </agent_authentication>

            // ========================================================================
            // SHAREPOINT INTEGRATION SETUP
            // ========================================================================
            // <sharepoint_connection_resolution>
            SharepointAgentTool? sharepointTool = null;

            if (!string.IsNullOrEmpty(sharePointConnectionName))
            {
                Console.WriteLine($"üìÅ Configuring SharePoint integration...");
                Console.WriteLine($"   Connection name: {sharePointConnectionName}");

                try
                {
                    // <sharepoint_tool_setup>
                    // Resolve connection name to connection ID via the Connections API
                    AIProjectConnection sharepointConnection = await projectClient.Connections.GetConnectionAsync(
                        sharePointConnectionName, includeCredentials: false);

                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnection.Id) }
                    };
                    sharepointTool = new SharepointAgentTool(sharepointToolOption);
                    Console.WriteLine($"‚úÖ SharePoint tool configured successfully");
                    // </sharepoint_tool_setup>
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint connection unavailable: {ex.Message}");
                    Console.WriteLine($"   Possible causes:");
                    Console.WriteLine($"   - Connection '{sharePointConnectionName}' doesn't exist in the project");
                    Console.WriteLine($"   - Insufficient permissions to access the connection");
                    Console.WriteLine($"   - Connection configuration is incomplete");
                    Console.WriteLine($"   Agent will operate without SharePoint access");
                }
            }
            else
            {
                Console.WriteLine($"üìÅ SharePoint integration skipped (SHAREPOINT_CONNECTION_NAME not set)");
            }
            // </sharepoint_connection_resolution>

            // ========================================================================
            // MICROSOFT LEARN MCP INTEGRATION SETUP
            // ========================================================================
            // <mcp_tool_setup>
            // MCP (Model Context Protocol) enables agents to access external data sources
            // like Microsoft Learn documentation. The approval flow is handled in ChatWithAssistantAsync.
            McpTool? mcpTool = null;

            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                Console.WriteLine($"üìö Configuring Microsoft Learn MCP integration...");
                Console.WriteLine($"   Server URL: {mcpServerUrl}");

                try
                {
                    // Create MCP tool for Microsoft Learn documentation access
                    // server_label must match pattern: ^[a-zA-Z0-9_]+$ (alphanumeric and underscores only)
                    mcpTool = new McpTool("Microsoft_Learn_Documentation", new Uri(mcpServerUrl));
                    Console.WriteLine($"‚úÖ MCP tool configured successfully");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP tool unavailable: {ex.Message}");
                    Console.WriteLine($"   Agent will operate without Microsoft Learn access");
                }
            }
            else
            {
                Console.WriteLine($"üìö MCP integration skipped (MCP_SERVER_URL not set)");
            }
            // </mcp_tool_setup>

            // ========================================================================
            // AGENT CREATION WITH DYNAMIC CAPABILITIES
            // ========================================================================
            // Create agent instructions based on available data sources
            string instructions = GetAgentInstructions(sharepointTool != null, mcpTool != null);

            // <create_agent_with_tools>
            // Create the agent using the v2 SDK with PromptAgentDefinition
            Console.WriteLine($"üõ†Ô∏è  Creating agent with model: {modelDeploymentName}");

            var agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add tools to the agent definition
            if (sharepointTool != null)
            {
                agentDefinition.Tools.Add(sharepointTool);
                Console.WriteLine($"   ‚úì SharePoint tool added");
            }

            if (mcpTool != null)
            {
                agentDefinition.Tools.Add(mcpTool);
                Console.WriteLine($"   ‚úì MCP tool added");
            }

            Console.WriteLine($"   Total tools: {agentDefinition.Tools.Count}");

            // Create agent version
            AgentVersion agentVersion = await projectClient.Agents.CreateAgentVersionAsync(
                agentName: agentName,
                options: new(agentDefinition));

            // Create a response client bound to this agent for conversations
            responseClient = projectClient.OpenAI
                .GetProjectResponsesClientForAgent(agentVersion);

            Console.WriteLine($"‚úÖ Agent created successfully: {agentVersion.Name} (version {agentVersion.Version})");
            return agentVersion;
            // </create_agent_with_tools>
        }

        /// <summary>
        /// Generate agent instructions based on available tools.
        /// </summary>
        private static string GetAgentInstructions(bool hasSharePoint, bool hasMcp)
        {
            if (hasSharePoint && hasMcp)
            {
                return @"You are a Modern Workplace Assistant for Contoso Corporation.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide comprehensive solutions combining internal requirements with external implementation

    RESPONSE STRATEGY:
    - For policy questions: Search SharePoint for company-specific requirements and guidelines
    - For technical questions: Use Microsoft Learn for current Azure/M365 documentation and best practices
    - For implementation questions: Combine both sources to show how company policies map to technical implementation
    - Always cite your sources and provide step-by-step guidance
    - Explain how internal requirements connect to external implementation steps

    EXAMPLE SCENARIOS:
    - ""What is our MFA policy?"" ‚Üí Search SharePoint for security policies
    - ""How do I configure Azure AD Conditional Access?"" ‚Üí Use Microsoft Learn for technical steps
    - ""Our policy requires MFA - how do I implement this?"" ‚Üí Combine policy requirements with implementation guidance";
            }
            else if (hasSharePoint)
            {
                return @"You are a Modern Workplace Assistant with access to Contoso Corporation's SharePoint.

    CAPABILITIES:
    - Search SharePoint for company policies, procedures, and internal documentation
    - Provide detailed technical guidance based on your knowledge
    - Combine company policies with general best practices

    RESPONSE STRATEGY:
    - Search SharePoint for company-specific requirements
    - Provide technical guidance based on Azure and M365 best practices
    - Explain how to align implementations with company policies";
            }
            else if (hasMcp)
            {
                return @"You are a Technical Assistant with access to Microsoft Learn documentation.

    CAPABILITIES:
    - Access Microsoft Learn for current Azure and Microsoft 365 technical guidance
    - Provide detailed implementation steps and best practices
    - Explain Azure services, features, and configuration options

    RESPONSE STRATEGY:
    - Use Microsoft Learn for technical documentation
    - Provide comprehensive implementation guidance
    - Reference official documentation and best practices";
            }
            else
            {
                return @"You are a Technical Assistant specializing in Azure and Microsoft 365 guidance.

    CAPABILITIES:
    - Provide detailed Azure and Microsoft 365 technical guidance
    - Explain implementation steps and best practices
    - Help with Azure AD, Conditional Access, MFA, and security configurations

    RESPONSE STRATEGY:
    - Provide comprehensive technical guidance
    - Include step-by-step implementation instructions
    - Reference best practices and security considerations";
            }
        }

        /// <summary>
        /// Demonstrate realistic business scenarios.
        /// 
        /// This function showcases the practical value of the Modern Workplace Assistant
        /// by walking through scenarios that enterprise employees face regularly.
        /// 
        /// Educational Value:
        /// - Shows real business problems that AI agents can solve
        /// - Demonstrates the Responses API conversation pattern
        /// - Illustrates conversation patterns with tool usage
        /// </summary>
        private static async Task DemonstrateBusinessScenariosAsync(AgentVersion agentVersion)
        {
            var scenarios = new[]
            {
                new
                {
                    Title = "üìã Company Policy Question (SharePoint Only)",
                    Question = "What is Contoso's remote work policy?",
                    Context = "Employee needs to understand company-specific remote work requirements",
                    LearningPoint = "SharePoint tool retrieves internal company policies"
                },
                new
                {
                    Title = "üìö Technical Documentation Question (MCP Only)",
                    Question = "According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.",
                    Context = "IT administrator needs authoritative Microsoft technical guidance",
                    LearningPoint = "MCP tool accesses Microsoft Learn for official documentation with links"
                },
                new
                {
                    Title = "üîÑ Combined Implementation Question (SharePoint + MCP)",
                    Question = "Based on our company's remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.",
                    Context = "Need to map company policy to technical implementation with official guidance",
                    LearningPoint = "Both tools work together: SharePoint for policy + MCP for implementation docs"
                }
            };

            Console.WriteLine("\n" + "".PadRight(70, '='));
            Console.WriteLine("üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION");
            Console.WriteLine("".PadRight(70, '='));
            Console.WriteLine("This demonstration shows how AI agents solve real business problems");
            Console.WriteLine("using the Azure AI Projects v2 SDK with the Responses API.");
            Console.WriteLine("".PadRight(70, '='));

            for (int i = 0; i < scenarios.Length; i++)
            {
                var scenario = scenarios[i];
                Console.WriteLine($"\nüìä SCENARIO {i + 1}/{scenarios.Length}: {scenario.Title}");
                Console.WriteLine("".PadRight(50, '-'));
                Console.WriteLine($"‚ùì QUESTION: {scenario.Question}");
                Console.WriteLine($"üéØ BUSINESS CONTEXT: {scenario.Context}");
                Console.WriteLine($"üéì LEARNING POINT: {scenario.LearningPoint}");
                Console.WriteLine("".PadRight(50, '-'));

                // <agent_conversation>
                Console.WriteLine("ü§ñ ASSISTANT RESPONSE:");
                var (response, status) = await ChatWithAssistantAsync(scenario.Question);
                // </agent_conversation>

                // Display response with analysis
                if (status == "completed" && !string.IsNullOrWhiteSpace(response) && response.Length > 10)
                {
                    var preview = response.Length > 500 ? response.Substring(0, 500) + "..." : response;
                    Console.WriteLine($"‚úÖ SUCCESS: {preview}");
                    if (response.Length > 500)
                    {
                        Console.WriteLine($"   üìè Full response: {response.Length} characters");
                    }
                }
                else
                {
                    Console.WriteLine($"‚ö†Ô∏è  RESPONSE: {response}");
                }

                Console.WriteLine($"üìà STATUS: {status}");
                Console.WriteLine("".PadRight(50, '-'));

                // Small delay between scenarios
                await Task.Delay(1000);
            }

            Console.WriteLine("\n‚úÖ DEMONSTRATION COMPLETED!");
            Console.WriteLine("üéì Key Learning Outcomes:");
            Console.WriteLine("   ‚Ä¢ Azure AI Projects v2 SDK with PromptAgentDefinition");
            Console.WriteLine("   ‚Ä¢ Responses API for agent conversations");
            Console.WriteLine("   ‚Ä¢ SharePoint + MCP tool integration");
            Console.WriteLine("   ‚Ä¢ MCP tool approval handling via the Responses API");
            Console.WriteLine("   ‚Ä¢ Real business value through AI assistance");
            Console.WriteLine("   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)");
        }

        /// <summary>
        /// Execute a conversation with the workplace assistant using the Responses API.
        /// 
        /// This function demonstrates the v2 conversation pattern including:
        /// - Sending a request via ProjectResponsesClient
        /// - MCP tool approval handling through the Responses API approval loop
        /// - Proper error and timeout management
        /// 
        /// Educational Value:
        /// - Shows the Responses API conversation pattern (replaces threads/runs)
        /// - Demonstrates MCP approval via McpToolCallApprovalRequestItem
        /// - Includes timeout and error management patterns
        /// </summary>
        // <mcp_approval_handler>
        private static async Task<(string response, string status)> ChatWithAssistantAsync(string message)
        {
            try
            {
                // Send the user message via the Responses API
                ResponseResult response = await responseClient!.CreateResponseAsync(message);

                // <mcp_approval_usage>
                // Handle MCP tool approval loop.
                // When the agent uses MCP tools, the response may contain
                // McpToolCallApprovalRequestItem items. We auto-approve and re-send.
                int maxIterations = 30;
                int iteration = 0;

                while (iteration < maxIterations)
                {
                    // Check for MCP approval requests in the output items
                    var approvalRequests = response.OutputItems
                        .OfType<McpToolCallApprovalRequestItem>()
                        .ToList();

                    if (approvalRequests.Count == 0) break;

                    // Build approval response items
                    var approvalItems = new List<ResponseItem>();
                    foreach (var request in approvalRequests)
                    {
                        Console.WriteLine($"   üîß Approving MCP tool: {request.ToolName}");

                        // Auto-approve MCP tool calls
                        // In production, you might implement custom approval logic here:
                        // - RBAC checks (is user authorized for this tool?)
                        // - Cost controls (has budget limit been reached?)
                        // - Logging and auditing
                        // - Interactive approval prompts
                        approvalItems.Add(ResponseItem.CreateMcpApprovalResponseItem(
                            request.Id,
                            approved: true));
                    }

                    // Send approval responses, chained to the previous response
                    response = await responseClient.CreateResponseAsync(
                        approvalItems,
                        previousResponseId: response.Id);
                    iteration++;
                }
                // </mcp_approval_usage>

                // Extract the text output
                string? outputText = response.GetOutputText();

                if (!string.IsNullOrWhiteSpace(outputText) && outputText.Length > 0)
                {
                    return (outputText, "completed");
                }
                else
                {
                    return ("No response from assistant", "completed");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"\n‚ùå Exception details: {ex.GetType().Name}: {ex.Message}");
                if (ex.InnerException != null)
                {
                    Console.WriteLine($"   Inner: {ex.InnerException.Message}");
                }
                return ($"Error in conversation: {ex.Message}", "failed");
            }
        }
        // </mcp_approval_handler>

        /// <summary>
        /// Interactive mode for testing the workplace assistant.
        /// 
        /// This provides a simple interface for users to test the agent with their own questions
        /// and see how it provides comprehensive technical guidance.
        /// Uses PreviousResponseId to maintain conversation context across turns.
        /// </summary>
        private static async Task InteractiveModeAsync(AgentVersion agentVersion)
        {
            Console.WriteLine("\n" + "".PadRight(60, '='));
            Console.WriteLine("üí¨ INTERACTIVE MODE - Test Your Workplace Assistant!");
            Console.WriteLine("".PadRight(60, '='));
            Console.WriteLine("Ask questions about Azure, M365, security, and technical implementation:");
            Console.WriteLine("‚Ä¢ 'How do I configure Azure AD conditional access?'");
            Console.WriteLine("‚Ä¢ 'What are MFA best practices for remote workers?'");
            Console.WriteLine("‚Ä¢ 'How do I set up secure SharePoint access?'");
            Console.WriteLine("Type 'quit' to exit.");
            Console.WriteLine("".PadRight(60, '-'));

            while (true)
            {
                try
                {
                    Console.Write("\n‚ùì Your question: ");
                    string? question = Console.ReadLine()?.Trim();

                    if (string.IsNullOrEmpty(question))
                    {
                        Console.WriteLine("üí° Please ask a question about Azure or M365 technical implementation.");
                        continue;
                    }

                    if (question.ToLower() is "quit" or "exit" or "bye")
                    {
                        break;
                    }

                    Console.Write("\nü§ñ Workplace Assistant: ");
                    var (response, status) = await ChatWithAssistantAsync(question);
                    Console.WriteLine(response);

                    if (status != "completed")
                    {
                        Console.WriteLine($"\n‚ö†Ô∏è  Response status: {status}");
                    }

                    Console.WriteLine("".PadRight(60, '-'));
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"\n‚ùå Error: {ex.Message}");
                    Console.WriteLine("".PadRight(60, '-'));
                }
            }

            Console.WriteLine("\nüëã Thank you for testing the Modern Workplace Assistant!");
        }
    }
    ```
</CodeGroup>

### Expected output from agent sample code

When you run the agent, you see output similar to the following example. The output shows successful tool configuration and agent responses to business scenarios:

```bash
‚úÖ Connected to Foundry
üöÄ Foundry - Modern Workplace Assistant
Tutorial 1: Building Enterprise Agents with Microsoft Foundry SDK
======================================================================
ü§ñ Creating Modern Workplace Assistant...
üìÅ Configuring SharePoint integration...
   Connection ID: /subscriptions/.../connections/ContosoCorpPoliciesProcedures
‚úÖ SharePoint tool configured successfully
üìö Configuring Microsoft Learn MCP integration...
   Server URL: https://learn.microsoft.com/api/mcp
‚úÖ MCP tool configured successfully
üõ†Ô∏è  Creating agent with model: gpt-4o-mini
   ‚úì SharePoint tool added
   ‚úì MCP tool added
   Total tools: 2
‚úÖ Agent created successfully (name: Modern Workplace Assistant, version: 1)

======================================================================
üè¢ MODERN WORKPLACE ASSISTANT - BUSINESS SCENARIO DEMONSTRATION
======================================================================
This demonstration shows how AI agents solve real business problems
using the Microsoft Foundry SDK.
======================================================================

üìä SCENARIO 1/3: üìã Company Policy Question (SharePoint Only)
--------------------------------------------------
‚ùì QUESTION: What is Contoso πs remote work policy?
üéØ BUSINESS CONTEXT: Employee needs to understand company-specific remote work requirements
üéì LEARNING POINT: SharePoint tool retrieves internal company policies
--------------------------------------------------
ü§ñ AGENT RESPONSE:
‚úÖ SUCCESS: Contoso πs remote work policy, effective January 2024, outlines the following key points:

### Overview
Contoso Corp supports flexible work arrangements, including remote work, to enhance employee productivity and work-life balance.

### Eligibility
- **Full-time Employees**: Must have completed a 90...
   üìè Full response: 1530 characters
üìà STATUS: completed
--------------------------------------------------

üìä SCENARIO 2/3: üìö Technical Documentation Question (MCP Only)
--------------------------------------------------
‚ùì QUESTION: According to Microsoft Learn, what is the correct way to implement Azure AD Conditional Access policies? Please include reference links to the official documentation.
üéØ BUSINESS CONTEXT: IT administrator needs authoritative Microsoft technical guidance
üéì LEARNING POINT: MCP tool accesses Microsoft Learn for official documentation with links
--------------------------------------------------
ü§ñ AGENT RESPONSE:
‚úÖ SUCCESS: To implement Azure AD Conditional Access policies correctly, follow these key steps outlined in the Microsoft Learn documentation:

### 1. Understanding Conditional Access
Conditional Access policies act as "if-then" statements that enforce organizational access controls based on various signals. Th...
   üìè Full response: 2459 characters
üìà STATUS: completed
--------------------------------------------------

üìä SCENARIO 3/3: üîÑ Combined Implementation Question (SharePoint + MCP)
--------------------------------------------------
‚ùì QUESTION: Based on our company πs remote work security policy, how should I configure my Azure environment to comply? Please include links to Microsoft documentation showing how to implement each requirement.
üéØ BUSINESS CONTEXT: Need to map company policy to technical implementation with official guidance
üéì LEARNING POINT: Both tools work together: SharePoint for policy + MCP for implementation docs
--------------------------------------------------
ü§ñ AGENT RESPONSE:
‚úÖ SUCCESS: To configure your Azure environment in compliance with Contoso Corp πs remote work security policy, you need to focus on several key areas, including enabling Multi-Factor Authentication (MFA), utilizing Azure Security Center, and implementing proper access management. Below are specific steps and li...
   üìè Full response: 3436 characters
üìà STATUS: completed
--------------------------------------------------

‚úÖ DEMONSTRATION COMPLETED!
üéì Key Learning Outcomes:
   ‚Ä¢ Microsoft Foundry SDK usage for enterprise AI
   ‚Ä¢ Conversation management via the Responses API
   ‚Ä¢ Real business value through AI assistance
   ‚Ä¢ Foundation for governance and monitoring (Tutorials 2-3)

üéØ Try interactive mode? (y/n): n

üéâ Sample completed successfully!
üìö This foundation supports Tutorial 2 (Governance) and Tutorial 3 (Production)
üîó Next: Add evaluation metrics, monitoring, and production deployment
```

## Step 5: Evaluate the assistant by using cloud evaluation

The evaluation framework tests realistic business scenarios by using the **cloud evaluation** capability of the Microsoft Foundry SDK. Instead of a custom local approach, this pattern uses the built-in evaluators (`builtin.violence`, `builtin.fluency`, `builtin.task_adherence`) and the `openai_client.evals` API to run scalable, repeatable evaluations in the cloud.

This evaluation framework demonstrates:

- **Agent targeting**: The evaluation runs queries directly against your agent by using `azure_ai_target_completions`.
- **Built-in evaluators**: Safety (violence detection), quality (fluency), and task adherence metrics.
- **Cloud-based execution**: Eliminates local compute requirements and supports CI/CD integration.
- **Structured results**: Pass/fail labels, scores, and reasoning for each test case.

The code breaks down into the following main sections:

1. [Configure the evaluation](#configure-the-evaluation).
1. [Run the cloud evaluation](#run-the-cloud-evaluation).
1. [Retrieve evaluation results](#retrieve-evaluation-results).

<Tip>
For detailed guidance on cloud evaluations, see [Run evaluations in the cloud](/observability/cloud-evaluation). To find a comprehensive list of built-in evaluators available in Foundry, see [Observability in generative AI](/observability/observability).
</Tip>

<Note>
The C# SDK uses **protocol methods** with `BinaryData` and `BinaryContent` instead of typed objects. This approach requires helper methods to parse JSON responses. See the [C# Evaluations SDK sample](https://github.com/Azure/azure-sdk-for-net/blob/feature/ai-foundry/agents-v2/sdk/ai/Azure.AI.Projects/samples/Sample21_Evaluations.md) for the complete pattern.
</Note>

### Configure the evaluation

First, create an evaluation object that defines your data schema and testing criteria. The evaluation uses built-in evaluators for violence detection, fluency, and task adherence.

In Python, use the OpenAI client directly. In C#, get an `EvaluationClient` from the project client:

<CodeGroup>
```python Python
    # ------------------------------------
    # Copyright (c) Microsoft Corporation.
    # Licensed under the MIT License.
    # ------------------------------------
    """
    DESCRIPTION:
        This sample demonstrates how to evaluate the Modern Workplace Assistant
        using the cloud evaluation API with built-in evaluators.

    USAGE:
        python evaluate.py

        Before running:
        pip install azure-ai-projects==2.0.0b3 python-dotenv openai

        Set these environment variables:
        1) PROJECT_ENDPOINT - Your Foundry project endpoint
        2) MODEL_DEPLOYMENT_NAME - Model deployment name (e.g., gpt-4o-mini)
    """

    # <imports_and_includes>
    import os
    import time
    from typing import Union
    from pprint import pprint
    from dotenv import load_dotenv
    from azure.identity import DefaultAzureCredential
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import PromptAgentDefinition
    from openai.types.eval_create_params import DataSourceConfigCustom
    from openai.types.evals.run_create_response import RunCreateResponse
    from openai.types.evals.run_retrieve_response import RunRetrieveResponse
    # </imports_and_includes>

    # <configure_evaluation>
    load_dotenv()
    endpoint = os.environ["PROJECT_ENDPOINT"]
    model_deployment_name = os.environ.get("MODEL_DEPLOYMENT_NAME", "gpt-4o-mini")

    with (
        DefaultAzureCredential() as credential,
        AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
        project_client.get_openai_client() as openai_client,
    ):
        # Create or retrieve the agent to evaluate
        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=model_deployment_name,
                instructions="You are a helpful Modern Workplace Assistant that answers questions about company policies and technical guidance.",
            ),
        )
        print(f"Agent created (id: {agent.id}, name: {agent.name}, version: {agent.version})")

        # Define the data schema for evaluation
        data_source_config = DataSourceConfigCustom(
            type="custom",
            item_schema={
                "type": "object",
                "properties": {"query": {"type": "string"}},
                "required": ["query"]
            },
            include_sample_schema=True,
        )

        # Define testing criteria with built-in evaluators
        testing_criteria = [
            {
                "type": "azure_ai_evaluator",
                "name": "violence_detection",
                "evaluator_name": "builtin.violence",
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_text}}"},
            },
            {
                "type": "azure_ai_evaluator",
                "name": "fluency",
                "evaluator_name": "builtin.fluency",
                "initialization_parameters": {"deployment_name": f"{model_deployment_name}"},
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_text}}"},
            },
            {
                "type": "azure_ai_evaluator",
                "name": "task_adherence",
                "evaluator_name": "builtin.task_adherence",
                "initialization_parameters": {"deployment_name": f"{model_deployment_name}"},
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_items}}"},
            },
        ]

        # Create the evaluation object
        eval_object = openai_client.evals.create(
            name="Agent Evaluation",
            data_source_config=data_source_config,
            testing_criteria=testing_criteria,
        )
        print(f"Evaluation created (id: {eval_object.id}, name: {eval_object.name})")
    # </configure_evaluation>

    # <run_cloud_evaluation>
        # Define the data source for the evaluation run
        data_source = {
            "type": "azure_ai_target_completions",
            "source": {
                "type": "file_content",
                "content": [
                    {"item": {"query": "What is Contoso's remote work policy?"}},
                    {"item": {"query": "What are the security requirements for remote employees?"}},
                    {"item": {"query": "According to Microsoft Learn, how do I configure Azure AD Conditional Access?"}},
                    {"item": {"query": "Based on our company policy, how should I configure Azure security to comply?"}},
                ],
            },
            "input_messages": {
                "type": "template",
                "template": [
                    {"type": "message", "role": "user", "content": {"type": "input_text", "text": "{{item.query}}"}}
                ],
            },
            "target": {
                "type": "azure_ai_agent",
                "name": agent.name,
                "version": agent.version,
            },
        }

        # Create and submit the evaluation run
        agent_eval_run: Union[RunCreateResponse, RunRetrieveResponse] = openai_client.evals.runs.create(
            eval_id=eval_object.id,
            name=f"Evaluation Run for Agent {agent.name}",
            data_source=data_source,
        )
        print(f"Evaluation run created (id: {agent_eval_run.id})")
    # </run_cloud_evaluation>

    # <retrieve_evaluation_results>
        # Poll until the evaluation run completes
        while agent_eval_run.status not in ["completed", "failed"]:
            agent_eval_run = openai_client.evals.runs.retrieve(
                run_id=agent_eval_run.id,
                eval_id=eval_object.id
            )
            print(f"Waiting for eval run to complete... current status: {agent_eval_run.status}")
            time.sleep(5)

        if agent_eval_run.status == "completed":
            print("\n‚úì Evaluation run completed successfully!")
            print(f"Result Counts: {agent_eval_run.result_counts}")

            # Retrieve detailed output items
            output_items = list(
                openai_client.evals.runs.output_items.list(
                    run_id=agent_eval_run.id,
                    eval_id=eval_object.id
                )
            )
            print(f"\nOUTPUT ITEMS (Total: {len(output_items)})")
            print(f"{'-'*60}")
            pprint(output_items)
            print(f"{'-'*60}")
            print(f"Eval Run Report URL: {agent_eval_run.report_url}")
        else:
            print("\n‚úó Evaluation run failed.")

        # Cleanup
        openai_client.evals.delete(eval_id=eval_object.id)
        print("Evaluation deleted")

        project_client.agents.delete(agent_name=agent.name)
        print("Agent deleted")
    # </retrieve_evaluation_results>
    ```

```csharp C#
    Ôªø// <imports_and_includes>
    using Azure;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Core;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    using System;
    using System.Collections.Generic;
    using System.IO.Enumeration;
    using System.Runtime.CompilerServices;
    using System.Text.Json;
    using System.Threading.Tasks;
    // </imports_and_includes>
    #pragma warning disable OPENAI001
    class EvaluateProgram
    {
        private static string GetFile(string name, [CallerFilePath] string pth = "")
        {
            var dirName = Path.GetDirectoryName(pth) ?? "";
            return Path.Combine(dirName, "..", "shared", name);
        }

        static async Task Main(string[] args)
        {
            // Load environment variables from shared directory
            Env.Load(GetFile(".env"));

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharepointConnectionId = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_ID");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");
            var tenantId = Environment.GetEnvironmentVariable("AI_FOUNDRY_TENANT_ID");

            // Use tenant-specific credential if provided
            TokenCredential credential;
            if (!string.IsNullOrEmpty(tenantId))
            {
                credential = new AzureCliCredential(new AzureCliCredentialOptions { TenantId = tenantId });
            }
            else
            {
                credential = new DefaultAzureCredential();
            }

            AIProjectClient client = new(new Uri(projectEndpoint), credential);

            Console.WriteLine("üß™ Modern Workplace Assistant Evaluation\n");

            var instructions = @"You are a Modern Workplace Assistant for Contoso Corporation.
    Answer questions using available tools and provide specific, detailed responses.";
            PromptAgentDefinition agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add SharePoint tool if configured
            if (!string.IsNullOrEmpty(sharepointConnectionId))
            {
                try
                {
                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnectionId) }
                    };
                    SharepointPreviewTool sharepointTool = new(sharepointToolOption);
                    agentDefinition.Tools.Add(sharepointTool);
                    Console.WriteLine("‚úÖ SharePoint configured for evaluation");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint unavailable: {ex.Message}");
                }
            }

            // Add MCP tool if configured
            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                try
                {
                    McpTool mcpTool = ResponseTool.CreateMcpTool(
                        serverLabel: "microsoft_learn",
                        serverUri: new Uri(mcpServerUrl),
                        toolCallApprovalPolicy: new McpToolCallApprovalPolicy(GlobalMcpToolCallApprovalPolicy.NeverRequireApproval)
                    );
                    agentDefinition.Tools.Add(mcpTool);
                    Console.WriteLine("‚úÖ MCP configured for evaluation");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP unavailable: {ex.Message}");
                }
            }

            Console.WriteLine();

            AgentVersion agent = await client.Agents.CreateAgentVersionAsync(
                agentName: "EvaluationAgent",
                options: new(agentDefinition)
            );

            // <load_test_data>
            var questions = File.ReadAllLines(GetFile("questions.jsonl"))
                .Select(line => JsonSerializer.Deserialize<JsonElement>(line))
                .ToList();
            // </load_test_data>

            // <run_batch_evaluation>
            // NOTE: This code is a non-runnable snippet of the larger sample code from which it is taken.
            var results = new List<object>();

            Console.WriteLine($"Running {questions.Count} evaluation questions...\n");

            for (int i = 0; i < questions.Count; i++)
            {
                var q = questions[i];
                var question = q.GetProperty("question").GetString()!;
                
                string[] expectedKeywords = Array.Empty<string>();
                if (q.TryGetProperty("expected_keywords", out var keywordsElem))
                {
                    expectedKeywords = keywordsElem.EnumerateArray()
                        .Select(e => e.GetString()!)
                        .ToArray();
                }

                Console.WriteLine($"Question {i + 1}/{questions.Count}: {question}");

                // Create a conversation to maintain state
                ProjectConversation conversation = await client.OpenAI.Conversations.CreateProjectConversationAsync();

                // Get OpenAI client from the agents client
                ProjectResponsesClient responseClient = client.OpenAI.GetProjectResponsesClientForAgent(agent, conversation.Id);

                // Create the user message item
                List<ResponseItem> items = [ResponseItem.CreateUserMessageItem(question)];

                string response = "";
                try
                {
                    // Create response from the agent
                    ResponseResult openAIResponse = await responseClient.CreateResponseAsync(items);
                    response = openAIResponse.GetOutputText();
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"   ‚ö†Ô∏è  Error: {ex.Message}");
                    response = "";
                }

                bool passed = response.Length > 50;
                if (expectedKeywords.Length > 0)
                {
                    passed = passed && expectedKeywords.Any(k => response.Contains(k, StringComparison.OrdinalIgnoreCase));
                }

                Console.WriteLine($"   Status: {(passed ? "‚úÖ PASS" : "‚ùå FAIL")}");
                Console.WriteLine($"   Response length: {response.Length} characters\n");

                results.Add(new
                {
                    question,
                    response,
                    passed,
                    response_length = response.Length
                });
            }
            // </run_batch_evaluation>

            // Cleanup - Note: In SDK 2.0, agents are versioned and managed differently
            // await client.DeleteAgentAsync(agent.Name); // Uncomment if you want to delete

            // <evaluation_results>
            // NOTE: This code is a non-runnable snippet of the larger sample code from which it is taken.
            var summary = new
            {
                total_questions = questions.Count,
                passed = results.Count(r => ((dynamic)r).passed),
                failed = results.Count(r => !((dynamic)r).passed),
                results
            };

            var json = JsonSerializer.Serialize(summary, new JsonSerializerOptions { WriteIndented = true });
            File.WriteAllText("evaluation_results.json", json);

            Console.WriteLine($"üìä Evaluation Complete:");
            Console.WriteLine($"   Total: {summary.total_questions}");
            Console.WriteLine($"   Passed: {summary.passed}");
            Console.WriteLine($"   Failed: {summary.failed}");
            Console.WriteLine($"\nüìÑ Results saved to evaluation_results.json");
            // </evaluation_results>
        }
    }
    ```
</CodeGroup>

The `testing_criteria` array specifies which evaluators to run:

- `builtin.violence`: Detects violent or harmful content in responses.
- `builtin.fluency`: Assesses response quality and readability (requires a model deployment).
- `builtin.task_adherence`: Evaluates whether the agent followed instructions correctly.

### Run the cloud evaluation

Create an evaluation run that targets your agent. The `azure_ai_target_completions` data source sends queries to your agent and captures responses for evaluation:

<CodeGroup>
```python Python
    # ------------------------------------
    # Copyright (c) Microsoft Corporation.
    # Licensed under the MIT License.
    # ------------------------------------
    """
    DESCRIPTION:
        This sample demonstrates how to evaluate the Modern Workplace Assistant
        using the cloud evaluation API with built-in evaluators.

    USAGE:
        python evaluate.py

        Before running:
        pip install azure-ai-projects==2.0.0b3 python-dotenv openai

        Set these environment variables:
        1) PROJECT_ENDPOINT - Your Foundry project endpoint
        2) MODEL_DEPLOYMENT_NAME - Model deployment name (e.g., gpt-4o-mini)
    """

    # <imports_and_includes>
    import os
    import time
    from typing import Union
    from pprint import pprint
    from dotenv import load_dotenv
    from azure.identity import DefaultAzureCredential
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import PromptAgentDefinition
    from openai.types.eval_create_params import DataSourceConfigCustom
    from openai.types.evals.run_create_response import RunCreateResponse
    from openai.types.evals.run_retrieve_response import RunRetrieveResponse
    # </imports_and_includes>

    # <configure_evaluation>
    load_dotenv()
    endpoint = os.environ["PROJECT_ENDPOINT"]
    model_deployment_name = os.environ.get("MODEL_DEPLOYMENT_NAME", "gpt-4o-mini")

    with (
        DefaultAzureCredential() as credential,
        AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
        project_client.get_openai_client() as openai_client,
    ):
        # Create or retrieve the agent to evaluate
        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=model_deployment_name,
                instructions="You are a helpful Modern Workplace Assistant that answers questions about company policies and technical guidance.",
            ),
        )
        print(f"Agent created (id: {agent.id}, name: {agent.name}, version: {agent.version})")

        # Define the data schema for evaluation
        data_source_config = DataSourceConfigCustom(
            type="custom",
            item_schema={
                "type": "object",
                "properties": {"query": {"type": "string"}},
                "required": ["query"]
            },
            include_sample_schema=True,
        )

        # Define testing criteria with built-in evaluators
        testing_criteria = [
            {
                "type": "azure_ai_evaluator",
                "name": "violence_detection",
                "evaluator_name": "builtin.violence",
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_text}}"},
            },
            {
                "type": "azure_ai_evaluator",
                "name": "fluency",
                "evaluator_name": "builtin.fluency",
                "initialization_parameters": {"deployment_name": f"{model_deployment_name}"},
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_text}}"},
            },
            {
                "type": "azure_ai_evaluator",
                "name": "task_adherence",
                "evaluator_name": "builtin.task_adherence",
                "initialization_parameters": {"deployment_name": f"{model_deployment_name}"},
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_items}}"},
            },
        ]

        # Create the evaluation object
        eval_object = openai_client.evals.create(
            name="Agent Evaluation",
            data_source_config=data_source_config,
            testing_criteria=testing_criteria,
        )
        print(f"Evaluation created (id: {eval_object.id}, name: {eval_object.name})")
    # </configure_evaluation>

    # <run_cloud_evaluation>
        # Define the data source for the evaluation run
        data_source = {
            "type": "azure_ai_target_completions",
            "source": {
                "type": "file_content",
                "content": [
                    {"item": {"query": "What is Contoso's remote work policy?"}},
                    {"item": {"query": "What are the security requirements for remote employees?"}},
                    {"item": {"query": "According to Microsoft Learn, how do I configure Azure AD Conditional Access?"}},
                    {"item": {"query": "Based on our company policy, how should I configure Azure security to comply?"}},
                ],
            },
            "input_messages": {
                "type": "template",
                "template": [
                    {"type": "message", "role": "user", "content": {"type": "input_text", "text": "{{item.query}}"}}
                ],
            },
            "target": {
                "type": "azure_ai_agent",
                "name": agent.name,
                "version": agent.version,
            },
        }

        # Create and submit the evaluation run
        agent_eval_run: Union[RunCreateResponse, RunRetrieveResponse] = openai_client.evals.runs.create(
            eval_id=eval_object.id,
            name=f"Evaluation Run for Agent {agent.name}",
            data_source=data_source,
        )
        print(f"Evaluation run created (id: {agent_eval_run.id})")
    # </run_cloud_evaluation>

    # <retrieve_evaluation_results>
        # Poll until the evaluation run completes
        while agent_eval_run.status not in ["completed", "failed"]:
            agent_eval_run = openai_client.evals.runs.retrieve(
                run_id=agent_eval_run.id,
                eval_id=eval_object.id
            )
            print(f"Waiting for eval run to complete... current status: {agent_eval_run.status}")
            time.sleep(5)

        if agent_eval_run.status == "completed":
            print("\n‚úì Evaluation run completed successfully!")
            print(f"Result Counts: {agent_eval_run.result_counts}")

            # Retrieve detailed output items
            output_items = list(
                openai_client.evals.runs.output_items.list(
                    run_id=agent_eval_run.id,
                    eval_id=eval_object.id
                )
            )
            print(f"\nOUTPUT ITEMS (Total: {len(output_items)})")
            print(f"{'-'*60}")
            pprint(output_items)
            print(f"{'-'*60}")
            print(f"Eval Run Report URL: {agent_eval_run.report_url}")
        else:
            print("\n‚úó Evaluation run failed.")

        # Cleanup
        openai_client.evals.delete(eval_id=eval_object.id)
        print("Evaluation deleted")

        project_client.agents.delete(agent_name=agent.name)
        print("Agent deleted")
    # </retrieve_evaluation_results>
    ```

```csharp C#
    Ôªø// <imports_and_includes>
    using Azure;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Core;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    using System;
    using System.Collections.Generic;
    using System.IO.Enumeration;
    using System.Runtime.CompilerServices;
    using System.Text.Json;
    using System.Threading.Tasks;
    // </imports_and_includes>
    #pragma warning disable OPENAI001
    class EvaluateProgram
    {
        private static string GetFile(string name, [CallerFilePath] string pth = "")
        {
            var dirName = Path.GetDirectoryName(pth) ?? "";
            return Path.Combine(dirName, "..", "shared", name);
        }

        static async Task Main(string[] args)
        {
            // Load environment variables from shared directory
            Env.Load(GetFile(".env"));

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharepointConnectionId = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_ID");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");
            var tenantId = Environment.GetEnvironmentVariable("AI_FOUNDRY_TENANT_ID");

            // Use tenant-specific credential if provided
            TokenCredential credential;
            if (!string.IsNullOrEmpty(tenantId))
            {
                credential = new AzureCliCredential(new AzureCliCredentialOptions { TenantId = tenantId });
            }
            else
            {
                credential = new DefaultAzureCredential();
            }

            AIProjectClient client = new(new Uri(projectEndpoint), credential);

            Console.WriteLine("üß™ Modern Workplace Assistant Evaluation\n");

            var instructions = @"You are a Modern Workplace Assistant for Contoso Corporation.
    Answer questions using available tools and provide specific, detailed responses.";
            PromptAgentDefinition agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add SharePoint tool if configured
            if (!string.IsNullOrEmpty(sharepointConnectionId))
            {
                try
                {
                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnectionId) }
                    };
                    SharepointPreviewTool sharepointTool = new(sharepointToolOption);
                    agentDefinition.Tools.Add(sharepointTool);
                    Console.WriteLine("‚úÖ SharePoint configured for evaluation");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint unavailable: {ex.Message}");
                }
            }

            // Add MCP tool if configured
            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                try
                {
                    McpTool mcpTool = ResponseTool.CreateMcpTool(
                        serverLabel: "microsoft_learn",
                        serverUri: new Uri(mcpServerUrl),
                        toolCallApprovalPolicy: new McpToolCallApprovalPolicy(GlobalMcpToolCallApprovalPolicy.NeverRequireApproval)
                    );
                    agentDefinition.Tools.Add(mcpTool);
                    Console.WriteLine("‚úÖ MCP configured for evaluation");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP unavailable: {ex.Message}");
                }
            }

            Console.WriteLine();

            AgentVersion agent = await client.Agents.CreateAgentVersionAsync(
                agentName: "EvaluationAgent",
                options: new(agentDefinition)
            );

            // <load_test_data>
            var questions = File.ReadAllLines(GetFile("questions.jsonl"))
                .Select(line => JsonSerializer.Deserialize<JsonElement>(line))
                .ToList();
            // </load_test_data>

            // <run_batch_evaluation>
            // NOTE: This code is a non-runnable snippet of the larger sample code from which it is taken.
            var results = new List<object>();

            Console.WriteLine($"Running {questions.Count} evaluation questions...\n");

            for (int i = 0; i < questions.Count; i++)
            {
                var q = questions[i];
                var question = q.GetProperty("question").GetString()!;
                
                string[] expectedKeywords = Array.Empty<string>();
                if (q.TryGetProperty("expected_keywords", out var keywordsElem))
                {
                    expectedKeywords = keywordsElem.EnumerateArray()
                        .Select(e => e.GetString()!)
                        .ToArray();
                }

                Console.WriteLine($"Question {i + 1}/{questions.Count}: {question}");

                // Create a conversation to maintain state
                ProjectConversation conversation = await client.OpenAI.Conversations.CreateProjectConversationAsync();

                // Get OpenAI client from the agents client
                ProjectResponsesClient responseClient = client.OpenAI.GetProjectResponsesClientForAgent(agent, conversation.Id);

                // Create the user message item
                List<ResponseItem> items = [ResponseItem.CreateUserMessageItem(question)];

                string response = "";
                try
                {
                    // Create response from the agent
                    ResponseResult openAIResponse = await responseClient.CreateResponseAsync(items);
                    response = openAIResponse.GetOutputText();
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"   ‚ö†Ô∏è  Error: {ex.Message}");
                    response = "";
                }

                bool passed = response.Length > 50;
                if (expectedKeywords.Length > 0)
                {
                    passed = passed && expectedKeywords.Any(k => response.Contains(k, StringComparison.OrdinalIgnoreCase));
                }

                Console.WriteLine($"   Status: {(passed ? "‚úÖ PASS" : "‚ùå FAIL")}");
                Console.WriteLine($"   Response length: {response.Length} characters\n");

                results.Add(new
                {
                    question,
                    response,
                    passed,
                    response_length = response.Length
                });
            }
            // </run_batch_evaluation>

            // Cleanup - Note: In SDK 2.0, agents are versioned and managed differently
            // await client.DeleteAgentAsync(agent.Name); // Uncomment if you want to delete

            // <evaluation_results>
            // NOTE: This code is a non-runnable snippet of the larger sample code from which it is taken.
            var summary = new
            {
                total_questions = questions.Count,
                passed = results.Count(r => ((dynamic)r).passed),
                failed = results.Count(r => !((dynamic)r).passed),
                results
            };

            var json = JsonSerializer.Serialize(summary, new JsonSerializerOptions { WriteIndented = true });
            File.WriteAllText("evaluation_results.json", json);

            Console.WriteLine($"üìä Evaluation Complete:");
            Console.WriteLine($"   Total: {summary.total_questions}");
            Console.WriteLine($"   Passed: {summary.passed}");
            Console.WriteLine($"   Failed: {summary.failed}");
            Console.WriteLine($"\nüìÑ Results saved to evaluation_results.json");
            // </evaluation_results>
        }
    }
    ```
</CodeGroup>

The `data_source` configuration:

- **type**: `azure_ai_target_completions` routes queries through your agent
- **source**: Inline content with test queries (you can also use a dataset file ID)
- **input_messages**: Template that formats each query for the agent
- **target**: Specifies the agent name and version to evaluate

### Retrieve evaluation results

Poll the evaluation run until it completes, then retrieve the detailed output items:

<CodeGroup>
```python Python
    # ------------------------------------
    # Copyright (c) Microsoft Corporation.
    # Licensed under the MIT License.
    # ------------------------------------
    """
    DESCRIPTION:
        This sample demonstrates how to evaluate the Modern Workplace Assistant
        using the cloud evaluation API with built-in evaluators.

    USAGE:
        python evaluate.py

        Before running:
        pip install azure-ai-projects==2.0.0b3 python-dotenv openai

        Set these environment variables:
        1) PROJECT_ENDPOINT - Your Foundry project endpoint
        2) MODEL_DEPLOYMENT_NAME - Model deployment name (e.g., gpt-4o-mini)
    """

    # <imports_and_includes>
    import os
    import time
    from typing import Union
    from pprint import pprint
    from dotenv import load_dotenv
    from azure.identity import DefaultAzureCredential
    from azure.ai.projects import AIProjectClient
    from azure.ai.projects.models import PromptAgentDefinition
    from openai.types.eval_create_params import DataSourceConfigCustom
    from openai.types.evals.run_create_response import RunCreateResponse
    from openai.types.evals.run_retrieve_response import RunRetrieveResponse
    # </imports_and_includes>

    # <configure_evaluation>
    load_dotenv()
    endpoint = os.environ["PROJECT_ENDPOINT"]
    model_deployment_name = os.environ.get("MODEL_DEPLOYMENT_NAME", "gpt-4o-mini")

    with (
        DefaultAzureCredential() as credential,
        AIProjectClient(endpoint=endpoint, credential=credential) as project_client,
        project_client.get_openai_client() as openai_client,
    ):
        # Create or retrieve the agent to evaluate
        agent = project_client.agents.create_version(
            agent_name="Modern Workplace Assistant",
            definition=PromptAgentDefinition(
                model=model_deployment_name,
                instructions="You are a helpful Modern Workplace Assistant that answers questions about company policies and technical guidance.",
            ),
        )
        print(f"Agent created (id: {agent.id}, name: {agent.name}, version: {agent.version})")

        # Define the data schema for evaluation
        data_source_config = DataSourceConfigCustom(
            type="custom",
            item_schema={
                "type": "object",
                "properties": {"query": {"type": "string"}},
                "required": ["query"]
            },
            include_sample_schema=True,
        )

        # Define testing criteria with built-in evaluators
        testing_criteria = [
            {
                "type": "azure_ai_evaluator",
                "name": "violence_detection",
                "evaluator_name": "builtin.violence",
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_text}}"},
            },
            {
                "type": "azure_ai_evaluator",
                "name": "fluency",
                "evaluator_name": "builtin.fluency",
                "initialization_parameters": {"deployment_name": f"{model_deployment_name}"},
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_text}}"},
            },
            {
                "type": "azure_ai_evaluator",
                "name": "task_adherence",
                "evaluator_name": "builtin.task_adherence",
                "initialization_parameters": {"deployment_name": f"{model_deployment_name}"},
                "data_mapping": {"query": "{{item.query}}", "response": "{{sample.output_items}}"},
            },
        ]

        # Create the evaluation object
        eval_object = openai_client.evals.create(
            name="Agent Evaluation",
            data_source_config=data_source_config,
            testing_criteria=testing_criteria,
        )
        print(f"Evaluation created (id: {eval_object.id}, name: {eval_object.name})")
    # </configure_evaluation>

    # <run_cloud_evaluation>
        # Define the data source for the evaluation run
        data_source = {
            "type": "azure_ai_target_completions",
            "source": {
                "type": "file_content",
                "content": [
                    {"item": {"query": "What is Contoso's remote work policy?"}},
                    {"item": {"query": "What are the security requirements for remote employees?"}},
                    {"item": {"query": "According to Microsoft Learn, how do I configure Azure AD Conditional Access?"}},
                    {"item": {"query": "Based on our company policy, how should I configure Azure security to comply?"}},
                ],
            },
            "input_messages": {
                "type": "template",
                "template": [
                    {"type": "message", "role": "user", "content": {"type": "input_text", "text": "{{item.query}}"}}
                ],
            },
            "target": {
                "type": "azure_ai_agent",
                "name": agent.name,
                "version": agent.version,
            },
        }

        # Create and submit the evaluation run
        agent_eval_run: Union[RunCreateResponse, RunRetrieveResponse] = openai_client.evals.runs.create(
            eval_id=eval_object.id,
            name=f"Evaluation Run for Agent {agent.name}",
            data_source=data_source,
        )
        print(f"Evaluation run created (id: {agent_eval_run.id})")
    # </run_cloud_evaluation>

    # <retrieve_evaluation_results>
        # Poll until the evaluation run completes
        while agent_eval_run.status not in ["completed", "failed"]:
            agent_eval_run = openai_client.evals.runs.retrieve(
                run_id=agent_eval_run.id,
                eval_id=eval_object.id
            )
            print(f"Waiting for eval run to complete... current status: {agent_eval_run.status}")
            time.sleep(5)

        if agent_eval_run.status == "completed":
            print("\n‚úì Evaluation run completed successfully!")
            print(f"Result Counts: {agent_eval_run.result_counts}")

            # Retrieve detailed output items
            output_items = list(
                openai_client.evals.runs.output_items.list(
                    run_id=agent_eval_run.id,
                    eval_id=eval_object.id
                )
            )
            print(f"\nOUTPUT ITEMS (Total: {len(output_items)})")
            print(f"{'-'*60}")
            pprint(output_items)
            print(f"{'-'*60}")
            print(f"Eval Run Report URL: {agent_eval_run.report_url}")
        else:
            print("\n‚úó Evaluation run failed.")

        # Cleanup
        openai_client.evals.delete(eval_id=eval_object.id)
        print("Evaluation deleted")

        project_client.agents.delete(agent_name=agent.name)
        print("Agent deleted")
    # </retrieve_evaluation_results>
    ```

```csharp C#
    Ôªø// <imports_and_includes>
    using Azure;
    using Azure.AI.Projects;
    using Azure.AI.Projects.OpenAI;
    using Azure.Core;
    using Azure.Identity;
    using DotNetEnv;
    using OpenAI.Responses;
    using System;
    using System.Collections.Generic;
    using System.IO.Enumeration;
    using System.Runtime.CompilerServices;
    using System.Text.Json;
    using System.Threading.Tasks;
    // </imports_and_includes>
    #pragma warning disable OPENAI001
    class EvaluateProgram
    {
        private static string GetFile(string name, [CallerFilePath] string pth = "")
        {
            var dirName = Path.GetDirectoryName(pth) ?? "";
            return Path.Combine(dirName, "..", "shared", name);
        }

        static async Task Main(string[] args)
        {
            // Load environment variables from shared directory
            Env.Load(GetFile(".env"));

            var projectEndpoint = Environment.GetEnvironmentVariable("PROJECT_ENDPOINT");
            var modelDeploymentName = Environment.GetEnvironmentVariable("MODEL_DEPLOYMENT_NAME");
            var sharepointConnectionId = Environment.GetEnvironmentVariable("SHAREPOINT_CONNECTION_ID");
            var mcpServerUrl = Environment.GetEnvironmentVariable("MCP_SERVER_URL");
            var tenantId = Environment.GetEnvironmentVariable("AI_FOUNDRY_TENANT_ID");

            // Use tenant-specific credential if provided
            TokenCredential credential;
            if (!string.IsNullOrEmpty(tenantId))
            {
                credential = new AzureCliCredential(new AzureCliCredentialOptions { TenantId = tenantId });
            }
            else
            {
                credential = new DefaultAzureCredential();
            }

            AIProjectClient client = new(new Uri(projectEndpoint), credential);

            Console.WriteLine("üß™ Modern Workplace Assistant Evaluation\n");

            var instructions = @"You are a Modern Workplace Assistant for Contoso Corporation.
    Answer questions using available tools and provide specific, detailed responses.";
            PromptAgentDefinition agentDefinition = new PromptAgentDefinition(modelDeploymentName)
            {
                Instructions = instructions
            };

            // Add SharePoint tool if configured
            if (!string.IsNullOrEmpty(sharepointConnectionId))
            {
                try
                {
                    SharePointGroundingToolOptions sharepointToolOption = new()
                    {
                        ProjectConnections = { new ToolProjectConnection(projectConnectionId: sharepointConnectionId) }
                    };
                    SharepointPreviewTool sharepointTool = new(sharepointToolOption);
                    agentDefinition.Tools.Add(sharepointTool);
                    Console.WriteLine("‚úÖ SharePoint configured for evaluation");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  SharePoint unavailable: {ex.Message}");
                }
            }

            // Add MCP tool if configured
            if (!string.IsNullOrEmpty(mcpServerUrl))
            {
                try
                {
                    McpTool mcpTool = ResponseTool.CreateMcpTool(
                        serverLabel: "microsoft_learn",
                        serverUri: new Uri(mcpServerUrl),
                        toolCallApprovalPolicy: new McpToolCallApprovalPolicy(GlobalMcpToolCallApprovalPolicy.NeverRequireApproval)
                    );
                    agentDefinition.Tools.Add(mcpTool);
                    Console.WriteLine("‚úÖ MCP configured for evaluation");
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"‚ö†Ô∏è  MCP unavailable: {ex.Message}");
                }
            }

            Console.WriteLine();

            AgentVersion agent = await client.Agents.CreateAgentVersionAsync(
                agentName: "EvaluationAgent",
                options: new(agentDefinition)
            );

            // <load_test_data>
            var questions = File.ReadAllLines(GetFile("questions.jsonl"))
                .Select(line => JsonSerializer.Deserialize<JsonElement>(line))
                .ToList();
            // </load_test_data>

            // <run_batch_evaluation>
            // NOTE: This code is a non-runnable snippet of the larger sample code from which it is taken.
            var results = new List<object>();

            Console.WriteLine($"Running {questions.Count} evaluation questions...\n");

            for (int i = 0; i < questions.Count; i++)
            {
                var q = questions[i];
                var question = q.GetProperty("question").GetString()!;
                
                string[] expectedKeywords = Array.Empty<string>();
                if (q.TryGetProperty("expected_keywords", out var keywordsElem))
                {
                    expectedKeywords = keywordsElem.EnumerateArray()
                        .Select(e => e.GetString()!)
                        .ToArray();
                }

                Console.WriteLine($"Question {i + 1}/{questions.Count}: {question}");

                // Create a conversation to maintain state
                ProjectConversation conversation = await client.OpenAI.Conversations.CreateProjectConversationAsync();

                // Get OpenAI client from the agents client
                ProjectResponsesClient responseClient = client.OpenAI.GetProjectResponsesClientForAgent(agent, conversation.Id);

                // Create the user message item
                List<ResponseItem> items = [ResponseItem.CreateUserMessageItem(question)];

                string response = "";
                try
                {
                    // Create response from the agent
                    ResponseResult openAIResponse = await responseClient.CreateResponseAsync(items);
                    response = openAIResponse.GetOutputText();
                }
                catch (Exception ex)
                {
                    Console.WriteLine($"   ‚ö†Ô∏è  Error: {ex.Message}");
                    response = "";
                }

                bool passed = response.Length > 50;
                if (expectedKeywords.Length > 0)
                {
                    passed = passed && expectedKeywords.Any(k => response.Contains(k, StringComparison.OrdinalIgnoreCase));
                }

                Console.WriteLine($"   Status: {(passed ? "‚úÖ PASS" : "‚ùå FAIL")}");
                Console.WriteLine($"   Response length: {response.Length} characters\n");

                results.Add(new
                {
                    question,
                    response,
                    passed,
                    response_length = response.Length
                });
            }
            // </run_batch_evaluation>

            // Cleanup - Note: In SDK 2.0, agents are versioned and managed differently
            // await client.DeleteAgentAsync(agent.Name); // Uncomment if you want to delete

            // <evaluation_results>
            // NOTE: This code is a non-runnable snippet of the larger sample code from which it is taken.
            var summary = new
            {
                total_questions = questions.Count,
                passed = results.Count(r => ((dynamic)r).passed),
                failed = results.Count(r => !((dynamic)r).passed),
                results
            };

            var json = JsonSerializer.Serialize(summary, new JsonSerializerOptions { WriteIndented = true });
            File.WriteAllText("evaluation_results.json", json);

            Console.WriteLine($"üìä Evaluation Complete:");
            Console.WriteLine($"   Total: {summary.total_questions}");
            Console.WriteLine($"   Passed: {summary.passed}");
            Console.WriteLine($"   Failed: {summary.failed}");
            Console.WriteLine($"\nüìÑ Results saved to evaluation_results.json");
            // </evaluation_results>
        }
    }
    ```
</CodeGroup>

Each output item includes:

- **Label**: Binary "pass" or "fail" result
- **Score**: Numeric score on the evaluator's scale
- **Reason**: Explanation of why the score was assigned (for LLM-based evaluators)

### Expected output from cloud evaluation (evaluate.py)

When you run the evaluation script, you see output similar to the following example. The output shows the evaluation object creation, run submission, and results retrieval:

```bash
python evaluate.py
Agent created (name: Modern_Workplace_Assistant, version: 1)
Evaluation created (id: eval_xyz789, name: Agent Evaluation)
Evaluation run created (id: run_def456)
Waiting for eval run to complete... current status: running
Waiting for eval run to complete... current status: running

‚úì Evaluation run completed successfully!
Result Counts: {'passed': 2, 'failed': 0, 'errored': 0}

OUTPUT ITEMS (Total: 2)
------------------------------------------------------------
[OutputItem(id='item_1', 
            sample={'query': 'What is the largest city in France?', 
                    'output_text': 'The largest city in France is Paris...'},
            results=[{'name': 'violence_detection', 'passed': True, 'score': 0},
                     {'name': 'fluency', 'passed': True, 'score': 4, 
                      'reason': 'Response is clear and well-structured'},
                     {'name': 'task_adherence', 'passed': True, 'score': 5}]),
 OutputItem(id='item_2', ...)]
------------------------------------------------------------
Eval Run Report URL: https://ai.azure.com/...
Evaluation deleted
Agent deleted
```

### Understanding evaluation results

Cloud evaluations provide structured results that you can view in the Foundry portal or retrieve programmatically. Each output item includes:

| Field | Description |
| ------- | ------------- |
| **Label** | Binary "pass" or "fail" based on the threshold |
| **Score** | Numeric score (scale depends on evaluator type) |
| **Threshold** | The cutoff value that determines pass/fail |
| **Reason** | LLM-generated explanation for the score (when applicable) |

**Score scales by evaluator type:**

- **Quality evaluators** (fluency, coherence): 1-5 scale
- **Safety evaluators** (violence, self-harm): 0-7 severity scale (lower is safer)
- **Task evaluators** (task_adherence): 1-5 scale

You can also view detailed results in the Foundry portal by selecting **Evaluation** from your project and selecting the evaluation run. The portal provides visualizations, filtering, and export options.

<Tip>
For production scenarios, consider running evaluations as part of your CI/CD pipeline. See [How to run an evaluation in Azure DevOps](/observability/evaluation-azure-devops), and [Continuously evaluate your AI agents](../../how-to/continuous-evaluation-agents.md) for integration patterns.
</Tip>

## Summary

You now have:
- A working single-agent prototype grounded in internal and external knowledge.
- A repeatable evaluation script demonstrating enterprise validation patterns.
- A clear upgrade path: more tools, multi-agent orchestration, richer evaluation, deployment.

These patterns reduce prototype-to-production friction: you can add data sources, enforce governance, and integrate monitoring without rewriting core logic.

## Next steps

This tutorial demonstrates **Stage 1** of the developer journey - from idea to prototype. This minimal sample provides the foundation for enterprise AI development. To continue your journey, explore the next stages:

### Suggested additional enhancements
- Add more data sources ([Azure AI Search](/agents/tools/ai-search), [other sources](/setup/connections-add)).
- Implement advanced evaluation methods ([AI-assisted evaluation](../../how-to/develop/evaluate-sdk.md)).
- Create [custom tools](/agents/tools/private-tool-catalog) for business-specific operations.
- Add [conversation memory and personalization](https://learn.microsoft.com/azure/cosmos-db/gen-ai/azure-agent-service).

### Stage 2: Prototype to production

- [Implement safety assessment with red-team testing](/observability/run-scans-ai-red-teaming-agent).
- [Create comprehensive evaluation datasets with quality metrics](/models/fine-tuning/data-generation).
- [Apply organization-wide governance policies and model comparison](../../how-to/built-in-policy-model-deployment.md).
- [Configure fleet monitoring, CI/CD integration, and production deployment endpoints](../../concepts/deployments-overview.md).

### Stage 3: Production to adoption

- [Collect trace data and user feedback from production deployments](/agents/development/trace-agent-framework).
- [Fine-tune models and generate evaluation insights for continuous improvement](/models/fine-tuning/fine-tuning).
- [Integrate Azure API Management gateway with continuous quality monitoring](/manage/enable-ai-api-management-gateway-portal).
- [Implement fleet governance, compliance controls, and cost optimization](https://learn.microsoft.com/azure/cloud-adoption-framework/scenarios/ai/platform/governance).

## Related content

- [Foundry Agent Service overview](/agents/development/overview)
- [SharePoint tool documentation](/agents/tools/sharepoint)
- [MCP tool integration](/agents/tools/model-context-protocol)
- [Multi-agent patterns](../../agents/how-to/connected-agents.md)
