---
title: "Configure AI Gateway in your Foundry resources"
description: "Enable AI Gateway with Azure API Management to apply tokens-per-minute limits and token quotas to model deployments in Microsoft Foundry."
---
# Configure AI Gateway in your Foundry resources
This article shows you how to enable AI Gateway for a Microsoft Foundry resource using the Foundry portal. AI Gateway uses Azure API Management behind the scenes to provide token limits, quotas, and governance for model deployments.

## Prerequisites

- Azure subscription ([create one for free](https://azure.microsoft.com/pricing/purchase-options/azure-account?cid=msft_learn)).

- Permissions to create or reuse an Azure API Management (APIM) instance:
  - To create an APIM instance: **Contributor** or **Owner** on the target resource group (or subscription).
  - To manage an existing APIM instance: **API Management Service Contributor** (or **Owner**) on the APIM instance. For more information, see [How to use role-based access control in Azure API Management](https://learn.microsoft.com/azure/api-management/api-management-role-based-access-control).

- Access to the Foundry portal (**Admin console**) for the target Foundry resource.
  - For example: **Azure AI Account Owner** or **Azure AI Owner** on the Foundry resource. For more information, see [Role-based access control for Microsoft Foundry](/security/rbac-foundry).

- Decision on whether to create a dedicated APIM instance or reuse an existing one.

## Requirements for using an existing API Management instance

When you select **Use existing APIM**, only API Management instances that meet all of the following requirements are listed:

<Check>The API Management instance is in the **same Microsoft Entra tenant** and the same **subscription** as the Foundry resource.</Check>
<Check>You have at least the **API Management Service Contributor** role (or Owner) on the API Management instance.</Check>
<Check>The API Management instance is in a subscription that you can access from the Foundry portal.</Check>
<Check>The API Management instance must be created in one of the **[v2 tiers](https://learn.microsoft.com/azure/api-management/v2-service-tiers-overview)**.</Check>
<Check>The API Management instance isn't already associated with another AI Gateway.</Check>
If none of your API Management instances appear in the list, verify that the instance meets the requirements above and that you have the required permissions.

## Create an AI Gateway

Follow these steps in the Foundry portal to enable AI Gateway for a resource.

1. Sign in to [Microsoft Foundry](https://ai.azure.com/?cid=learnDocs). Make sure the **New Foundry** toggle is on. These steps refer to **Foundry (new)**.

<img src="/images/new-foundry.png" />

1. Select **Operate** > **Admin console**.

1. Open the **AI Gateway** tab.

1. Select **Add AI Gateway**.

<Frame>
<img src="/images/foundry-add-ai-gateway.png" alt="A screenshot showing how to add an AI Gateway to a given Foundry resource." />
</Frame>

1. Select the Foundry resource you want to connect with the gateway.

1. Select **Create new** or **Use existing** APIM.

    - **Create new**: Creates a Basic v2 SKU instance. Basic v2 is designed for development and testing with SLA support.
    - **Use existing**: Select an instance that meets your organization's governance and networking requirements.

<Tip>
For production workloads or higher throughput requirements, consider using an existing APIM instance with a Standard v2 or Premium v2 tier. For more information, see [Azure API Management pricing tiers](https://learn.microsoft.com/azure/api-management/v2-service-tiers-overview).
</Tip>

<Note>
AI Gateway includes a free tier for Azure API Management. For current details about costs and free-tier eligibility, see [API Management Pricing](https://azure.microsoft.com/pricing/details/api-management/).
</Note>

<Frame>
<img src="/images/create-ai-gateway-portal.png" alt="Screenshot of AI Gateway tab in the Admin console showing options to create or select an API Management instance." />
</Frame>

1. Name the gateway, and select **Add** to create or associate the APIM instance.

1. Verify the AI Gateway appears in the list with a status of **Enabled**. If the status shows **Provisioning**, wait a few minutes and refresh the page.

1. New projects created in the Foundry resource have AI Gateway enabled by default. Existing projects must be enabled manually.

1. To enable an existing project, select the AI Gateway name to view associated projects.

1. In the project list, locate the project you want to enable. The **Gateway status** column shows current status.

1. Select **Add project to gateway**. The **Gateway status** column updates to **Enabled**.

<Frame>
<img src="/images/verify-ai-gateway-project.png" alt="A screenshot showing how to enable a given project by adding it to the gateway." />
</Frame>

## Verify the gateway is working

Confirm that traffic routes through AI Gateway:

1. In the Azure portal, open the API Management instance connected to your Foundry resource.

1. Select **Monitoring** > **Metrics**. In the **Metric** dropdown, select **Requests**. Make a test call to a model deployment in the enabled project, then verify that the request count increments.

1. To check detailed logs, select **Monitoring** > **Logs** and run a query against the **GatewayLogs** table. Look for entries with a `200` response code and an API name that matches your AI Gateway.

1. If you configured token limits, verify they apply by testing a request that exceeds the limit. The API Management instance returns a `429 Too Many Requests` response when the limit is exceeded.

## AI Gateway architecture

AI Gateway sits between clients and Foundry building blocks, including models and tools. All requests flow through the APIM instance once associated. Limits apply at the project level, so each project can have its own TPM and quota settings.

<Frame>
  <img src="/images/gateway-architecture-diagram.png" alt="Logical flow showing client requests passing through AI Gateway (APIM) before reaching model deployments within a project." />
</Frame>

AI Gateway enables:

- Multi-team token containment (prevent one project from monopolizing capacity).
- Cost control by capping aggregate usage.
- Compliance boundaries for regulated workloads (enforce predictable usage ceilings).
- Registration of [custom agents for governance](/manage/register-custom-agent).

## Governance scenarios

Once you configure AI Gateway for your resource and project, you can:

* [Configure token limits for models](/manage/how-to-enforce-limits-models).
* [Add custom agents to Control Plane](/manage/register-custom-agent).
* Govern MCP and A2A agent tools.

## Troubleshooting

| Issue | Cause | Resolution |
| ----- | ----- | ---------- |
| AI Gateway doesn't appear after creation. | Provisioning is still in progress. | Wait a few minutes and refresh the page. Basic v2 instances typically provision within 5-10 minutes. |
| Project shows **Gateway status** as **Disabled**. | Existing projects aren't automatically enabled for AI Gateway. | Select the AI Gateway, locate the project, and select **Add project to gateway**. |
| Requests bypass the gateway. | The project wasn't enabled before requests were made, or the gateway isn't fully provisioned. | Verify the gateway status shows **Enabled** for both the resource and project. |
| Permission error when creating gateway. | Missing required RBAC role. | Verify you have **Contributor** or **Owner** on the resource group (to create) or **API Management Service Contributor** on an existing instance. |
| Existing API Management instance does not appear in the list when selecting **Use existing APIM** | The API Management instance does not meet the eligibility requirements or the user does not have sufficient permissions. | Verify that the API Management instance is in the same tenant, uses a supported SKU, is not already associated with another AI Gateway, and that you have the API Management Service Contributor role (or Owner) on the instance. |
| Token limits don't apply to requests. | Limits aren't configured, or the project isn't using the gateway. | Verify the project is enabled for AI Gateway, then configure token limits in the Admin console. |

For tools-specific troubleshooting, see [Tools governance with AI Gateway](https://learn.microsoft.com/azure/ai-foundry/agents/how-to/tools/governance#troubleshooting).

## Clean up resources

If you created a dedicated APIM instance for this purpose:

1. Confirm that no other workloads depend on it.
1. Disable the AI Gateway for all projects in the Foundry resource it's associated with.
1. Remove linked resources in Azure portal.
1. Delete the APIM instance with the same name as the AI gateway in Azure portal (if it isn't used for any other purpose).

## Related content

- [AI Gateway capabilities in Azure API Management](https://learn.microsoft.com/azure/api-management/genai-gateway-capabilities)
- [Azure API Management overview](https://learn.microsoft.com/azure/api-management/api-management-key-concepts)
- [Limit large language model API token usage](https://learn.microsoft.com/azure/api-management/llm-token-limit-policy)
- [How to use role-based access control in Azure API Management](https://learn.microsoft.com/azure/api-management/api-management-role-based-access-control)
- [Role-based access control for Microsoft Foundry](/security/rbac-foundry)
